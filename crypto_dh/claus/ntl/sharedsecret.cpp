#include <NTL/ZZ.h>
using namespace NTL;
#include "crypto_dh.h"

#define PUBLICKEY_BYTES crypto_dh_PUBLICKEYBYTES
#define SECRETKEY_BYTES crypto_dh_SECRETKEYBYTES
#define SHAREDSECRET_BYTES crypto_dh_BYTES

int crypto_dh(
  unsigned char *s,
  const unsigned char *pk,
  const unsigned char *sk
)
{
  ZZ a;
  ZZ p;
  ZZ base;
  ZZ result;
  base = ZZFromBytes(pk,PUBLICKEY_BYTES);
  a = ZZFromBytes(sk + PUBLICKEY_BYTES,SECRETKEY_BYTES - PUBLICKEY_BYTES);
  conv(p,"106711310550942323238863446954494903303206603796265590798875260590060843568007841918927773348877395895791048832517368787533445258799160241834659776192282820736018472427221910874308833884006430888272214561307777629540843737689598751552666502301405808925850579645658786877473119117134988654123934303586903124139");
  result = PowerMod(base,a,p);
  long long i;
  for (i = 0;i < SHAREDSECRET_BYTES;++i) s[i] = 0;
  BytesFromZZ(s,result,SHAREDSECRET_BYTES);
  return 0;
}
