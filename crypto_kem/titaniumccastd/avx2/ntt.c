/* ****************************** *
 * Titanium_CCA_std               *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>
#include <x86intrin.h>

/* 768=3*256 */
#define N1_768 3
#define N2_768 256

/* 1536=3*512 */
#define N1_1536 3
#define N2_1536 512

/* 1792=7*256 */
#define N1_1792 7
#define N2_1792 256

/* multiplication inverses of 768, 1536, 1792 (in Montgomery form) */
#define INV_768 40107
#define INV_1536 79190
#define INV_1792 50981

/* omega_n: n-th root of unity mod Q */
static const __m256i w_3[2]={{41938,41938,41938,41938},{76334,76334,76334,76334}};
static const __m256i w_3_inv[2]={{76334,76334,76334,76334},{41938,41938,41938,41938}};
static const __m256i w_7[6][6]={{{39443,39443,39443,39443},{105480,105480,105480,105480},{76592,76592,76592,76592},{89290,89290,89290,89290},{50349,50349,50349,50349},{111937,111937,111937,111937}},
{{105480,105480,105480,105480},{89290,89290,89290,89290},{111937,111937,111937,111937},{39443,39443,39443,39443},{76592,76592,76592,76592},{50349,50349,50349,50349}},
{{76592,76592,76592,76592},{111937,111937,111937,111937},{105480,105480,105480,105480},{50349,50349,50349,50349},{39443,39443,39443,39443},{89290,89290,89290,89290}},
{{89290,89290,89290,89290},{39443,39443,39443,39443},{50349,50349,50349,50349},{105480,105480,105480,105480},{111937,111937,111937,111937},{76592,76592,76592,76592}},
{{50349,50349,50349,50349},{76592,76592,76592,76592},{39443,39443,39443,39443},{111937,111937,111937,111937},{89290,89290,89290,89290},{105480,105480,105480,105480}},
{{111937,111937,111937,111937},{50349,50349,50349,50349},{89290,89290,89290,89290},{76592,76592,76592,76592},{105480,105480,105480,105480},{39443,39443,39443,39443}}};

/* omega_256,512,768,1536,1792, respectively (in Montgomery form) */
static const uint64_t omega_256[128]={51196,1293,110615,47734,38811,99434,15989,51383,82693,26870,77770,40660,111168,3205,45414,44685,5645,112647,55640,71201,110209,31021,54923,51299,67000,13890,35184,51214,30000,62708,107548,104134,99931,79271,88757,78402,23562,84922,92700,118073,114701,59208,45038,75817,60185,45929,18401,113385,49897,117655,78850,107258,75300,43855,61785,74505,17829,107900,34726,109267,66237,78323,114404,117771,66729,35070,105949,96865,38705,88079,61562,53964,79115,76509,20504,96539,70730,9544,42721,27339,17548,34283,13833,3415,25510,77135,112110,86262,22014,99853,73147,59808,55754,16466,43344,55024,74392,93871,112967,14046,47432,109112,75296,76900,72431,61213,69020,2658,99512,22113,80332,105341,33966,1075,78336,36576,24035,109928,75677,34030,63720,26273,12702,32890,19705,103558,9218,74746};
static const uint64_t omega_512[256]={51196,5109,1293,46303,110615,62928,47734,64168,38811,109969,99434,3080,15989,102318,51383,81690,82693,63362,26870,86112,77770,19335,40660,25986,111168,47789,3205,27966,45414,12188,44685,80481,5645,86713,112647,51358,55640,23110,71201,34271,110209,112968,31021,35353,54923,103907,51299,112435,67000,32930,13890,44074,35184,115371,51214,23865,30000,35928,62708,55040,107548,60485,104134,51287,99931,47862,79271,45828,88757,113581,78402,86514,23562,69093,84922,20520,92700,82632,118073,28146,114701,62712,59208,74503,45038,93488,75817,113223,60185,28080,45929,75726,18401,13616,113385,110716,49897,70827,117655,65682,78850,80238,107258,113124,75300,47601,43855,43532,61785,39458,74505,47122,17829,8957,107900,72450,34726,111227,109267,77588,66237,65795,78323,4196,114404,108057,117771,68281,66729,105367,35070,114856,105949,50149,96865,46461,38705,117790,88079,116743,61562,43638,53964,50813,79115,1549,76509,6376,20504,76028,96539,61588,70730,16581,9544,9916,42721,44634,27339,101718,17548,70974,34283,4440,13833,102953,3415,10240,25510,88268,77135,67303,112110,83169,86262,115797,22014,111899,99853,84859,73147,51362,59808,108338,55754,23625,16466,7987,43344,102435,55024,90876,74392,47649,93871,1811,112967,29979,14046,88353,47432,104303,109112,34351,75296,43433,76900,58979,72431,14928,61213,34799,69020,8856,2658,49357,99512,84356,22113,96784,80332,86933,105341,7978,33966,28945,1075,55693,78336,17742,36576,28286,24035,88867,109928,56712,75677,85616,34030,95633,63720,45087,26273,55403,12702,107181,32890,90483,19705,71381,103558,42460,9218,25043,74746,61698};
static const uint64_t omega_768[768]={51196,37986,43552,1293,25563,110779,110615,23676,112165,47734,30187,75417,38811,25835,53041,99434,23803,46072,15989,15897,108477,51383,101780,28473,82693,91005,51994,26870,75973,91240,77770,72433,115652,40660,103827,97482,111168,63697,56821,3205,9304,42619,45414,14780,101212,44685,74734,52475,5645,47939,50156,112647,30645,77337,55640,86055,40023,71201,105839,21731,110209,282,101895,31021,94924,57577,54923,77368,65583,51299,109175,99759,67000,116634,80930,13890,86635,73443,35184,45234,98211,51214,112434,95861,30000,11623,53890,62708,105872,39946,107548,112048,36914,104134,66231,11148,99931,68754,38252,79271,12100,16121,88757,97833,25355,78402,84379,86194,23562,113753,110687,84922,84855,44289,92700,84407,83729,118073,711,102144,114701,10333,40735,59208,59178,53371,45038,115466,99275,75817,37389,58093,60185,78768,60606,45929,15906,27428,18401,56997,21503,113385,7915,93092,49897,105880,73034,117655,45958,17577,78850,44939,60821,107258,95338,114059,75300,27991,99782,43855,71771,97899,61785,73080,71365,74505,51515,56367,17829,56665,67627,107900,30371,8530,34726,43314,81382,109267,7179,5821,66237,35964,77943,78323,112454,60308,114404,82944,64684,117771,52642,104992,66729,60235,49022,35070,46822,42891,105949,3599,101339,96865,42989,38185,38705,60511,7828,88079,13904,26266,61562,96936,100099,53964,13953,110657,79115,76522,114717,76509,60949,45301,20504,2803,2454,96539,113929,10712,70730,50151,91967,9544,89075,112078,42721,112467,114076,27339,5116,107182,17548,77179,111790,34283,103434,9583,13833,87429,45783,3415,49953,100950,25510,9844,28872,77135,48079,37831,112110,56800,34622,86262,68264,22253,22014,97967,106487,99853,100965,87550,73147,111931,26094,59808,57045,101758,55754,84467,95343,16466,96401,16253,43344,87189,117600,55024,22012,89695,74392,57239,76231,93871,78470,10808,112967,53162,8525,14046,22213,93120,47432,82118,78265,109112,75737,61328,75296,11447,35592,76900,22303,110541,72431,107380,8565,61213,72748,117489,69020,73971,90078,2658,112372,75975,99512,109865,115047,22113,34339,98504,80332,24295,70343,105341,90917,42845,33966,93325,67401,1075,70099,42341,78336,47949,91516,36576,7169,82734,24035,59440,72546,109928,20796,27785,75677,49714,58630,34030,3210,29984,63720,33676,76615,26273,90514,31859,12702,22260,50966,32890,19090,68149,19705,9783,13122,103558,49355,111355,9218,41742,84605,74746,102107,79942,67077,80287,74721,116980,92710,7494,7658,94597,6108,70539,88086,42856,79462,92438,65232,18839,94470,72201,102284,102376,9796,66890,16493,89800,35580,27268,66279,91403,42300,27033,40503,45840,2621,77613,14446,20791,7105,54576,61452,115068,108969,75654,72859,103493,17061,73588,43539,65798,112628,70334,68117,5626,87628,40936,62633,32218,78250,47072,12434,96542,8064,117991,16378,87252,23349,60696,63350,40905,52690,66974,9098,18514,51273,1639,37343,104383,31638,44830,83089,73039,20062,67059,5839,22412,88273,106650,64383,55565,12401,78327,10725,6225,81359,14139,52042,107125,18342,49519,80021,39002,106173,102152,29516,20440,92918,39871,33894,32079,94711,4520,7586,33351,33418,73984,25573,33866,34544,200,117562,16129,3572,107940,77538,59065,59095,64902,73235,2807,18998,42456,80884,60180,58088,39505,57667,72344,102367,90845,99872,61276,96770,4888,110358,25181,68376,12393,45239,618,72315,100696,39423,73334,57452,11015,22935,4214,42973,90282,18491,74418,46502,20374,56488,45193,46908,43768,66758,61906,100444,61608,50646,10373,87902,109743,83547,74959,36891,9006,111094,112452,52036,82309,40330,39950,5819,57965,3869,35329,53589,502,65631,13281,51544,58038,69251,83203,71451,75382,12324,114674,16934,21408,75284,80088,79568,57762,110445,30194,104369,92007,56711,21337,18174,64309,104320,7616,39158,41751,3556,41764,57324,72972,97769,115470,115819,21734,4344,107561,47543,68122,26306,108729,29198,6195,75552,5806,4197,90934,113157,11091,100725,41094,6483,83990,14839,108690,104440,30844,72490,114858,68320,17323,92763,108429,89401,41138,70194,80442,6163,61473,83651,32011,50009,96020,96259,20306,11786,18420,17308,30723,45126,6342,92179,58465,61228,16515,62519,33806,22930,101807,21872,102020,74929,31084,673,63249,96261,28578,43881,61034,42042,24402,39803,107465,5306,65111,109748,104227,96060,25153,70841,36155,40008,9161,42536,56945,42977,106826,82681,41373,95970,7732,45842,10893,109708,57060,45525,784,49253,44302,28195,115615,5901,42298,18761,8408,3226,96160,83934,19769,37941,93978,47930,12932,27356,75428,84307,24948,50872,117198,48174,75932,39937,70324,26757,81697,111104,35539,94238,58833,45727,8345,97477,90488,42596,68559,59643,84243,115063,88289,54553,84597,41658,92000,27759,86414,105571,96013,67307,85383,99183,50124,98568,108490,105151,14715,68918,6918,109055,76531,33668,43527,16166,38331};
static const uint64_t omega_1536[1536]={51196,82901,37986,5109,43552,78230,1293,82625,25563,46303,110779,25221,110615,115543,23676,62928,112165,69608,47734,22206,30187,64168,75417,112509,38811,51242,25835,109969,53041,72099,99434,35231,23803,3080,46072,83669,15989,106459,15897,102318,108477,6454,51383,82319,101780,81690,28473,82152,82693,100616,91005,63362,51994,90537,26870,8714,75973,86112,91240,39229,77770,98861,72433,19335,115652,17012,40660,107470,103827,25986,97482,86212,111168,98010,63697,47789,56821,21121,3205,70982,9304,27966,42619,114655,45414,56623,14780,12188,101212,25270,44685,81661,74734,80481,52475,49194,5645,36824,47939,86713,50156,41232,112647,104159,30645,51358,77337,116653,55640,41241,86055,23110,40023,18376,71201,71870,105839,34271,21731,53802,110209,53559,282,112968,101895,57298,31021,83709,94924,35353,57577,34580,54923,30823,77368,103907,65583,73543,51299,93965,109175,112435,99759,99997,67000,105184,116634,32930,80930,66257,13890,411,86635,44074,73443,31371,35184,4975,45234,115371,98211,61174,51214,29717,112434,23865,95861,65958,30000,64750,11623,35928,53890,47320,62708,91978,105872,55040,39946,88188,107548,109909,112048,60485,36914,18565,104134,25663,66231,51287,11148,59543,99931,25462,68754,47862,38252,86503,79271,583,12100,45828,16121,71262,88757,3316,97833,113581,25355,108933,78402,45031,84379,86514,86194,46079,23562,44941,113753,69093,110687,21080,84922,19679,84855,20520,44289,68979,92700,22668,84407,82632,83729,75255,118073,78417,711,28146,102144,31224,114701,106621,10333,62712,40735,4143,59208,104136,59178,74503,53371,43243,45038,24272,115466,93488,99275,31931,75817,73948,37389,113223,58093,47521,60185,95403,78768,28080,60606,113067,45929,111943,15906,75726,27428,15832,18401,76183,56997,13616,21503,17828,113385,52529,7915,110716,93092,86593,49897,18004,105880,70827,73034,96524,117655,51889,45958,65682,17577,105944,78850,101192,44939,80238,60821,108603,107258,99427,95338,113124,114059,111149,75300,103386,27991,47601,99782,71464,43855,10877,71771,43532,97899,36846,61785,59432,73080,39458,71365,99821,74505,86886,51515,47122,56367,100961,17829,71006,56665,8957,67627,26703,107900,94899,30371,72450,8530,67691,34726,17785,43314,111227,81382,71175,109267,116576,7179,77588,5821,29319,66237,33559,35964,65795,77943,100220,78323,81328,112454,4196,60308,86798,114404,37973,82944,108057,64684,88358,117771,103391,52642,68281,104992,92565,66729,117412,60235,105367,49022,80180,35070,105261,46822,114856,42891,60048,105949,103501,3599,50149,101339,83695,96865,95722,42989,46461,38185,87344,38705,49042,60511,117790,7828,12953,88079,114212,13904,116743,26266,58662,61562,48109,96936,43638,100099,2170,53964,104645,13953,50813,110657,109720,79115,106692,76522,1549,114717,19922,76509,79384,60949,6376,45301,114530,20504,12715,2803,76028,2454,82174,96539,73335,113929,61588,10712,86199,70730,44242,50151,16581,91967,98949,9544,28484,89075,9916,112078,90118,42721,49825,112467,44634,114076,100344,27339,2827,5116,101718,107182,8587,17548,33932,77179,70974,111790,113151,34283,104548,103434,4440,9583,31525,13833,50554,87429,102953,45783,30808,3415,41867,49953,10240,100950,10906,25510,45203,9844,88268,28872,85970,77135,43282,48079,67303,37831,68839,112110,34993,56800,83169,34622,49100,86262,2859,68264,115797,22253,49015,22014,6118,97967,111899,106487,12015,99853,19380,100965,84859,87550,60833,73147,38617,111931,51362,26094,14924,59808,105431,57045,108338,101758,67844,55754,59228,84467,23625,95343,19502,16466,116359,96401,7987,16253,36065,43344,22587,87189,102435,117600,17274,55024,8372,22012,90876,89695,109815,74392,26520,57239,47649,76231,33446,93871,71519,78470,1811,10808,39097,112967,26001,53162,29979,8525,43040,14046,12575,22213,88353,93120,82711,47432,47180,82118,104303,78265,55577,109112,62033,75737,34351,61328,29863,75296,36356,11447,43433,35592,100474,76900,67415,22303,58979,110541,58218,72431,104093,107380,14928,8565,3702,61213,54255,72748,34799,117489,108696,69020,10983,73971,8856,90078,82059,2658,70787,112372,49357,75975,1354,99512,41313,109865,84356,115047,109339,22113,68425,34339,96784,98504,62792,80332,98477,24295,86933,70343,4968,105341,86419,90917,7978,42845,117114,33966,55569,93325,28945,67401,24244,1075,95953,70099,55693,42341,68717,78336,3493,47949,17742,91516,51652,36576,31634,7169,28286,82734,18899,24035,106084,59440,88867,72546,79701,109928,16485,20796,56712,27785,25473,75677,93358,49714,85616,58630,116687,34030,63592,3210,95633,29984,33176,63720,19256,33676,45087,76615,81584,26273,116828,90514,55403,31859,52007,12702,80638,22260,107181,50966,13412,32890,1995,19090,90483,68149,21916,19705,47458,9783,71381,13122,22408,103558,71729,49355,42460,111355,97428,9218,6097,41742,25043,84605,88973,74746,45025,102107,61698,79942,68067,67077,35372,80287,113164,74721,40043,116980,35648,92710,71970,7494,93052,7658,2730,94597,55345,6108,48665,70539,96067,88086,54105,42856,5764,79462,67031,92438,8304,65232,46174,18839,83042,94470,115193,72201,34604,102284,11814,102376,15955,9796,111819,66890,35954,16493,36583,89800,36121,35580,17657,27268,54911,66279,27736,91403,109559,42300,32161,27033,79044,40503,19412,45840,98938,2621,101261,77613,10803,14446,92287,20791,32061,7105,20263,54576,70484,61452,97152,115068,47291,108969,90307,75654,3618,72859,61650,103493,106085,17061,93003,73588,36612,43539,37792,65798,69079,112628,81449,70334,31560,68117,77041,5626,14114,87628,66915,40936,1620,62633,77032,32218,95163,78250,99897,47072,46403,12434,84002,96542,64471,8064,64714,117991,5305,16378,60975,87252,34564,23349,82920,60696,83693,63350,87450,40905,14366,52690,44730,66974,24308,9098,5838,18514,18276,51273,13089,1639,85343,37343,52016,104383,117862,31638,74199,44830,86902,83089,113298,73039,2902,20062,57099,67059,88556,5839,94408,22412,52315,88273,53523,106650,82345,64383,70953,55565,26295,12401,63233,78327,30085,10725,8364,6225,57788,81359,99708,14139,92610,52042,66986,107125,58730,18342,92811,49519,70411,80021,31770,39002,117690,106173,72445,102152,47011,29516,114957,20440,4692,92918,9340,39871,73242,33894,31759,32079,72194,94711,73332,4520,49180,7586,97193,33351,98594,33418,97753,73984,49294,25573,95605,33866,35641,34544,43018,200,39856,117562,90127,16129,87049,3572,11652,107940,55561,77538,114130,59065,14137,59095,43770,64902,75030,73235,94001,2807,24785,18998,86342,42456,44325,80884,5050,60180,70752,58088,22870,39505,90193,57667,5206,72344,6330,102367,42547,90845,102441,99872,42090,61276,104657,96770,100445,4888,65744,110358,7557,25181,31680,68376,100269,12393,47446,45239,21749,618,66384,72315,52591,100696,12329,39423,17081,73334,38035,57452,9670,11015,18846,22935,5149,4214,7124,42973,14887,90282,70672,18491,46809,74418,107396,46502,74741,20374,81427,56488,58841,45193,78815,46908,18452,43768,31387,66758,71151,61906,17312,100444,47267,61608,109316,50646,91570,10373,23374,87902,45823,109743,50582,83547,100488,74959,7046,36891,47098,9006,1697,111094,40685,112452,88954,52036,84714,82309,52478,40330,18053,39950,36945,5819,114077,57965,31475,3869,80300,35329,10216,53589,29915,502,14882,65631,49992,13281,25708,51544,861,58038,12906,69251,38093,83203,13012,71451,3417,75382,58225,12324,14772,114674,68124,16934,34578,21408,22551,75284,71812,80088,30929,79568,69231,57762,483,110445,105320,30194,4061,104369,1530,92007,59611,56711,70164,21337,74635,18174,116103,64309,13628,104320,67460,7616,8553,39158,11581,41751,116724,3556,98351,41764,38889,57324,111897,72972,3743,97769,105558,115470,42245,115819,36099,21734,44938,4344,56685,107561,32074,47543,74031,68122,101692,26306,19324,108729,89789,29198,108357,6195,28155,75552,68448,5806,73639,4197,17929,90934,115446,113157,16555,11091,109686,100725,84341,41094,47299,6483,5122,83990,13725,14839,113833,108690,86748,104440,67719,30844,15320,72490,87465,114858,76406,68320,108033,17323,107367,92763,73070,108429,30005,89401,32303,41138,74991,70194,50970,80442,49434,6163,83280,61473,35104,83651,69173,32011,115414,50009,2476,96020,69258,96259,112155,20306,6374,11786,106258,18420,98893,17308,33414,30723,57440,45126,79656,6342,66911,92179,103349,58465,12842,61228,9935,16515,50429,62519,59045,33806,94648,22930,98771,101807,1914,21872,110286,102020,82208,74929,95686,31084,15838,673,100999,63249,109901,96261,27397,28578,8458,43881,91753,61034,70624,42042,84827,24402,46754,39803,116462,107465,79176,5306,92272,65111,88294,109748,75233,104227,105698,96060,29920,25153,35562,70841,71093,36155,13970,40008,62696,9161,56240,42536,83922,56945,88410,42977,81917,106826,74840,82681,17799,41373,50858,95970,59294,7732,60055,45842,14180,10893,103345,109708,114571,57060,64018,45525,83474,784,9577,49253,107290,44302,109417,28195,36214,115615,47486,5901,68916,42298,116919,18761,76960,8408,33917,3226,8934,96160,49848,83934,21489,19769,55481,37941,19796,93978,31340,47930,113305,12932,31854,27356,110295,75428,1159,84307,62704,24948,89328,50872,94029,117198,22320,48174,62580,75932,49556,39937,114780,70324,100531,26757,66621,81697,86639,111104,89987,35539,99374,94238,12189,58833,29406,45727,38572,8345,101788,97477,61561,90488,92800,42596,24915,68559,32657,59643,1586,84243,54681,115063,22640,88289,85097,54553,99017,84597,73186,41658,36689,92000,1445,27759,62870,86414,66266,105571,37635,96013,11092,67307,104861,85383,116278,99183,27790,50124,96357,98568,70815,108490,46892,105151,95865,14715,46544,68918,75813,6918,20845,109055,112176,76531,93230,33668,29300,43527,73248,16166,56575,38331,50206};
static const uint64_t omega_1792[1792]={51196,98631,59922,76358,63140,22765,69152,1293,56053,1019,114791,86878,16282,94903,110615,517,67874,84470,18823,25865,103013,47734,16330,67347,42049,116191,71648,105930,38811,102417,74493,20068,109474,54325,46851,99434,62169,116964,31981,100685,83197,30137,15989,95556,21565,48414,59621,2755,24942,51383,60270,113123,98265,92627,37377,38605,82693,82929,26294,63709,100211,59630,86293,26870,87856,105330,28442,13308,47844,91166,77770,41021,36135,101115,53175,17121,76483,40660,115250,89488,114610,62658,43215,57887,111168,47724,41783,12639,106655,26700,47465,3205,62287,29510,109825,663,3770,102605,45414,7776,30302,9970,52054,20023,46603,44685,101032,110680,12482,68657,19350,68286,5645,1951,13413,76270,74235,109045,93629,112647,56134,43223,13870,60316,67003,42412,55640,70562,78883,82136,116867,77811,66764,71201,96431,100751,104444,83700,86336,71177,110209,16761,46607,81813,75606,61183,71933,31021,60440,35241,82117,58782,21175,94897,54923,38656,82983,54430,75277,82503,93444,51299,108493,55704,73245,26886,118095,3626,67000,14566,15573,18980,63863,110363,26913,13890,9410,58146,31473,116349,655,47787,35184,26135,7147,105574,46063,118144,103625,51214,29161,63778,31031,34987,89949,17511,30000,45358,79349,31447,111563,47651,73835,62708,34223,94881,24684,22087,44425,53172,107548,36416,107351,100230,117715,24656,117010,104134,44832,46210,63322,56267,94999,55503,99931,62676,92018,61743,65841,19571,108967,79271,17089,16005,7522,38134,86972,60879,88757,71029,37476,11339,103901,11040,48862,78402,111868,40109,86607,102866,102556,63688,23562,15707,80038,40003,48899,67017,54087,84922,74732,109552,68683,24136,21290,97870,92700,5325,106809,36852,14748,49075,44827,118073,35968,88570,109390,102548,107705,74414,114701,79409,115275,84992,14834,19416,89533,59208,72298,107307,46641,42582,96031,54414,45038,65934,54886,50041,22491,9617,87152,75817,9044,90851,110765,91814,60583,61564,60185,33791,106339,50413,45478,10459,96578,45929,57086,9212,112678,107330,23581,73792,18401,11870,65177,6519,71855,16663,83155,113385,46416,83046,47831,88773,101268,54045,49897,105159,97042,94949,64495,62937,30887,117655,59101,25308,18678,99251,19385,38337,78850,12376,30949,101774,19817,26879,53121,107258,64915,58368,81436,6209,32987,94810,75300,59443,6381,91942,65949,75843,13830,43855,84717,64290,52495,92103,22802,57767,61785,100866,107417,3204,53005,95003,92631,74505,13179,33196,24107,106931,104799,67166,17829,24851,34632,106483,86018,76326,2662,107900,110309,117050,2322,27118,24332,66467,34726,32807,79872,36740,39621,51365,11467,109267,25319,2507,88466,90246,53986,93624,66237,28780,75526,28261,107361,74777,54150,78323,88228,10044,29284,22734,17956,20935,114404,42934,51651,64113,65403,93610,54562,117771,71356,115865,2541,49235,110671,47217,66729,101150,23226,90326,86908,58196,22481,35070,32444,22150,37826,66668,8040,115290,105949,96896,40780,46360,36346,48976,72093,96865,107857,66002,94697,90891,8953,74100,38705,64709,38644,89872,12435,105495,22423,88079,46302,89355,62834,21025,3600,62214,61562,41621,46504,71951,79824,64296,108187,53964,7693,87807,5331,44228,116986,117912,79115,106646,61435,45537,85005,17227,114191,76509,45446,68254,63440,87086,54570,73754,20504,16871,3170,92236,74578,99400,101400,96539,38750,9307,48284,35691,1189,36909,70730,100710,78701,48634,91020,23601,22886,9544,931,7613,54885,40759,87984,110696,42721,85226,57908,69544,91647,48038,117779,27339,65013,21820,49864,35399,11124,639,17548,18615,105850,5889,19572,118249,13778,34283,60436,116386,107543,108279,79997,14260,13833,71701,6511,115872,67515,63876,112756,3415,866,113921,54102,105879,38521,12643,25510,1274,116241,62656,24651,70600,76780,77135,60601,110367,64041,106737,78186,117597,112110,39166,85883,5986,92015,33897,25774,86262,93947,107498,45408,70357,68441,25079,22014,76477,103241,35116,104597,84570,839,99853,48318,114733,21614,30140,43835,17350,73147,63434,31394,92709,88863,108737,73325,59808,82667,78143,73290,89757,9462,67718,55754,64253,63880,31611,96262,69642,55099,16466,28696,5476,89115,82341,9036,16595,43344,72535,59954,18563,96278,99881,71668,55024,29954,91478,16929,68434,78378,7373,74392,28770,100979,91826,53694,103559,29967,93871,111704,55410,64616,3329,30525,69215,112967,69549,19784,75392,85476,12948,17968,14046,38126,12716,111731,69478,70400,112748,47432,51718,94642,53473,62878,74614,78733,109112,5885,100717,25402,63275,93105,98072,75296,22315,31807,23166,6498,113479,91013,76900,8245,7459,44733,73476,42114,9883,72431,40810,88274,82197,91704,104020,51141,61213,113847,76872,103168,67168,36393,12138,69020,77072,67200,96871,45276,27863,79588,2658,70772,17462,48274,61144,64754,101515,99512,76527,94249,72110,18113,58933,3481,22113,49211,6176,81500,8892,99263,12496,80332,48632,72456,36314,106771,38955,19749,105341,12271,2523,432,106815,92544,94882,33966,74867,61619,97603,98139,105825,10385,1075,43218,85733,32962,99306,56803,102685,78336,90621,104819,16260,8972,13912,95341,36576,54922,29374,30203,37236,30846,91912,24035,29992,89375,11928,12168,110934,4650,109928,10525,117825,99492,9160,103106,83049,75677,10567,34577,69065,21670,76840,42690,34030,77550,9622,15289,103171,95014,76460,63720,84040,48845,38881,42519,102630,40918,26273,105333,56288,53375,99426,106186,49543,12702,100056,40196,66230,82079,60885,26176,32890,22367,41379,47447,72675,58431,74837,19705,51752,55411,73898,56109,47719,113646,103558,20685,41091,94510,10979,74025,52193,9218,50097,69191,8472,103832,80220,73505,74746,2954,97965,28306,51959,84417,118242,67077,19642,58351,41915,55133,95508,49121,116980,62220,117254,3482,31395,101991,23370,7658,117756,50399,33803,99450,92408,15260,70539,101943,50926,76224,2082,46625,12343,79462,15856,43780,98205,8799,63948,71422,18839,56104,1309,86292,17588,35076,88136,102284,22717,96708,69859,58652,115518,93331,66890,58003,5150,20008,25646,80896,79668,35580,35344,91979,54564,18062,58643,31980,91403,30417,12943,89831,104965,70429,27107,40503,77252,82138,17158,65098,101152,41790,77613,3023,28785,3663,55615,75058,60386,7105,70549,76490,105634,11618,91573,70808,115068,55986,88763,8448,117610,114503,15668,72859,110497,87971,108303,66219,98250,71670,73588,17241,7593,105791,49616,98923,49987,112628,116322,104860,42003,44038,9228,24644,5626,62139,75050,104403,57957,51270,75861,62633,47711,39390,36137,1406,40462,51509,47072,21842,17522,13829,34573,31937,47096,8064,101512,71666,36460,42667,57090,46340,87252,57833,83032,36156,59491,97098,23376,63350,79617,35290,63843,42996,35770,24829,66974,9780,62569,45028,91387,178,114647,51273,103707,102700,99293,54410,7910,91360,104383,108863,60127,86800,1924,117618,70486,83089,92138,111126,12699,72210,129,14648,67059,89112,54495,87242,83286,28324,100762,88273,72915,38924,86826,6710,70622,44438,55565,84050,23392,93589,96186,73848,65101,10725,81857,10922,18043,558,93617,1263,14139,73441,72063,54951,62006,23274,62770,18342,55597,26255,56530,52432,98702,9306,39002,101184,102268,110751,80139,31301,57394,29516,47244,80797,106934,14372,107233,69411,39871,6405,78164,31666,15407,15717,54585,94711,102566,38235,78270,69374,51256,64186,33351,43541,8721,49590,94137,96983,20403,25573,112948,11464,81421,103525,69198,73446,200,82305,29703,8883,15725,10568,43859,3572,38864,2998,33281,103439,98857,28740,59065,45975,10966,71632,75691,22242,63859,73235,52339,63387,68232,95782,108656,31121,42456,109229,27422,7508,26459,57690,56709,58088,84482,11934,67860,72795,107814,21695,72344,61187,109061,5595,10943,94692,44481,99872,106403,53096,111754,46418,101610,35118,4888,71857,35227,70442,29500,17005,64228,68376,13114,21231,23324,53778,55336,87386,618,59172,92965,99595,19022,98888,79936,39423,105897,87324,16499,98456,91394,65152,11015,53358,59905,36837,112064,85286,23463,42973,58830,111892,26331,52324,42430,104443,74418,33556,53983,65778,26170,95471,60506,56488,17407,10856,115069,65268,23270,25642,43768,105094,85077,94166,11342,13474,51107,100444,93422,83641,11790,32255,41947,115611,10373,7964,1223,115951,91155,93941,51806,83547,85466,38401,81533,78652,66908,106806,9006,92954,115766,29807,28027,64287,24649,52036,89493,42747,90012,10912,43496,64123,39950,30045,108229,88989,95539,100317,97338,3869,75339,66622,54160,52870,24663,63711,502,46917,2408,115732,69038,7602,71056,51544,17123,95047,27947,31365,60077,95792,83203,85829,96123,80447,51605,110233,2983,12324,21377,77493,71913,81927,69297,46180,21408,10416,52271,23576,27382,109320,44173,79568,53564,79629,28401,105838,12778,95850,30194,71971,28918,55439,97248,114673,56059,56711,76652,71769,46322,38449,53977,10086,64309,110580,30466,112942,74045,1287,361,39158,11627,56838,72736,33268,101046,4082,41764,72827,50019,54833,31187,63703,44519,97769,101402,115103,26037,43695,18873,16873,21734,79523,108966,69989,82582,117084,81364,47543,17563,39572,69639,27253,94672,95387,108729,117342,110660,63388,77514,30289,7577,75552,33047,60365,48729,26626,70235,494,90934,53260,96453,68409,82874,107149,117634,100725,99658,12423,112384,98701,24,104495,83990,57837,1887,10730,9994,38276,104013,104440,46572,111762,2401,50758,54397,5517,114858,117407,4352,64171,12394,79752,105630,92763,116999,2032,55617,93622,47673,41493,41138,57672,7906,54232,11536,40087,676,6163,79107,32390,112287,26258,84376,92499,32011,24326,10775,72865,47916,49832,93194,96259,41796,15032,83157,13676,33703,117434,18420,69955,3540,96659,88133,74438,100923,45126,54839,86879,25564,29410,9536,44948,58465,35606,40130,44983,28516,108811,50555,62519,54020,54393,86662,22011,48631,63174,101807,89577,112797,29158,35932,109237,101678,74929,45738,58319,99710,21995,18392,46605,63249,88319,26795,101344,49839,39895,110900,43881,89503,17294,26447,64579,14714,88306,24402,6569,62863,53657,114944,87748,49058,5306,48724,98489,42881,32797,105325,100305,104227,80147,105557,6542,48795,47873,5525,70841,66555,23631,64800,55395,43659,39540,9161,112388,17556,92871,54998,25168,20201,42977,95958,86466,95107,111775,4794,27260,41373,110028,110814,73540,44797,76159,108390,45842,77463,29999,36076,26569,14253,67132,57060,4426,41401,15105,51105,81880,106135,49253,41201,51073,21402,72997,90410,38685,115615,47501,100811,69999,57129,53519,16758,18761,41746,24024,46163,100160,59340,114792,96160,69062,112097,36773,109381,19010,105777,37941,69641,45817,81959,11502,79318,98524,12932,106002,115750,117841,11458,25729,23391,84307,43406,56654,20670,20134,12448,107888,117198,75055,32540,85311,18967,61470,15588,39937,27652,13454,102013,109301,104361,22932,81697,63351,88899,88070,81037,87427,26361,94238,88281,28898,106345,106105,7339,113623,8345,107748,448,18781,109113,15167,35224,42596,107706,83696,49208,96603,41433,75583,84243,40723,108651,102984,15102,23259,41813,54553,34233,69428,79392,75754,15643,77355,92000,12940,61985,64898,18847,12087,68730,105571,18217,78077,52043,36194,57388,92097,85383,95906,76894,70826,45598,59842,43436,98568,66521,62862,44375,62164,70554,4627,14715,97588,77182,23763,107294,44248,66080,109055,68176,49082,109801,14441,38053,44768,43527,115319,20308,89967,66314,33856,31};

/* multiplication inverses of omega_256,512,768,1536, respectively (in Montgomery form) */
static const uint64_t omega_256_inv[128]={51196,43527,109055,14715,98568,85383,105571,92000,54553,84243,42596,8345,94238,81697,39937,117198,84307,12932,37941,96160,18761,115615,49253,57060,45842,41373,42977,9161,70841,104227,5306,24402,43881,63249,74929,101807,62519,58465,45126,18420,96259,32011,6163,41138,92763,114858,104440,83990,100725,90934,75552,108729,47543,21734,97769,41764,39158,64309,56711,30194,79568,21408,12324,83203,51544,502,3869,39950,52036,9006,83547,10373,100444,43768,56488,74418,42973,11015,39423,618,68376,4888,99872,72344,58088,42456,73235,59065,3572,200,25573,33351,94711,39871,29516,39002,18342,14139,10725,55565,88273,67059,83089,104383,51273,66974,63350,87252,8064,47072,62633,5626,112628,73588,72859,115068,7105,77613,40503,91403,35580,66890,102284,18839,79462,70539,7658,116980};
static const uint64_t omega_512_inv[256]={51196,56575,43527,93230,109055,75813,14715,46892,98568,27790,85383,11092,105571,62870,92000,73186,54553,22640,84243,32657,42596,61561,8345,29406,94238,89987,81697,100531,39937,62580,117198,89328,84307,110295,12932,31340,37941,21489,96160,33917,18761,68916,115615,109417,49253,83474,57060,103345,45842,59294,41373,74840,42977,83922,9161,13970,70841,29920,104227,88294,5306,116462,24402,70624,43881,27397,63249,15838,74929,110286,101807,94648,62519,9935,58465,66911,45126,33414,18420,6374,96259,2476,32011,35104,6163,50970,41138,30005,92763,108033,114858,15320,104440,113833,83990,47299,100725,16555,90934,73639,75552,108357,108729,101692,47543,56685,21734,42245,97769,111897,41764,116724,39158,67460,64309,74635,56711,1530,30194,483,79568,71812,21408,68124,12324,3417,83203,12906,51544,49992,502,10216,3869,114077,39950,52478,52036,40685,9006,7046,83547,45823,10373,109316,100444,71151,43768,78815,56488,74741,74418,70672,42973,5149,11015,38035,39423,52591,618,47446,68376,7557,4888,104657,99872,42547,72344,90193,58088,5050,42456,24785,73235,43770,59065,55561,3572,90127,200,35641,25573,97753,33351,49180,94711,31759,39871,4692,29516,72445,39002,70411,18342,66986,14139,57788,10725,63233,55565,82345,88273,94408,67059,2902,83089,74199,104383,85343,51273,5838,66974,14366,63350,82920,87252,5305,8064,84002,47072,95163,62633,66915,5626,31560,112628,37792,73588,106085,72859,90307,115068,70484,7105,92287,77613,98938,40503,32161,91403,54911,35580,36583,66890,15955,102284,115193,18839,8304,79462,54105,70539,55345,7658,71970,116980,113164};
static const uint64_t omega_768_inv[768]={51196,38331,16166,43527,33668,76531,109055,6918,68918,14715,105151,108490,98568,50124,99183,85383,67307,96013,105571,86414,27759,92000,41658,84597,54553,88289,115063,84243,59643,68559,42596,90488,97477,8345,45727,58833,94238,35539,111104,81697,26757,70324,39937,75932,48174,117198,50872,24948,84307,75428,27356,12932,47930,93978,37941,19769,83934,96160,3226,8408,18761,42298,5901,115615,28195,44302,49253,784,45525,57060,109708,10893,45842,7732,95970,41373,82681,106826,42977,56945,42536,9161,40008,36155,70841,25153,96060,104227,109748,65111,5306,107465,39803,24402,42042,61034,43881,28578,96261,63249,673,31084,74929,102020,21872,101807,22930,33806,62519,16515,61228,58465,92179,6342,45126,30723,17308,18420,11786,20306,96259,96020,50009,32011,83651,61473,6163,80442,70194,41138,89401,108429,92763,17323,68320,114858,72490,30844,104440,108690,14839,83990,6483,41094,100725,11091,113157,90934,4197,5806,75552,6195,29198,108729,26306,68122,47543,107561,4344,21734,115819,115470,97769,72972,57324,41764,3556,41751,39158,7616,104320,64309,18174,21337,56711,92007,104369,30194,110445,57762,79568,80088,75284,21408,16934,114674,12324,75382,71451,83203,69251,58038,51544,13281,65631,502,53589,35329,3869,57965,5819,39950,40330,82309,52036,112452,111094,9006,36891,74959,83547,109743,87902,10373,50646,61608,100444,61906,66758,43768,46908,45193,56488,20374,46502,74418,18491,90282,42973,4214,22935,11015,57452,73334,39423,100696,72315,618,45239,12393,68376,25181,110358,4888,96770,61276,99872,90845,102367,72344,57667,39505,58088,60180,80884,42456,18998,2807,73235,64902,59095,59065,77538,107940,3572,16129,117562,200,34544,33866,25573,73984,33418,33351,7586,4520,94711,32079,33894,39871,92918,20440,29516,102152,106173,39002,80021,49519,18342,107125,52042,14139,81359,6225,10725,78327,12401,55565,64383,106650,88273,22412,5839,67059,20062,73039,83089,44830,31638,104383,37343,1639,51273,18514,9098,66974,52690,40905,63350,60696,23349,87252,16378,117991,8064,96542,12434,47072,78250,32218,62633,40936,87628,5626,68117,70334,112628,65798,43539,73588,17061,103493,72859,75654,108969,115068,61452,54576,7105,20791,14446,77613,2621,45840,40503,27033,42300,91403,66279,27268,35580,89800,16493,66890,9796,102376,102284,72201,94470,18839,65232,92438,79462,42856,88086,70539,6108,94597,7658,7494,92710,116980,74721,80287,67077,79942,102107,74746,84605,41742,9218,111355,49355,103558,13122,9783,19705,68149,19090,32890,50966,22260,12702,31859,90514,26273,76615,33676,63720,29984,3210,34030,58630,49714,75677,27785,20796,109928,72546,59440,24035,82734,7169,36576,91516,47949,78336,42341,70099,1075,67401,93325,33966,42845,90917,105341,70343,24295,80332,98504,34339,22113,115047,109865,99512,75975,112372,2658,90078,73971,69020,117489,72748,61213,8565,107380,72431,110541,22303,76900,35592,11447,75296,61328,75737,109112,78265,82118,47432,93120,22213,14046,8525,53162,112967,10808,78470,93871,76231,57239,74392,89695,22012,55024,117600,87189,43344,16253,96401,16466,95343,84467,55754,101758,57045,59808,26094,111931,73147,87550,100965,99853,106487,97967,22014,22253,68264,86262,34622,56800,112110,37831,48079,77135,28872,9844,25510,100950,49953,3415,45783,87429,13833,9583,103434,34283,111790,77179,17548,107182,5116,27339,114076,112467,42721,112078,89075,9544,91967,50151,70730,10712,113929,96539,2454,2803,20504,45301,60949,76509,114717,76522,79115,110657,13953,53964,100099,96936,61562,26266,13904,88079,7828,60511,38705,38185,42989,96865,101339,3599,105949,42891,46822,35070,49022,60235,66729,104992,52642,117771,64684,82944,114404,60308,112454,78323,77943,35964,66237,5821,7179,109267,81382,43314,34726,8530,30371,107900,67627,56665,17829,56367,51515,74505,71365,73080,61785,97899,71771,43855,99782,27991,75300,114059,95338,107258,60821,44939,78850,17577,45958,117655,73034,105880,49897,93092,7915,113385,21503,56997,18401,27428,15906,45929,60606,78768,60185,58093,37389,75817,99275,115466,45038,53371,59178,59208,40735,10333,114701,102144,711,118073,83729,84407,92700,44289,84855,84922,110687,113753,23562,86194,84379,78402,25355,97833,88757,16121,12100,79271,38252,68754,99931,11148,66231,104134,36914,112048,107548,39946,105872,62708,53890,11623,30000,95861,112434,51214,98211,45234,35184,73443,86635,13890,80930,116634,67000,99759,109175,51299,65583,77368,54923,57577,94924,31021,101895,282,110209,21731,105839,71201,40023,86055,55640,77337,30645,112647,50156,47939,5645,52475,74734,44685,101212,14780,45414,42619,9304,3205,56821,63697,111168,97482,103827,40660,115652,72433,77770,91240,75973,26870,51994,91005,82693,28473,101780,51383,108477,15897,15989,46072,23803,99434,53041,25835,38811,75417,30187,47734,112165,23676,110615,110779,25563,1293,43552,37986};
static const uint64_t omega_1536_inv[1536]={51196,50206,38331,56575,16166,73248,43527,29300,33668,93230,76531,112176,109055,20845,6918,75813,68918,46544,14715,95865,105151,46892,108490,70815,98568,96357,50124,27790,99183,116278,85383,104861,67307,11092,96013,37635,105571,66266,86414,62870,27759,1445,92000,36689,41658,73186,84597,99017,54553,85097,88289,22640,115063,54681,84243,1586,59643,32657,68559,24915,42596,92800,90488,61561,97477,101788,8345,38572,45727,29406,58833,12189,94238,99374,35539,89987,111104,86639,81697,66621,26757,100531,70324,114780,39937,49556,75932,62580,48174,22320,117198,94029,50872,89328,24948,62704,84307,1159,75428,110295,27356,31854,12932,113305,47930,31340,93978,19796,37941,55481,19769,21489,83934,49848,96160,8934,3226,33917,8408,76960,18761,116919,42298,68916,5901,47486,115615,36214,28195,109417,44302,107290,49253,9577,784,83474,45525,64018,57060,114571,109708,103345,10893,14180,45842,60055,7732,59294,95970,50858,41373,17799,82681,74840,106826,81917,42977,88410,56945,83922,42536,56240,9161,62696,40008,13970,36155,71093,70841,35562,25153,29920,96060,105698,104227,75233,109748,88294,65111,92272,5306,79176,107465,116462,39803,46754,24402,84827,42042,70624,61034,91753,43881,8458,28578,27397,96261,109901,63249,100999,673,15838,31084,95686,74929,82208,102020,110286,21872,1914,101807,98771,22930,94648,33806,59045,62519,50429,16515,9935,61228,12842,58465,103349,92179,66911,6342,79656,45126,57440,30723,33414,17308,98893,18420,106258,11786,6374,20306,112155,96259,69258,96020,2476,50009,115414,32011,69173,83651,35104,61473,83280,6163,49434,80442,50970,70194,74991,41138,32303,89401,30005,108429,73070,92763,107367,17323,108033,68320,76406,114858,87465,72490,15320,30844,67719,104440,86748,108690,113833,14839,13725,83990,5122,6483,47299,41094,84341,100725,109686,11091,16555,113157,115446,90934,17929,4197,73639,5806,68448,75552,28155,6195,108357,29198,89789,108729,19324,26306,101692,68122,74031,47543,32074,107561,56685,4344,44938,21734,36099,115819,42245,115470,105558,97769,3743,72972,111897,57324,38889,41764,98351,3556,116724,41751,11581,39158,8553,7616,67460,104320,13628,64309,116103,18174,74635,21337,70164,56711,59611,92007,1530,104369,4061,30194,105320,110445,483,57762,69231,79568,30929,80088,71812,75284,22551,21408,34578,16934,68124,114674,14772,12324,58225,75382,3417,71451,13012,83203,38093,69251,12906,58038,861,51544,25708,13281,49992,65631,14882,502,29915,53589,10216,35329,80300,3869,31475,57965,114077,5819,36945,39950,18053,40330,52478,82309,84714,52036,88954,112452,40685,111094,1697,9006,47098,36891,7046,74959,100488,83547,50582,109743,45823,87902,23374,10373,91570,50646,109316,61608,47267,100444,17312,61906,71151,66758,31387,43768,18452,46908,78815,45193,58841,56488,81427,20374,74741,46502,107396,74418,46809,18491,70672,90282,14887,42973,7124,4214,5149,22935,18846,11015,9670,57452,38035,73334,17081,39423,12329,100696,52591,72315,66384,618,21749,45239,47446,12393,100269,68376,31680,25181,7557,110358,65744,4888,100445,96770,104657,61276,42090,99872,102441,90845,42547,102367,6330,72344,5206,57667,90193,39505,22870,58088,70752,60180,5050,80884,44325,42456,86342,18998,24785,2807,94001,73235,75030,64902,43770,59095,14137,59065,114130,77538,55561,107940,11652,3572,87049,16129,90127,117562,39856,200,43018,34544,35641,33866,95605,25573,49294,73984,97753,33418,98594,33351,97193,7586,49180,4520,73332,94711,72194,32079,31759,33894,73242,39871,9340,92918,4692,20440,114957,29516,47011,102152,72445,106173,117690,39002,31770,80021,70411,49519,92811,18342,58730,107125,66986,52042,92610,14139,99708,81359,57788,6225,8364,10725,30085,78327,63233,12401,26295,55565,70953,64383,82345,106650,53523,88273,52315,22412,94408,5839,88556,67059,57099,20062,2902,73039,113298,83089,86902,44830,74199,31638,117862,104383,52016,37343,85343,1639,13089,51273,18276,18514,5838,9098,24308,66974,44730,52690,14366,40905,87450,63350,83693,60696,82920,23349,34564,87252,60975,16378,5305,117991,64714,8064,64471,96542,84002,12434,46403,47072,99897,78250,95163,32218,77032,62633,1620,40936,66915,87628,14114,5626,77041,68117,31560,70334,81449,112628,69079,65798,37792,43539,36612,73588,93003,17061,106085,103493,61650,72859,3618,75654,90307,108969,47291,115068,97152,61452,70484,54576,20263,7105,32061,20791,92287,14446,10803,77613,101261,2621,98938,45840,19412,40503,79044,27033,32161,42300,109559,91403,27736,66279,54911,27268,17657,35580,36121,89800,36583,16493,35954,66890,111819,9796,15955,102376,11814,102284,34604,72201,115193,94470,83042,18839,46174,65232,8304,92438,67031,79462,5764,42856,54105,88086,96067,70539,48665,6108,55345,94597,2730,7658,93052,7494,71970,92710,35648,116980,40043,74721,113164,80287,35372,67077,68067,79942,61698,102107,45025,74746,88973,84605,25043,41742,6097,9218,97428,111355,42460,49355,71729,103558,22408,13122,71381,9783,47458,19705,21916,68149,90483,19090,1995,32890,13412,50966,107181,22260,80638,12702,52007,31859,55403,90514,116828,26273,81584,76615,45087,33676,19256,63720,33176,29984,95633,3210,63592,34030,116687,58630,85616,49714,93358,75677,25473,27785,56712,20796,16485,109928,79701,72546,88867,59440,106084,24035,18899,82734,28286,7169,31634,36576,51652,91516,17742,47949,3493,78336,68717,42341,55693,70099,95953,1075,24244,67401,28945,93325,55569,33966,117114,42845,7978,90917,86419,105341,4968,70343,86933,24295,98477,80332,62792,98504,96784,34339,68425,22113,109339,115047,84356,109865,41313,99512,1354,75975,49357,112372,70787,2658,82059,90078,8856,73971,10983,69020,108696,117489,34799,72748,54255,61213,3702,8565,14928,107380,104093,72431,58218,110541,58979,22303,67415,76900,100474,35592,43433,11447,36356,75296,29863,61328,34351,75737,62033,109112,55577,78265,104303,82118,47180,47432,82711,93120,88353,22213,12575,14046,43040,8525,29979,53162,26001,112967,39097,10808,1811,78470,71519,93871,33446,76231,47649,57239,26520,74392,109815,89695,90876,22012,8372,55024,17274,117600,102435,87189,22587,43344,36065,16253,7987,96401,116359,16466,19502,95343,23625,84467,59228,55754,67844,101758,108338,57045,105431,59808,14924,26094,51362,111931,38617,73147,60833,87550,84859,100965,19380,99853,12015,106487,111899,97967,6118,22014,49015,22253,115797,68264,2859,86262,49100,34622,83169,56800,34993,112110,68839,37831,67303,48079,43282,77135,85970,28872,88268,9844,45203,25510,10906,100950,10240,49953,41867,3415,30808,45783,102953,87429,50554,13833,31525,9583,4440,103434,104548,34283,113151,111790,70974,77179,33932,17548,8587,107182,101718,5116,2827,27339,100344,114076,44634,112467,49825,42721,90118,112078,9916,89075,28484,9544,98949,91967,16581,50151,44242,70730,86199,10712,61588,113929,73335,96539,82174,2454,76028,2803,12715,20504,114530,45301,6376,60949,79384,76509,19922,114717,1549,76522,106692,79115,109720,110657,50813,13953,104645,53964,2170,100099,43638,96936,48109,61562,58662,26266,116743,13904,114212,88079,12953,7828,117790,60511,49042,38705,87344,38185,46461,42989,95722,96865,83695,101339,50149,3599,103501,105949,60048,42891,114856,46822,105261,35070,80180,49022,105367,60235,117412,66729,92565,104992,68281,52642,103391,117771,88358,64684,108057,82944,37973,114404,86798,60308,4196,112454,81328,78323,100220,77943,65795,35964,33559,66237,29319,5821,77588,7179,116576,109267,71175,81382,111227,43314,17785,34726,67691,8530,72450,30371,94899,107900,26703,67627,8957,56665,71006,17829,100961,56367,47122,51515,86886,74505,99821,71365,39458,73080,59432,61785,36846,97899,43532,71771,10877,43855,71464,99782,47601,27991,103386,75300,111149,114059,113124,95338,99427,107258,108603,60821,80238,44939,101192,78850,105944,17577,65682,45958,51889,117655,96524,73034,70827,105880,18004,49897,86593,93092,110716,7915,52529,113385,17828,21503,13616,56997,76183,18401,15832,27428,75726,15906,111943,45929,113067,60606,28080,78768,95403,60185,47521,58093,113223,37389,73948,75817,31931,99275,93488,115466,24272,45038,43243,53371,74503,59178,104136,59208,4143,40735,62712,10333,106621,114701,31224,102144,28146,711,78417,118073,75255,83729,82632,84407,22668,92700,68979,44289,20520,84855,19679,84922,21080,110687,69093,113753,44941,23562,46079,86194,86514,84379,45031,78402,108933,25355,113581,97833,3316,88757,71262,16121,45828,12100,583,79271,86503,38252,47862,68754,25462,99931,59543,11148,51287,66231,25663,104134,18565,36914,60485,112048,109909,107548,88188,39946,55040,105872,91978,62708,47320,53890,35928,11623,64750,30000,65958,95861,23865,112434,29717,51214,61174,98211,115371,45234,4975,35184,31371,73443,44074,86635,411,13890,66257,80930,32930,116634,105184,67000,99997,99759,112435,109175,93965,51299,73543,65583,103907,77368,30823,54923,34580,57577,35353,94924,83709,31021,57298,101895,112968,282,53559,110209,53802,21731,34271,105839,71870,71201,18376,40023,23110,86055,41241,55640,116653,77337,51358,30645,104159,112647,41232,50156,86713,47939,36824,5645,49194,52475,80481,74734,81661,44685,25270,101212,12188,14780,56623,45414,114655,42619,27966,9304,70982,3205,21121,56821,47789,63697,98010,111168,86212,97482,25986,103827,107470,40660,17012,115652,19335,72433,98861,77770,39229,91240,86112,75973,8714,26870,90537,51994,63362,91005,100616,82693,82152,28473,81690,101780,82319,51383,6454,108477,102318,15897,106459,15989,83669,46072,3080,23803,35231,99434,72099,53041,109969,25835,51242,38811,112509,75417,64168,30187,22206,47734,69608,112165,62928,23676,115543,110615,25221,110779,46303,25563,82625,1293,78230,43552,5109,37986,82901};

static const __m256i V_B4Q_B4Q_B4Q_B4Q = {BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q};
static const __m256i V_B8Q_B8Q_B8Q_B8Q = {BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q};
static const __m256i V_B16Q_B16Q_B16Q_B16Q = {BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q};
static const __m256i V_Q_Q_Q_Q = {Q, Q, Q, Q};
static const __m256i V_Q2_Q2_Q2_Q2 = {Q2, Q2, Q2, Q2};
static const __m256i V_MM_MM_MM_MM = {MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK};
static const __m256i V_MF_MF_MF_MF = {MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint64_t *a)
{
uint64_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* bit reverse step of dimension 512 */
static void bit_reverse_512(uint64_t *a)
{
uint64_t t;
t=a[1];a[1]=a[256];a[256]=t;
t=a[2];a[2]=a[128];a[128]=t;
t=a[3];a[3]=a[384];a[384]=t;
t=a[4];a[4]=a[64];a[64]=t;
t=a[5];a[5]=a[320];a[320]=t;
t=a[6];a[6]=a[192];a[192]=t;
t=a[7];a[7]=a[448];a[448]=t;
t=a[8];a[8]=a[32];a[32]=t;
t=a[9];a[9]=a[288];a[288]=t;
t=a[10];a[10]=a[160];a[160]=t;
t=a[11];a[11]=a[416];a[416]=t;
t=a[12];a[12]=a[96];a[96]=t;
t=a[13];a[13]=a[352];a[352]=t;
t=a[14];a[14]=a[224];a[224]=t;
t=a[15];a[15]=a[480];a[480]=t;
t=a[17];a[17]=a[272];a[272]=t;
t=a[18];a[18]=a[144];a[144]=t;
t=a[19];a[19]=a[400];a[400]=t;
t=a[20];a[20]=a[80];a[80]=t;
t=a[21];a[21]=a[336];a[336]=t;
t=a[22];a[22]=a[208];a[208]=t;
t=a[23];a[23]=a[464];a[464]=t;
t=a[24];a[24]=a[48];a[48]=t;
t=a[25];a[25]=a[304];a[304]=t;
t=a[26];a[26]=a[176];a[176]=t;
t=a[27];a[27]=a[432];a[432]=t;
t=a[28];a[28]=a[112];a[112]=t;
t=a[29];a[29]=a[368];a[368]=t;
t=a[30];a[30]=a[240];a[240]=t;
t=a[31];a[31]=a[496];a[496]=t;
t=a[33];a[33]=a[264];a[264]=t;
t=a[34];a[34]=a[136];a[136]=t;
t=a[35];a[35]=a[392];a[392]=t;
t=a[36];a[36]=a[72];a[72]=t;
t=a[37];a[37]=a[328];a[328]=t;
t=a[38];a[38]=a[200];a[200]=t;
t=a[39];a[39]=a[456];a[456]=t;
t=a[41];a[41]=a[296];a[296]=t;
t=a[42];a[42]=a[168];a[168]=t;
t=a[43];a[43]=a[424];a[424]=t;
t=a[44];a[44]=a[104];a[104]=t;
t=a[45];a[45]=a[360];a[360]=t;
t=a[46];a[46]=a[232];a[232]=t;
t=a[47];a[47]=a[488];a[488]=t;
t=a[49];a[49]=a[280];a[280]=t;
t=a[50];a[50]=a[152];a[152]=t;
t=a[51];a[51]=a[408];a[408]=t;
t=a[52];a[52]=a[88];a[88]=t;
t=a[53];a[53]=a[344];a[344]=t;
t=a[54];a[54]=a[216];a[216]=t;
t=a[55];a[55]=a[472];a[472]=t;
t=a[57];a[57]=a[312];a[312]=t;
t=a[58];a[58]=a[184];a[184]=t;
t=a[59];a[59]=a[440];a[440]=t;
t=a[60];a[60]=a[120];a[120]=t;
t=a[61];a[61]=a[376];a[376]=t;
t=a[62];a[62]=a[248];a[248]=t;
t=a[63];a[63]=a[504];a[504]=t;
t=a[65];a[65]=a[260];a[260]=t;
t=a[66];a[66]=a[132];a[132]=t;
t=a[67];a[67]=a[388];a[388]=t;
t=a[69];a[69]=a[324];a[324]=t;
t=a[70];a[70]=a[196];a[196]=t;
t=a[71];a[71]=a[452];a[452]=t;
t=a[73];a[73]=a[292];a[292]=t;
t=a[74];a[74]=a[164];a[164]=t;
t=a[75];a[75]=a[420];a[420]=t;
t=a[76];a[76]=a[100];a[100]=t;
t=a[77];a[77]=a[356];a[356]=t;
t=a[78];a[78]=a[228];a[228]=t;
t=a[79];a[79]=a[484];a[484]=t;
t=a[81];a[81]=a[276];a[276]=t;
t=a[82];a[82]=a[148];a[148]=t;
t=a[83];a[83]=a[404];a[404]=t;
t=a[85];a[85]=a[340];a[340]=t;
t=a[86];a[86]=a[212];a[212]=t;
t=a[87];a[87]=a[468];a[468]=t;
t=a[89];a[89]=a[308];a[308]=t;
t=a[90];a[90]=a[180];a[180]=t;
t=a[91];a[91]=a[436];a[436]=t;
t=a[92];a[92]=a[116];a[116]=t;
t=a[93];a[93]=a[372];a[372]=t;
t=a[94];a[94]=a[244];a[244]=t;
t=a[95];a[95]=a[500];a[500]=t;
t=a[97];a[97]=a[268];a[268]=t;
t=a[98];a[98]=a[140];a[140]=t;
t=a[99];a[99]=a[396];a[396]=t;
t=a[101];a[101]=a[332];a[332]=t;
t=a[102];a[102]=a[204];a[204]=t;
t=a[103];a[103]=a[460];a[460]=t;
t=a[105];a[105]=a[300];a[300]=t;
t=a[106];a[106]=a[172];a[172]=t;
t=a[107];a[107]=a[428];a[428]=t;
t=a[109];a[109]=a[364];a[364]=t;
t=a[110];a[110]=a[236];a[236]=t;
t=a[111];a[111]=a[492];a[492]=t;
t=a[113];a[113]=a[284];a[284]=t;
t=a[114];a[114]=a[156];a[156]=t;
t=a[115];a[115]=a[412];a[412]=t;
t=a[117];a[117]=a[348];a[348]=t;
t=a[118];a[118]=a[220];a[220]=t;
t=a[119];a[119]=a[476];a[476]=t;
t=a[121];a[121]=a[316];a[316]=t;
t=a[122];a[122]=a[188];a[188]=t;
t=a[123];a[123]=a[444];a[444]=t;
t=a[125];a[125]=a[380];a[380]=t;
t=a[126];a[126]=a[252];a[252]=t;
t=a[127];a[127]=a[508];a[508]=t;
t=a[129];a[129]=a[258];a[258]=t;
t=a[131];a[131]=a[386];a[386]=t;
t=a[133];a[133]=a[322];a[322]=t;
t=a[134];a[134]=a[194];a[194]=t;
t=a[135];a[135]=a[450];a[450]=t;
t=a[137];a[137]=a[290];a[290]=t;
t=a[138];a[138]=a[162];a[162]=t;
t=a[139];a[139]=a[418];a[418]=t;
t=a[141];a[141]=a[354];a[354]=t;
t=a[142];a[142]=a[226];a[226]=t;
t=a[143];a[143]=a[482];a[482]=t;
t=a[145];a[145]=a[274];a[274]=t;
t=a[147];a[147]=a[402];a[402]=t;
t=a[149];a[149]=a[338];a[338]=t;
t=a[150];a[150]=a[210];a[210]=t;
t=a[151];a[151]=a[466];a[466]=t;
t=a[153];a[153]=a[306];a[306]=t;
t=a[154];a[154]=a[178];a[178]=t;
t=a[155];a[155]=a[434];a[434]=t;
t=a[157];a[157]=a[370];a[370]=t;
t=a[158];a[158]=a[242];a[242]=t;
t=a[159];a[159]=a[498];a[498]=t;
t=a[161];a[161]=a[266];a[266]=t;
t=a[163];a[163]=a[394];a[394]=t;
t=a[165];a[165]=a[330];a[330]=t;
t=a[166];a[166]=a[202];a[202]=t;
t=a[167];a[167]=a[458];a[458]=t;
t=a[169];a[169]=a[298];a[298]=t;
t=a[171];a[171]=a[426];a[426]=t;
t=a[173];a[173]=a[362];a[362]=t;
t=a[174];a[174]=a[234];a[234]=t;
t=a[175];a[175]=a[490];a[490]=t;
t=a[177];a[177]=a[282];a[282]=t;
t=a[179];a[179]=a[410];a[410]=t;
t=a[181];a[181]=a[346];a[346]=t;
t=a[182];a[182]=a[218];a[218]=t;
t=a[183];a[183]=a[474];a[474]=t;
t=a[185];a[185]=a[314];a[314]=t;
t=a[187];a[187]=a[442];a[442]=t;
t=a[189];a[189]=a[378];a[378]=t;
t=a[190];a[190]=a[250];a[250]=t;
t=a[191];a[191]=a[506];a[506]=t;
t=a[193];a[193]=a[262];a[262]=t;
t=a[195];a[195]=a[390];a[390]=t;
t=a[197];a[197]=a[326];a[326]=t;
t=a[199];a[199]=a[454];a[454]=t;
t=a[201];a[201]=a[294];a[294]=t;
t=a[203];a[203]=a[422];a[422]=t;
t=a[205];a[205]=a[358];a[358]=t;
t=a[206];a[206]=a[230];a[230]=t;
t=a[207];a[207]=a[486];a[486]=t;
t=a[209];a[209]=a[278];a[278]=t;
t=a[211];a[211]=a[406];a[406]=t;
t=a[213];a[213]=a[342];a[342]=t;
t=a[215];a[215]=a[470];a[470]=t;
t=a[217];a[217]=a[310];a[310]=t;
t=a[219];a[219]=a[438];a[438]=t;
t=a[221];a[221]=a[374];a[374]=t;
t=a[222];a[222]=a[246];a[246]=t;
t=a[223];a[223]=a[502];a[502]=t;
t=a[225];a[225]=a[270];a[270]=t;
t=a[227];a[227]=a[398];a[398]=t;
t=a[229];a[229]=a[334];a[334]=t;
t=a[231];a[231]=a[462];a[462]=t;
t=a[233];a[233]=a[302];a[302]=t;
t=a[235];a[235]=a[430];a[430]=t;
t=a[237];a[237]=a[366];a[366]=t;
t=a[239];a[239]=a[494];a[494]=t;
t=a[241];a[241]=a[286];a[286]=t;
t=a[243];a[243]=a[414];a[414]=t;
t=a[245];a[245]=a[350];a[350]=t;
t=a[247];a[247]=a[478];a[478]=t;
t=a[249];a[249]=a[318];a[318]=t;
t=a[251];a[251]=a[446];a[446]=t;
t=a[253];a[253]=a[382];a[382]=t;
t=a[255];a[255]=a[510];a[510]=t;
t=a[259];a[259]=a[385];a[385]=t;
t=a[261];a[261]=a[321];a[321]=t;
t=a[263];a[263]=a[449];a[449]=t;
t=a[265];a[265]=a[289];a[289]=t;
t=a[267];a[267]=a[417];a[417]=t;
t=a[269];a[269]=a[353];a[353]=t;
t=a[271];a[271]=a[481];a[481]=t;
t=a[275];a[275]=a[401];a[401]=t;
t=a[277];a[277]=a[337];a[337]=t;
t=a[279];a[279]=a[465];a[465]=t;
t=a[281];a[281]=a[305];a[305]=t;
t=a[283];a[283]=a[433];a[433]=t;
t=a[285];a[285]=a[369];a[369]=t;
t=a[287];a[287]=a[497];a[497]=t;
t=a[291];a[291]=a[393];a[393]=t;
t=a[293];a[293]=a[329];a[329]=t;
t=a[295];a[295]=a[457];a[457]=t;
t=a[299];a[299]=a[425];a[425]=t;
t=a[301];a[301]=a[361];a[361]=t;
t=a[303];a[303]=a[489];a[489]=t;
t=a[307];a[307]=a[409];a[409]=t;
t=a[309];a[309]=a[345];a[345]=t;
t=a[311];a[311]=a[473];a[473]=t;
t=a[315];a[315]=a[441];a[441]=t;
t=a[317];a[317]=a[377];a[377]=t;
t=a[319];a[319]=a[505];a[505]=t;
t=a[323];a[323]=a[389];a[389]=t;
t=a[327];a[327]=a[453];a[453]=t;
t=a[331];a[331]=a[421];a[421]=t;
t=a[333];a[333]=a[357];a[357]=t;
t=a[335];a[335]=a[485];a[485]=t;
t=a[339];a[339]=a[405];a[405]=t;
t=a[343];a[343]=a[469];a[469]=t;
t=a[347];a[347]=a[437];a[437]=t;
t=a[349];a[349]=a[373];a[373]=t;
t=a[351];a[351]=a[501];a[501]=t;
t=a[355];a[355]=a[397];a[397]=t;
t=a[359];a[359]=a[461];a[461]=t;
t=a[363];a[363]=a[429];a[429]=t;
t=a[367];a[367]=a[493];a[493]=t;
t=a[371];a[371]=a[413];a[413]=t;
t=a[375];a[375]=a[477];a[477]=t;
t=a[379];a[379]=a[445];a[445]=t;
t=a[383];a[383]=a[509];a[509]=t;
t=a[391];a[391]=a[451];a[451]=t;
t=a[395];a[395]=a[419];a[419]=t;
t=a[399];a[399]=a[483];a[483]=t;
t=a[407];a[407]=a[467];a[467]=t;
t=a[411];a[411]=a[435];a[435]=t;
t=a[415];a[415]=a[499];a[499]=t;
t=a[423];a[423]=a[459];a[459]=t;
t=a[431];a[431]=a[491];a[491]=t;
t=a[439];a[439]=a[475];a[475]=t;
t=a[447];a[447]=a[507];a[507]=t;
t=a[463];a[463]=a[487];a[487]=t;
t=a[479];a[479]=a[503];a[503]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint64_t *a, uint32_t n, const uint64_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	__m256i u, v, t, t1, o, u1, v1, r1, r2;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			j_omega = 0;

			for (j = j1; j < j2; j += 4)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = _mm256_loadu_si256((__m256i *)(a + j));
				v = _mm256_loadu_si256((__m256i *)(a + j + d));
				
				t = _mm256_add_epi64(u, v);
				t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
				t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				r1 = _mm256_sub_epi64(t, t1);
				
				t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
				t = _mm256_sub_epi64(t, v);
				o = _mm256_set_epi64x(omega[j_omega + num_of_problems * 3], omega[j_omega + num_of_problems * 2], omega[j_omega + num_of_problems], omega[j_omega]);
				t = _mm256_mul_epu32(t, o);
				t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
				t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				t1 = _mm256_add_epi64(t, t1);
				r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);

				_mm256_storeu_si256((__m256i *)(a + j), r1);
				_mm256_storeu_si256((__m256i *)(a + j + d), r2);

				j_omega += num_of_problems * 4;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k += 2)
	{
		j = k << 2;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);
		
		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		o = _mm256_set_epi64x(omega[num_of_problems], omega[0], omega[num_of_problems], omega[0]);
		t = _mm256_mul_epu32(t, o);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
		
		u = _mm256_permute2f128_si256(r1, r2, 0x20);
		v = _mm256_permute2f128_si256(r1, r2, 0x31);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
	
	for (k = 0; k < (n >> 1); k += 4)
	{
		j = k << 1;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u1 = _mm256_permute4x64_epi64(u1, 0xD8);
		v1 = _mm256_permute4x64_epi64(v1, 0xD8);
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);

		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r2 = _mm256_sub_epi64(t, t1);

		u1 = _mm256_permute2f128_si256(r1, r2, 0x20);
		v1 = _mm256_permute2f128_si256(r1, r2, 0x31);
		u = _mm256_permute4x64_epi64(u1, 0xD8);
		v = _mm256_permute4x64_epi64(v1, 0xD8);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint64_t *a, uint32_t N1, uint32_t N2, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t), void (*bit_reverse)(uint64_t *))
{
	uint32_t n1, n2;
	__m256i u, v, t, t1;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint64_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t), uint64_t inv_n, void (*bit_reverse)(uint64_t *))
{
	uint32_t i, n1, n2;
	__m256i u, v, t, t1;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i += 4)
	{
		u = _mm256_loadu_si256((__m256i *)(a + i));
		v = _mm256_set1_epi64x(inv_n);
		
		t = _mm256_mul_epu32(u, v);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
		_mm256_storeu_si256((__m256i *)(a + i), u);
	}
}

/* 256 * 4 --> 256 * 7 */
static void ntt_butterfly_1024_1792(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, c1, d1, e1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_7[0][0]);
	d1 = _mm256_mul_epu32(d, w_7[0][1]);
	e1 = _mm256_mul_epu32(e, w_7[0][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 + n2), t);
	a[N2_1792 + n2] %= Q;
	a[N2_1792 + n2 + 1] %= Q;
	a[N2_1792 + n2 + 2] %= Q;
	a[N2_1792 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_7[1][0]);
	d1 = _mm256_mul_epu32(d, w_7[1][1]);
	e1 = _mm256_mul_epu32(e, w_7[1][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 2 + n2), t);
	a[N2_1792 * 2 + n2] %= Q;
	a[N2_1792 * 2 + n2 + 1] %= Q;
	a[N2_1792 * 2 + n2 + 2] %= Q;
	a[N2_1792 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[2][0]);
	d1 = _mm256_mul_epu32(d, w_7[2][1]);
	e1 = _mm256_mul_epu32(e, w_7[2][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 3 + n2), t);
	a[N2_1792 * 3 + n2] %= Q;
	a[N2_1792 * 3 + n2 + 1] %= Q;
	a[N2_1792 * 3 + n2 + 2] %= Q;
	a[N2_1792 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[3][0]);
	d1 = _mm256_mul_epu32(d, w_7[3][1]);
	e1 = _mm256_mul_epu32(e, w_7[3][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 4 + n2), t);
	a[N2_1792 * 4 + n2] %= Q;
	a[N2_1792 * 4 + n2 + 1] %= Q;
	a[N2_1792 * 4 + n2 + 2] %= Q;
	a[N2_1792 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[4][0]);
	d1 = _mm256_mul_epu32(d, w_7[4][1]);
	e1 = _mm256_mul_epu32(e, w_7[4][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 5 + n2), t);
	a[N2_1792 * 5 + n2] %= Q;
	a[N2_1792 * 5 + n2 + 1] %= Q;
	a[N2_1792 * 5 + n2 + 2] %= Q;
	a[N2_1792 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[5][0]);
	d1 = _mm256_mul_epu32(d, w_7[5][1]);
	e1 = _mm256_mul_epu32(e, w_7[5][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 6 + n2), t);
	a[N2_1792 * 6 + n2] %= Q;
	a[N2_1792 * 6 + n2 + 1] %= Q;
	a[N2_1792 * 6 + n2 + 2] %= Q;
	a[N2_1792 * 6 + n2 + 3] %= Q;
}

/* 256 * 7 --> 256 * 3 */
static void ntt_butterfly_1792_768(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, c1, d1, e1, f1, g1, h1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 5 + n2));
	h = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 6 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);	
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_7[0][0]);
	d1 = _mm256_mul_epu32(d, w_7[0][1]);
	e1 = _mm256_mul_epu32(e, w_7[0][2]);
	f1 = _mm256_mul_epu32(f, w_7[0][3]);
	g1 = _mm256_mul_epu32(g, w_7[0][4]);
	h1 = _mm256_mul_epu32(h, w_7[0][5]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 + n2), t);
	a[N2_1792 + n2] %= Q;
	a[N2_1792 + n2 + 1] %= Q;
	a[N2_1792 + n2 + 2] %= Q;
	a[N2_1792 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_7[1][0]);
	d1 = _mm256_mul_epu32(d, w_7[1][1]);
	e1 = _mm256_mul_epu32(e, w_7[1][2]);
	f1 = _mm256_mul_epu32(f, w_7[1][3]);
	g1 = _mm256_mul_epu32(g, w_7[1][4]);
	h1 = _mm256_mul_epu32(h, w_7[1][5]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	t = _mm256_add_epi64(t, h1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 2 + n2), t);
	a[N2_1792 * 2 + n2] %= Q;
	a[N2_1792 * 2 + n2 + 1] %= Q;
	a[N2_1792 * 2 + n2 + 2] %= Q;
	a[N2_1792 * 2 + n2 + 3] %= Q;
}

/* 512 * 1 --> 512 * 3 */
static void ntt_butterfly_512_1536(uint64_t *a, uint32_t n2)
{
	__m256i t;
	
	t = _mm256_loadu_si256((__m256i *)(a + n2));
	_mm256_storeu_si256((__m256i *)(a + N2_1536 + n2), t);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 * 2 + n2), t);
}

/* 512 * 2 --> 512 * 3 */
static void ntt_butterfly_1024_1536(uint64_t *a, uint32_t n2)
{
	__m256i b, c, c1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1536 + n2));
	
	t = _mm256_add_epi64(b, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_3[0]);
	t = _mm256_add_epi64(b, c1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 + n2), t);
	a[N2_1536 + n2] %= Q;
	a[N2_1536 + n2 + 1] %= Q;
	a[N2_1536 + n2 + 2] %= Q;
	a[N2_1536 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_3[1]);
	t = _mm256_add_epi64(b, c1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 * 2 + n2), t);
	a[N2_1536 * 2 + n2] %= Q;
	a[N2_1536 * 2 + n2 + 1] %= Q;
	a[N2_1536 * 2 + n2 + 2] %= Q;
	a[N2_1536 * 2 + n2 + 3] %= Q;
}

/* 512 * 3 --> 512 * 3 */
static void ntt_butterfly_1536_1536_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1536 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1536 * 2 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_3_inv[0]);
	d1 = _mm256_mul_epu32(d, w_3_inv[1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 + n2), t);
	a[N2_1536 + n2] %= Q;
	a[N2_1536 + n2 + 1] %= Q;
	a[N2_1536 + n2 + 2] %= Q;
	a[N2_1536 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_3_inv[1]);
	d1 = _mm256_mul_epu32(d, w_3_inv[0]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1536 * 2 + n2), t);
	a[N2_1536 * 2 + n2] %= Q;
	a[N2_1536 * 2 + n2 + 1] %= Q;
	a[N2_1536 * 2 + n2 + 2] %= Q;
	a[N2_1536 * 2 + n2 + 3] %= Q;	
}

/* 256 * 3 --> 256 * 3 */
static void ntt_butterfly_768_768_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_768 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_768 * 2 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_3_inv[0]);
	d1 = _mm256_mul_epu32(d, w_3_inv[1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_768 + n2), t);
	a[N2_768 + n2] %= Q;
	a[N2_768 + n2 + 1] %= Q;
	a[N2_768 + n2 + 2] %= Q;
	a[N2_768 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_3_inv[1]);
	d1 = _mm256_mul_epu32(d, w_3_inv[0]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_768 * 2 + n2), t);
	a[N2_768 * 2 + n2] %= Q;
	a[N2_768 * 2 + n2 + 1] %= Q;
	a[N2_768 * 2 + n2 + 2] %= Q;
	a[N2_768 * 2 + n2 + 3] %= Q;	
}

/* 256 * 3 --> 256 * 1 */
static void ntt_butterfly_768_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_768 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_768 * 2 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

/* 256 * 6 --> 256 * 7 */
static void ntt_butterfly_1536_1792(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, c1, d1, e1, f1, g1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 5 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_7[0][0]);
	d1 = _mm256_mul_epu32(d, w_7[0][1]);
	e1 = _mm256_mul_epu32(e, w_7[0][2]);
	f1 = _mm256_mul_epu32(f, w_7[0][3]);
	g1 = _mm256_mul_epu32(g, w_7[0][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 + n2), t);
	a[N2_1792 + n2] %= Q;
	a[N2_1792 + n2 + 1] %= Q;
	a[N2_1792 + n2 + 2] %= Q;
	a[N2_1792 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_7[1][0]);
	d1 = _mm256_mul_epu32(d, w_7[1][1]);
	e1 = _mm256_mul_epu32(e, w_7[1][2]);
	f1 = _mm256_mul_epu32(f, w_7[1][3]);
	g1 = _mm256_mul_epu32(g, w_7[1][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 2 + n2), t);
	a[N2_1792 * 2 + n2] %= Q;
	a[N2_1792 * 2 + n2 + 1] %= Q;
	a[N2_1792 * 2 + n2 + 2] %= Q;
	a[N2_1792 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[2][0]);
	d1 = _mm256_mul_epu32(d, w_7[2][1]);
	e1 = _mm256_mul_epu32(e, w_7[2][2]);
	f1 = _mm256_mul_epu32(f, w_7[2][3]);
	g1 = _mm256_mul_epu32(g, w_7[2][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 3 + n2), t);
	a[N2_1792 * 3 + n2] %= Q;
	a[N2_1792 * 3 + n2 + 1] %= Q;
	a[N2_1792 * 3 + n2 + 2] %= Q;
	a[N2_1792 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[3][0]);
	d1 = _mm256_mul_epu32(d, w_7[3][1]);
	e1 = _mm256_mul_epu32(e, w_7[3][2]);
	f1 = _mm256_mul_epu32(f, w_7[3][3]);
	g1 = _mm256_mul_epu32(g, w_7[3][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 4 + n2), t);
	a[N2_1792 * 4 + n2] %= Q;
	a[N2_1792 * 4 + n2 + 1] %= Q;
	a[N2_1792 * 4 + n2 + 2] %= Q;
	a[N2_1792 * 4 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[4][0]);
	d1 = _mm256_mul_epu32(d, w_7[4][1]);
	e1 = _mm256_mul_epu32(e, w_7[4][2]);
	f1 = _mm256_mul_epu32(f, w_7[4][3]);
	g1 = _mm256_mul_epu32(g, w_7[4][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 5 + n2), t);
	a[N2_1792 * 5 + n2] %= Q;
	a[N2_1792 * 5 + n2 + 1] %= Q;
	a[N2_1792 * 5 + n2 + 2] %= Q;
	a[N2_1792 * 5 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_7[5][0]);
	d1 = _mm256_mul_epu32(d, w_7[5][1]);
	e1 = _mm256_mul_epu32(e, w_7[5][2]);
	f1 = _mm256_mul_epu32(f, w_7[5][3]);
	g1 = _mm256_mul_epu32(g, w_7[5][4]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	t = _mm256_add_epi64(t, g1);
	_mm256_storeu_si256((__m256i *)(a + N2_1792 * 6 + n2), t);
	a[N2_1792 * 6 + n2] %= Q;
	a[N2_1792 * 6 + n2 + 1] %= Q;
	a[N2_1792 * 6 + n2 + 2] %= Q;
	a[N2_1792 * 6 + n2 + 3] %= Q;
}

/* 256 * 7 --> 256 * 1 */
static void ntt_butterfly_1792_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, g, h, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1792 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 4 + n2));
	g = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 5 + n2));
	h = _mm256_loadu_si256((__m256i *)(a + N2_1792 * 6 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t = _mm256_add_epi64(t, g);
	t = _mm256_add_epi64(t, h);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

void ntt_1024_1792(uint64_t *a)
{
	ntt_core(a, N1_1792, N2_1792, omega_256, omega_1792, ntt_butterfly_1024_1792, bit_reverse_256);
}

void intt_1792_768(uint64_t *a)
{
	intt_core(a, N1_1792, N2_1792, 768, omega_256, omega_1792, ntt_butterfly_1792_768, INV_1792, bit_reverse_256);
}

void ntt_512_1536(uint64_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_512, omega_1536, ntt_butterfly_512_1536, bit_reverse_512);
}

void ntt_1024_1536(uint64_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_512, omega_1536, ntt_butterfly_1024_1536, bit_reverse_512);
}

void intt_1536_1536_inv(uint64_t *a)
{
	intt_core(a, N1_1536, N2_1536, 1536, omega_512_inv, omega_1536_inv, ntt_butterfly_1536_1536_inv, INV_1536, bit_reverse_512);
}

void ntt_768_768_inv(uint64_t *a)
{
	ntt_core(a, N1_768, N2_768, omega_256_inv, omega_768_inv, ntt_butterfly_768_768_inv, bit_reverse_256);
}

void intt_768_256(uint64_t *a)
{
	intt_core(a, N1_768, N2_768, 256, omega_256, omega_768, ntt_butterfly_768_256, INV_768, bit_reverse_256);
}

void ntt_1536_1792(uint64_t *a)
{
	ntt_core(a, N1_1792, N2_1792, omega_256, omega_1792, ntt_butterfly_1536_1792, bit_reverse_256);
}

void intt_1792_256(uint64_t *a)
{
	intt_core(a, N1_1792, N2_1792, 256, omega_256, omega_1792, ntt_butterfly_1792_256, INV_1792, bit_reverse_256);
}
