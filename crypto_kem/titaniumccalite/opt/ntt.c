/* ****************************** *
 * Titanium_CCA_lite              *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>

/* 768=3*256 */
#define N1_768 3
#define N2_768 256

/* 1280=5*256 */
#define N1_1280 5
#define N2_1280 256

/* 1536=6*256 */
#define N1_1536 6
#define N2_1536 256

/* multiplication inverses of 768, 1280, 1536 */
#define INV_768 115051
#define INV_1280 115111
#define INV_1536 115126

/* omega_n: n-th root of unity mod Q */
static const uint32_t w_3[2]={57151,58049};

static const uint32_t w_5[4][4]={{16512,80578,47587,85724},
{80578,85724,16512,47587},
{47587,16512,85724,80578},
{85724,47587,80578,16512}};

static const uint32_t w_6[5][5]={{57152,57151,115200,58049,58050},
{57151,58049,1,57151,58049},
{115200,1,115200,1,115200},
{58049,57151,1,58049,57151},
{58050,58049,115200,57151,57152}};

/* omega_256,768,1280,1536, respectively */
static const uint32_t omega_256[128]={1,539,60119,32660,93188,696,29541,24861,36763,685,23612,54758,23106,12426,15956,75410,95238,68837,8421,46080,68905,45073,102137,100966,45802,34264,36136,8335,114927,82716,1137,36838,41110,39698,85037,100146,64626,42712,96769,87639,5011,51306,5694,73840,55415,31626,111867,46190,12994,91706,8305,98757,7161,58146,6022,20230,75076,30413,34065,44076,25558,66843,85665,93035,33430,47414,96725,63923,9398,111879,52658,43216,22822,89752,107109,16050,10875,101575,28450,12817,111504,80935,77987,101829,50155,76511,112672,19281,24369,1977,28794,83032,56260,26277,108781,110851,74571,103821,87034,24519,82827,60966,28389,95139,15476,47092,38368,59373,91370,57603,58948,92697,81650,2568,1740,16252,4552,34307,59313,59030,21694,57765,31065,39890,73324,7693,114492,78653};
static const uint32_t omega_768[768]={1,13192,75354,539,83227,65054,60119,46164,43002,32660,114181,22677,93188,26225,11597,696,80753,29929,29541,95090,3591,24861,104266,92333,36763,96487,655,685,50842,7442,23612,101201,94404,54758,57266,80115,23106,107707,96811,12426,107970,110277,15956,19325,110788,75410,48085,40614,95238,112791,2756,68837,83422,103072,8421,36068,28926,46080,86884,38979,68905,58870,43099,45073,50655,74960,102137,408,83090,100966,104711,87522,45802,105940,57149,34264,77165,44644,36136,4374,101308,8335,53566,114939,114927,71824,89184,82716,5600,31359,1137,23174,83155,36838,49078,7356,41110,72013,48050,39698,107471,93926,85037,95967,52875,100146,964,44978,64626,58792,50932,42712,8613,34510,96769,34367,53529,87639,91653,51881,5011,94939,85217,51306,22877,81965,5694,4196,57152,73840,72825,46261,55415,84335,51263,31626,67371,97718,111867,24654,23145,46190,40391,33447,12994,112961,56577,91706,59851,81939,8305,3409,43138,98757,109436,95981,7161,3092,8510,58146,53774,94051,6022,68735,5049,20230,68644,71788,75076,19595,101397,30413,78414,47709,34065,101580,25328,44076,31145,58074,25558,83010,82415,66843,44402,69300,85665,86071,27576,93035,81467,2535,33430,19132,99154,47414,59259,105943,96725,29924,78782,63923,896,69530,9398,22140,36345,111879,67757,5785,52658,2306,7688,43216,90924,111797,22822,47611,8460,89752,87707,67101,107109,41663,109526,16050,107363,51602,10875,37755,50037,101575,74569,12909,28450,102743,45891,12817,81997,82235,111504,74400,87481,80935,11652,35050,77987,59574,114187,101829,84508,29459,50155,45417,95864,76511,57151,60648,112672,45722,87389,19281,106345,100663,24369,65058,112887,1977,45158,19965,28794,32751,47442,83032,27036,111817,56260,57078,19240,26277,6375,2270,108781,95296,71520,110851,100099,72146,74571,39293,63957,103821,97144,27724,87034,59362,82307,24519,85441,11088,82827,87500,101181,60966,45291,46486,28389,104438,57337,95139,73994,30775,15476,23220,113982,47092,73872,34165,38368,72663,97976,59373,112218,47006,91370,4977,107215,57603,32980,73184,58948,35266,47434,92697,209,107505,81650,112651,114293,2568,7962,86593,1740,29081,17222,16252,7323,66578,4552,30263,58031,34307,68416,59238,59313,11904,18605,59030,80201,5608,21694,27964,27486,57765,96466,69226,31065,39523,102891,39890,105913,46568,73324,62612,101535,7693,109176,6890,114492,93354,27278,78653,90170,72315,115200,102009,39847,114662,31974,50147,55082,69037,72199,82541,1020,92524,22013,88976,103604,114505,34448,85272,85660,20111,111610,90340,10935,22868,78438,18714,114546,114516,64359,107759,91589,14000,20797,60443,57935,35086,92095,7494,18390,102775,7231,4924,99245,95876,4413,39791,67116,74587,19963,2410,112445,46364,31779,12129,106780,79133,86275,69121,28317,76222,46296,56331,72102,70128,64546,40241,13064,114793,32111,14235,10490,27679,69399,9261,58052,80937,38036,70557,79065,110827,13893,106866,61635,262,274,43377,26017,32485,109601,83842,114064,92027,32046,78363,66123,107845,74091,43188,67151,75503,7730,21275,30164,19234,62326,15055,114237,70223,50575,56409,64269,72489,106588,80691,18432,80834,61672,27562,23548,63320,110190,20262,29984,63895,92324,33236,109507,111005,58049,41361,42376,68940,59786,30866,63938,83575,47830,17483,3334,90547,92056,69011,74810,81754,102207,2240,58624,23495,55350,33262,106896,111792,72063,16444,5765,19220,108040,112109,106691,57055,61427,21150,109179,46466,110152,94971,46557,43413,40125,95606,13804,84788,36787,67492,81136,13621,89873,71125,84056,57127,89643,32191,32786,48358,70799,45901,29536,29130,87625,22166,33734,112666,81771,96069,16047,67787,55942,9258,18476,85277,36419,51278,114305,45671,105803,93061,78856,3322,47444,109416,62543,112895,107513,71985,24277,3404,92379,67590,106741,25449,27494,48100,8092,73538,5675,99151,7838,63599,104326,77446,65164,13626,40632,102292,86751,12458,69310,102384,33204,32966,3697,40801,27720,34266,103549,80151,37214,55627,1014,13372,30693,85742,65046,69784,19337,38690,58050,54553,2529,69479,27812,95920,8856,14538,90832,50143,2314,113224,70043,95236,86407,82450,67759,32169,88165,3384,58941,58123,95961,88924,108826,112931,6420,19905,43681,4350,15102,43055,40630,75908,51244,11380,18057,87477,28167,55839,32894,90682,29760,104113,32374,27701,14020,54235,69910,68715,86812,10763,57864,20062,41207,84426,99725,91981,1219,68109,41329,81036,76833,42538,17225,55828,2983,68195,23831,110224,7986,57598,82221,42017,56253,79935,67767,22504,114992,7696,33551,2550,908,112633,107239,28608,113461,86120,97979,98949,107878,48623,110649,84938,57170,80894,46785,55963,55888,103297,96596,56171,35000,109593,93507,87237,87715,57436,18735,45975,84136,75678,12310,75311,9288,68633,41877,52589,13666,107508,6025,108311,709,21847,87923,36548,25031,42886};
static const uint32_t omega_1280[1280]={1,4959,53868,95494,78636,539,23278,4200,91620,106037,60119,105134,74981,77152,14247,32660,103535,94409,112568,75867,93188,48081,82810,78426,111159,696,110635,51803,108048,10181,29541,73348,43175,61367,73112,24861,20629,723,14126,8626,36763,59735,44094,10648,41374,685,56086,35260,94423,66793,23612,47692,112176,90356,58715,54758,16165,97540,87062,82311,23106,72860,42404,39611,13244,12426,103200,45958,38144,111255,15956,97918,3147,53838,61925,75410,15744,83419,103231,84486,95238,76343,34451,114627,33559,68837,22120,21728,36217,1744,8421,56977,76091,51994,18408,46080,67137,1493,30923,14626,68905,13729,113521,78553,49746,45073,27067,16088,61300,86462,102137,73787,31357,93214,61814,100966,26848,82077,14710,24657,45802,70947,2319,95022,42008,34264,108902,97931,67614,62916,36136,60869,22751,40430,42630,8335,91307,51483,18781,52571,114927,23646,101097,100472,111524,82716,73084,1210,9938,91715,1137,108735,76185,57336,13156,36838,86057,52159,30236,63823,41110,73921,4657,53863,70699,39698,99074,90902,1505,90431,85037,62823,35753,4788,12286,100146,107704,32300,46310,55697,64626,106353,14349,77674,68423,42712,69370,15644,48323,15677,96769,65306,22443,10671,40230,87639,63629,672,106820,26182,5011,81334,16605,90681,57576,51306,62646,79618,31835,44395,5694,12301,59330,109317,82298,73840,63782,68193,54152,6237,55415,48600,6908,42075,20914,31626,44773,36980,99029,98149,111867,55638,2447,38568,25052,46190,36622,51722,51972,24511,12994,39887,114717,19065,78515,91706,71707,84727,23146,40818,8305,57738,48257,33986,112712,98757,16512,90298,1495,40841,7161,29491,55800,114599,9908,58146,113112,8739,21125,41166,6022,26039,102281,96677,69882,20230,95700,63381,38051,110872,75076,87453,62863,3711,85890,30413,19958,14063,41812,99109,34065,43669,91892,72473,81688,44076,36587,108559,9808,23050,25558,21022,106394,102467,97443,66843,41160,91469,48434,105322,85665,66648,110964,70500,89666,93035,95761,20277,98371,60755,33430,5131,100409,29509,29861,47414,785,91182,7613,82140,96725,77512,71472,71372,36276,63923,76206,46274,107575,83795,9398,63478,58270,36822,6713,111879,115146,72858,32486,47076,52658,85556,102122,114603,29744,43216,34284,92881,23281,19077,22822,46916,65625,106751,29614,89752,58705,5168,53490,64208,107109,76921,20728,30860,47812,16050,103260,113096,44596,80845,10875,15057,17415,75436,29477,101575,51653,55404,109252,105566,28450,77526,25697,19117,105981,12817,83752,26563,51174,99264,111504,98737,32533,49747,50032,80935,111582,24735,87001,10214,77987,7776,84050,6732,90899,101829,44028,28957,57317,34136,50155,114887,55688,19995,82345,76511,61156,63572,63612,31570,112672,15598,50611,72171,81683,19281,112850,91893,77432,20355,24369,22,109098,33086,27250,1977,11858,51312,92400,57223,28794,55407,8928,36768,84530,83032,27314,88951,3380,57275,56260,91719,20973,93805,112558,26277,15312,14749,102857,73036,108781,73897,842,28242,82863,110851,86138,108235,15906,80370,74571,2379,46959,48460,3854,103821,15070,81882,84514,3688,87034,58660,12415,48651,29415,24519,52666,10027,72262,72148,82827,47528,105307,11280,65035,60966,42970,81581,89468,32761,28389,5429,80578,69234,32426,95139,46206,765,107203,82263,15476,21618,66732,66716,102573,47092,16801,25836,17212,105568,38368,70061,101484,61188,107059,59373,92152,94602,32846,104301,91370,18297,71636,78241,151,57603,69998,19469,8333,81389,58948,58195,10500,113849,92291,92697,32433,14651,77679,93218,81650,86036,63221,51018,16866,2568,62602,91824,80864,105096,1740,103786,71907,39718,83053,16252,68169,50337,95817,67579,4552,109173,59408,35315,21565,34307,91737,110235,26620,103435,59313,25014,88150,63256,109382,59030,4029,50038,110689,89187,21694,98013,13448,102454,32976,57765,66949,106010,41427,33110,31065,27598,114895,95360,105336,39890,14393,65468,19394,97212,73324,39360,35746,85276,96014,7693,18056,28527,113766,26297,114492,55300,54320,32942,4360,78653,84842,17426,14784,46020,115200,110242,61333,19707,36565,114662,91923,111001,23581,9164,55082,10067,40220,38049,100954,82541,11666,20792,2633,39334,22013,67120,32391,36775,4042,114505,4566,63398,7153,105020,85660,41853,72026,53834,42089,90340,94572,114478,101075,106575,78438,55466,71107,104553,73827,114516,59115,79941,20778,48408,91589,67509,3025,24845,56486,60443,99036,17661,28139,32890,92095,42341,72797,75590,101957,102775,12001,69243,77057,3946,99245,17283,112054,61363,53276,39791,99457,31782,11970,30715,19963,38858,80750,574,81642,46364,93081,93473,78984,113457,106780,58224,39110,63207,96793,69121,48064,113708,84278,100575,46296,101472,1680,36648,65455,70128,88134,99113,53901,28739,13064,41414,83844,21987,53387,14235,88353,33124,100491,90544,69399,44254,112882,20179,73193,80937,6299,17270,47587,52285,79065,54332,92450,74771,72571,106866,23894,63718,96420,62630,274,91555,14104,14729,3677,32485,42117,113991,105263,23486,114064,6466,39016,57865,102045,78363,29144,63042,84965,51378,74091,41280,110544,61338,44502,75503,16127,24299,113696,24770,30164,52378,79448,110413,102915,15055,7497,82901,68891,59504,50575,8848,100852,37527,46778,72489,45831,99557,66878,99524,18432,49895,92758,104530,74971,27562,51572,114529,8381,89019,110190,33867,98596,24520,57625,63895,52555,35583,83366,70806,109507,102900,55871,5884,32903,41361,51419,47008,61049,108964,59786,66601,108293,73126,94287,83575,70428,78221,16172,17052,3334,59563,112754,76633,90149,69011,78579,63479,63229,90690,102207,75314,484,96136,36686,23495,43494,30474,92055,74383,106896,57463,66944,81215,2489,16444,98689,24903,113706,74360,108040,85710,59401,602,105293,57055,2089,106462,94076,74035,109179,89162,12920,18524,45319,94971,19501,51820,77150,4329,40125,27748,52338,111490,29311,84788,95243,101138,73389,16092,81136,71532,23309,42728,33513,71125,78614,6642,105393,92151,89643,94179,8807,12734,17758,48358,74041,23732,66767,9879,29536,48553,4237,44701,25535,22166,19440,94924,16830,54446,81771,110070,14792,85692,85340,67787,114416,24019,107588,33061,18476,37689,43729,43829,78925,51278,38995,68927,7626,31406,105803,51723,56931,78379,108488,3322,55,42343,82715,68125,62543,29645,13079,598,85457,71985,80917,22320,91920,96124,92379,68285,49576,8450,85587,25449,56496,110033,61711,50993,8092,38280,94473,84341,67389,99151,11941,2105,70605,34356,104326,100144,97786,39765,85724,13626,63548,59797,5949,9635,86751,37675,89504,96084,9220,102384,31449,88638,64027,15937,3697,16464,82668,65454,65169,34266,3619,90466,28200,104987,37214,107425,31151,108469,24302,13372,71173,86244,57884,81065,65046,314,59513,95206,32856,38690,54045,51629,51589,83631,2529,99603,64590,43030,33518,95920,2351,23308,37769,94846,90832,115179,6103,82115,87951,113224,103343,63889,22801,57978,86407,59794,106273,78433,30671,32169,87887,26250,111821,57926,58941,23482,94228,21396,2643,88924,99889,100452,12344,42165,6420,41304,114359,86959,32338,4350,29063,6966,99295,34831,40630,112822,68242,66741,111347,11380,100131,33319,30687,111513,28167,56541,102786,66550,85786,90682,62535,105174,42939,43053,32374,67673,9894,103921,50166,54235,72231,33620,25733,82440,86812,109772,34623,45967,82775,20062,68995,114436,7998,32938,99725,93583,48469,48485,12628,68109,98400,89365,97989,9633,76833,45140,13717,54013,8142,55828,23049,20599,82355,10900,23831,96904,43565,36960,115050,57598,45203,95732,106868,33812,56253,57006,104701,1352,22910,22504,82768,100550,37522,21983,33551,29165,51980,64183,98335,112633,52599,23377,34337,10105,113461,11415,43294,75483,32148,98949,47032,64864,19384,47622,110649,6028,55793,79886,93636,80894,23464,4966,88581,11766,55888,90187,27051,51945,5819,56171,111172,65163,4512,26014,93507,17188,101753,12747,82225,57436,48252,9191,73774,82091,84136,87603,306,19841,9865,75311,100808,49733,95807,17989,41877,75841,79455,29925,19187,107508,97145,86674,1435,88904,709,59901,60881,82259,110841,36548,30359,97775,100417,69181};
static const uint32_t omega_1536[1536]={1,5516,13192,75241,75354,7456,539,93099,83227,4147,65054,101950,60119,67926,46164,46414,43002,173,32660,93397,114181,18529,22677,93247,93188,113347,26225,79845,11597,32497,696,37503,80753,66482,29929,5331,29541,53942,95090,6287,3591,108585,24861,44086,104266,47864,92333,5207,36763,30948,96487,108873,655,41749,685,92028,50842,45238,7442,38516,23612,66662,101201,75871,94404,23944,54758,103307,57266,113315,80115,3304,23106,40390,107707,20255,96811,52841,12426,112422,107970,88551,110277,26652,15956,114933,19325,35775,110788,80504,75410,85950,48085,44158,40614,76080,95238,16248,112791,69756,2756,110765,68837,2396,83422,42958,103072,28217,8421,24233,36068,114162,28926,2431,46080,43874,86884,15984,38979,43098,68905,31881,58870,90502,43099,74421,45073,18910,50655,50555,74960,22971,102137,54802,408,61709,83090,54862,100966,46822,104711,83263,87522,79162,45802,8039,105940,65568,57149,43948,34264,70584,77165,89646,44644,71767,36136,28446,4374,49975,101308,90078,8335,10661,53566,94692,114939,52421,114927,101430,71824,4945,89184,30674,82716,65496,5600,15732,31359,59543,1137,50838,23174,69875,83155,67799,36838,99045,49078,107099,7356,24944,41110,47192,72013,10660,48050,81500,39698,92268,107471,100891,93926,36919,85037,80821,95967,5377,52875,84769,100146,16541,964,18178,44978,70895,64626,45122,58792,5857,50932,80874,42712,13347,8613,46496,34510,45108,96769,51571,34367,62727,53529,5801,87639,33328,91653,55960,51881,16312,5011,107637,94939,94979,85217,36892,51306,70240,22877,44437,81965,70216,5694,73432,4196,104936,57152,60496,73840,65905,72825,112014,46261,5461,55415,40887,84335,10222,51263,63454,31626,34702,67371,95211,97718,102210,111867,41816,24654,54284,23145,25112,46190,74629,40391,113223,33447,56851,12994,19882,112961,85868,56577,114424,91706,2705,59851,87251,81939,42001,8305,75583,3409,26281,43138,59143,98757,73284,109436,110937,95981,82601,7161,101334,3092,5724,8510,54353,58146,13752,53774,90010,94051,35213,6022,39464,68735,15769,5049,86843,20230,74112,68644,89818,71788,36771,75076,86822,19595,27482,101397,4997,30413,25452,78414,67070,47709,43760,34065,9709,101580,92817,25328,85636,44076,49106,31145,31129,58074,77404,25558,87105,83010,74386,82415,17994,66843,62788,44402,4106,69300,21882,85665,88839,86071,24315,27576,43896,93035,75806,81467,88072,2535,43739,33430,78280,19132,7996,99154,74317,47414,29354,59259,47407,105943,82116,96725,39269,29924,92952,78782,23340,63923,84208,896,103894,69530,23351,9398,114119,22140,11180,36345,29280,111879,108008,67757,35568,5785,114584,52658,39807,2306,47786,7688,13040,43216,28587,90924,66831,111797,1299,22822,86660,47611,79197,8460,8955,89752,53335,87707,62813,67101,103504,107109,62516,41663,102314,109526,31372,16050,57432,107363,81168,51602,90162,10875,81980,37755,88373,50037,97697,101575,65237,74569,55034,12909,11826,28450,26438,102743,56669,45891,38159,12817,80359,81997,16326,82235,61923,111504,113126,74400,44438,87481,83408,80935,33585,11652,105475,35050,28522,77987,15758,59574,56932,114187,51625,101829,83889,84508,42882,29459,62434,50155,57379,45417,73198,95864,13234,76511,53413,57151,54980,60648,105865,112672,104558,45722,27563,87389,36740,19281,23473,106345,110729,100663,103489,24369,95038,65058,8813,112887,23287,1977,76238,45158,26966,19965,109985,28794,80726,32751,19348,47442,68601,83032,80537,27036,60482,111817,111619,56260,93867,57078,113116,19240,27719,26277,21074,6375,28195,2270,79612,108781,69188,95296,105774,71520,56096,110851,82409,100099,102892,72146,53082,74571,66066,39293,47107,63957,41350,103821,12465,97144,46453,27724,53857,87034,36977,59362,39550,82307,113472,24519,830,85441,5265,11088,104878,82827,101767,87500,73011,101181,80752,60966,16737,45291,69388,46486,94551,28389,35565,104438,75008,57337,44147,95139,46169,73994,108962,30775,63827,15476,1675,23220,93209,113982,72855,47092,96418,73872,12015,34165,100505,38368,13651,72663,24829,97976,27725,59373,100226,112218,19515,47006,82846,91370,107746,4977,35294,107215,71207,57603,13790,32980,15301,73184,18640,58948,59946,35266,67968,47434,24473,92697,54614,209,834,107505,58033,81650,60691,112651,103923,114293,60316,2568,110566,7962,26811,86593,23642,1740,36157,29081,51004,17222,70928,16252,19654,7323,73318,66578,98661,4552,110215,30263,4459,58031,70618,34307,77370,68416,99381,59238,46772,59313,114869,11904,113095,18605,96290,59030,51454,80201,16876,5608,59860,21694,85466,27964,110486,27486,8260,57765,100975,96466,108238,69226,74502,31065,50653,39523,48576,102891,66630,39890,114531,105913,31837,46568,86059,73324,99674,62612,110395,101535,74999,7693,40620,109176,59189,6890,104111,114492,5990,93354,107395,27278,12942,78653,2982,90170,55003,72315,63678,115200,109685,102009,39960,39847,107745,114662,22102,31974,111054,50147,13251,55082,47275,69037,68787,72199,115028,82541,21804,1020,96672,92524,21954,22013,1854,88976,35356,103604,82704,114505,77698,34448,48719,85272,109870,85660,61259,20111,108914,111610,6616,90340,71115,10935,67337,22868,109994,78438,84253,18714,6328,114546,73452,114516,23173,64359,69963,107759,76685,91589,48539,14000,39330,20797,91257,60443,11894,57935,1886,35086,111897,92095,74811,7494,94946,18390,62360,102775,2779,7231,26650,4924,88549,99245,268,95876,79426,4413,34697,39791,29251,67116,71043,74587,39121,19963,98953,2410,45445,112445,4436,46364,112805,31779,72243,12129,86984,106780,90968,79133,1039,86275,112770,69121,71327,28317,99217,76222,72103,46296,83320,56331,24699,72102,40780,70128,96291,64546,64646,40241,92230,13064,60399,114793,53492,32111,60339,14235,68379,10490,31938,27679,36039,69399,107162,9261,49633,58052,71253,80937,44617,38036,25555,70557,43434,79065,86755,110827,65226,13893,25123,106866,104540,61635,20509,262,62780,274,13771,43377,110256,26017,84527,32485,49705,109601,99469,83842,55658,114064,64363,92027,45326,32046,47402,78363,16156,66123,8102,107845,90257,74091,68009,43188,104541,67151,33701,75503,22933,7730,14310,21275,78282,30164,34380,19234,109824,62326,30432,15055,98660,114237,97023,70223,44306,50575,70079,56409,109344,64269,34327,72489,101854,106588,68705,80691,70093,18432,63630,80834,52474,61672,109400,27562,81873,23548,59241,63320,98889,110190,7564,20262,20222,29984,78309,63895,44961,92324,70764,33236,44985,109507,41769,111005,10265,58049,54705,41361,49296,42376,3187,68940,109740,59786,74314,30866,104979,63938,51747,83575,80499,47830,19990,17483,12991,3334,73385,90547,60917,92056,90089,69011,40572,74810,1978,81754,58350,102207,95319,2240,29333,58624,777,23495,112496,55350,27950,33262,73200,106896,39618,111792,88920,72063,56058,16444,41917,5765,4264,19220,32600,108040,13867,112109,109477,106691,60848,57055,101449,61427,25191,21150,79988,109179,75737,46466,99432,110152,28358,94971,41089,46557,25383,43413,78430,40125,28379,95606,87719,13804,110204,84788,89749,36787,48131,67492,71441,81136,105492,13621,22384,89873,29565,71125,66095,84056,84072,57127,37797,89643,28096,32191,40815,32786,97207,48358,52413,70799,111095,45901,93319,29536,26362,29130,90886,87625,71305,22166,39395,33734,27129,112666,71462,81771,36921,96069,107205,16047,40884,67787,85847,55942,67794,9258,33085,18476,75932,85277,22249,36419,91861,51278,30993,114305,11307,45671,91850,105803,1082,93061,104021,78856,85921,3322,7193,47444,79633,109416,617,62543,75394,112895,67415,107513,102161,71985,86614,24277,48370,3404,113902,92379,28541,67590,36004,106741,106246,25449,61866,27494,52388,48100,11697,8092,52685,73538,12887,5675,83829,99151,57769,7838,34033,63599,25039,104326,33221,77446,26828,65164,17504,13626,49964,40632,60167,102292,103375,86751,88763,12458,58532,69310,77042,102384,34842,33204,98875,32966,53278,3697,2075,40801,70763,27720,31793,34266,81616,103549,9726,80151,86679,37214,99443,55627,58269,1014,63576,13372,31312,30693,72319,85742,52767,65046,57822,69784,42003,19337,101967,38690,61788,58050,60221,54553,9336,2529,10643,69479,87638,27812,78461,95920,91728,8856,4472,14538,11712,90832,20163,50143,106388,2314,91914,113224,38963,70043,88235,95236,5216,86407,34475,82450,95853,67759,46600,32169,34664,88165,54719,3384,3582,58941,21334,58123,2085,95961,87482,88924,94127,108826,87006,112931,35589,6420,46013,19905,9427,43681,59105,4350,32792,15102,12309,43055,62119,40630,49135,75908,68094,51244,73851,11380,102736,18057,68748,87477,61344,28167,78224,55839,75651,32894,1729,90682,114371,29760,109936,104113,10323,32374,13434,27701,42190,14020,34449,54235,98464,69910,45813,68715,20650,86812,79636,10763,40193,57864,71054,20062,69032,41207,6239,84426,51374,99725,113526,91981,21992,1219,42346,68109,18783,41329,103186,81036,14696,76833,101550,42538,90372,17225,87476,55828,14975,2983,95686,68195,32355,23831,7455,110224,79907,7986,43994,57598,101411,82221,99900,42017,96561,56253,55255,79935,47233,67767,90728,22504,60587,114992,114367,7696,57168,33551,54510,2550,11278,908,54885,112633,4635,107239,88390,28608,91559,113461,79044,86120,64197,97979,44273,98949,95547,107878,41883,48623,16540,110649,4986,84938,110742,57170,44583,80894,37831,46785,15820,55963,68429,55888,332,103297,2106,96596,18911,56171,63747,35000,98325,109593,55341,93507,29735,87237,4715,87715,106941,57436,14226,18735,6963,45975,40699,84136,64548,75678,66625,12310,48571,75311,670,9288,83364,68633,29142,41877,15527,52589,4806,13666,40202,107508,74581,6025,56012,108311,11090,709,109211,21847,7806,87923,102259,36548,112219,25031,60198,42886,51523};

/* multiplication inverses of omega */
static const uint32_t w_3_inv[2]={58049,57151};

static const uint32_t w_5_inv[4][4]={{85724,47587,80578,16512},
{47587,16512,85724,80578},
{80578,85724,16512,47587},
{16512,80578,47587,85724}};

static const uint32_t omega_256_inv[128]={1,36548,709,107508,41877,75311,84136,57436,93507,56171,55888,80894,110649,98949,113461,112633,33551,22504,56253,57598,23831,55828,76833,68109,99725,20062,86812,54235,32374,90682,28167,11380,40630,4350,6420,88924,58941,32169,86407,113224,90832,95920,2529,38690,65046,13372,37214,34266,3697,102384,86751,13626,104326,99151,8092,25449,92379,71985,62543,3322,105803,51278,18476,67787,81771,22166,29536,48358,89643,71125,81136,84788,40125,94971,109179,57055,108040,16444,106896,23495,102207,69011,3334,83575,59786,41361,109507,63895,110190,27562,18432,72489,50575,15055,30164,75503,74091,78363,114064,32485,274,106866,79065,80937,69399,14235,13064,70128,46296,69121,106780,46364,19963,39791,99245,102775,92095,60443,91589,114516,78438,90340,85660,114505,22013,82541,55082,114662};
static const uint32_t omega_768_inv[768]={1,42886,25031,36548,87923,21847,709,108311,6025,107508,13666,52589,41877,68633,9288,75311,12310,75678,84136,45975,18735,57436,87715,87237,93507,109593,35000,56171,96596,103297,55888,55963,46785,80894,57170,84938,110649,48623,107878,98949,97979,86120,113461,28608,107239,112633,908,2550,33551,7696,114992,22504,67767,79935,56253,42017,82221,57598,7986,110224,23831,68195,2983,55828,17225,42538,76833,81036,41329,68109,1219,91981,99725,84426,41207,20062,57864,10763,86812,68715,69910,54235,14020,27701,32374,104113,29760,90682,32894,55839,28167,87477,18057,11380,51244,75908,40630,43055,15102,4350,43681,19905,6420,112931,108826,88924,95961,58123,58941,3384,88165,32169,67759,82450,86407,95236,70043,113224,2314,50143,90832,14538,8856,95920,27812,69479,2529,54553,58050,38690,19337,69784,65046,85742,30693,13372,1014,55627,37214,80151,103549,34266,27720,40801,3697,32966,33204,102384,69310,12458,86751,102292,40632,13626,65164,77446,104326,63599,7838,99151,5675,73538,8092,48100,27494,25449,106741,67590,92379,3404,24277,71985,107513,112895,62543,109416,47444,3322,78856,93061,105803,45671,114305,51278,36419,85277,18476,9258,55942,67787,16047,96069,81771,112666,33734,22166,87625,29130,29536,45901,70799,48358,32786,32191,89643,57127,84056,71125,89873,13621,81136,67492,36787,84788,13804,95606,40125,43413,46557,94971,110152,46466,109179,21150,61427,57055,106691,112109,108040,19220,5765,16444,72063,111792,106896,33262,55350,23495,58624,2240,102207,81754,74810,69011,92056,90547,3334,17483,47830,83575,63938,30866,59786,68940,42376,41361,58049,111005,109507,33236,92324,63895,29984,20262,110190,63320,23548,27562,61672,80834,18432,80691,106588,72489,64269,56409,50575,70223,114237,15055,62326,19234,30164,21275,7730,75503,67151,43188,74091,107845,66123,78363,32046,92027,114064,83842,109601,32485,26017,43377,274,262,61635,106866,13893,110827,79065,70557,38036,80937,58052,9261,69399,27679,10490,14235,32111,114793,13064,40241,64546,70128,72102,56331,46296,76222,28317,69121,86275,79133,106780,12129,31779,46364,112445,2410,19963,74587,67116,39791,4413,95876,99245,4924,7231,102775,18390,7494,92095,35086,57935,60443,20797,14000,91589,107759,64359,114516,114546,18714,78438,22868,10935,90340,111610,20111,85660,85272,34448,114505,103604,88976,22013,92524,1020,82541,72199,69037,55082,50147,31974,114662,39847,102009,115200,72315,90170,78653,27278,93354,114492,6890,109176,7693,101535,62612,73324,46568,105913,39890,102891,39523,31065,69226,96466,57765,27486,27964,21694,5608,80201,59030,18605,11904,59313,59238,68416,34307,58031,30263,4552,66578,7323,16252,17222,29081,1740,86593,7962,2568,114293,112651,81650,107505,209,92697,47434,35266,58948,73184,32980,57603,107215,4977,91370,47006,112218,59373,97976,72663,38368,34165,73872,47092,113982,23220,15476,30775,73994,95139,57337,104438,28389,46486,45291,60966,101181,87500,82827,11088,85441,24519,82307,59362,87034,27724,97144,103821,63957,39293,74571,72146,100099,110851,71520,95296,108781,2270,6375,26277,19240,57078,56260,111817,27036,83032,47442,32751,28794,19965,45158,1977,112887,65058,24369,100663,106345,19281,87389,45722,112672,60648,57151,76511,95864,45417,50155,29459,84508,101829,114187,59574,77987,35050,11652,80935,87481,74400,111504,82235,81997,12817,45891,102743,28450,12909,74569,101575,50037,37755,10875,51602,107363,16050,109526,41663,107109,67101,87707,89752,8460,47611,22822,111797,90924,43216,7688,2306,52658,5785,67757,111879,36345,22140,9398,69530,896,63923,78782,29924,96725,105943,59259,47414,99154,19132,33430,2535,81467,93035,27576,86071,85665,69300,44402,66843,82415,83010,25558,58074,31145,44076,25328,101580,34065,47709,78414,30413,101397,19595,75076,71788,68644,20230,5049,68735,6022,94051,53774,58146,8510,3092,7161,95981,109436,98757,43138,3409,8305,81939,59851,91706,56577,112961,12994,33447,40391,46190,23145,24654,111867,97718,67371,31626,51263,84335,55415,46261,72825,73840,57152,4196,5694,81965,22877,51306,85217,94939,5011,51881,91653,87639,53529,34367,96769,34510,8613,42712,50932,58792,64626,44978,964,100146,52875,95967,85037,93926,107471,39698,48050,72013,41110,7356,49078,36838,83155,23174,1137,31359,5600,82716,89184,71824,114927,114939,53566,8335,101308,4374,36136,44644,77165,34264,57149,105940,45802,87522,104711,100966,83090,408,102137,74960,50655,45073,43099,58870,68905,38979,86884,46080,28926,36068,8421,103072,83422,68837,2756,112791,95238,40614,48085,75410,110788,19325,15956,110277,107970,12426,96811,107707,23106,80115,57266,54758,94404,101201,23612,7442,50842,685,655,96487,36763,92333,104266,24861,3591,95090,29541,29929,80753,696,11597,26225,93188,22677,114181,32660,43002,46164,60119,65054,83227,539,75354,13192};
static const uint32_t omega_1280_inv[1280]={1,69181,100417,97775,30359,36548,110841,82259,60881,59901,709,88904,1435,86674,97145,107508,19187,29925,79455,75841,41877,17989,95807,49733,100808,75311,9865,19841,306,87603,84136,82091,73774,9191,48252,57436,82225,12747,101753,17188,93507,26014,4512,65163,111172,56171,5819,51945,27051,90187,55888,11766,88581,4966,23464,80894,93636,79886,55793,6028,110649,47622,19384,64864,47032,98949,32148,75483,43294,11415,113461,10105,34337,23377,52599,112633,98335,64183,51980,29165,33551,21983,37522,100550,82768,22504,22910,1352,104701,57006,56253,33812,106868,95732,45203,57598,115050,36960,43565,96904,23831,10900,82355,20599,23049,55828,8142,54013,13717,45140,76833,9633,97989,89365,98400,68109,12628,48485,48469,93583,99725,32938,7998,114436,68995,20062,82775,45967,34623,109772,86812,82440,25733,33620,72231,54235,50166,103921,9894,67673,32374,43053,42939,105174,62535,90682,85786,66550,102786,56541,28167,111513,30687,33319,100131,11380,111347,66741,68242,112822,40630,34831,99295,6966,29063,4350,32338,86959,114359,41304,6420,42165,12344,100452,99889,88924,2643,21396,94228,23482,58941,57926,111821,26250,87887,32169,30671,78433,106273,59794,86407,57978,22801,63889,103343,113224,87951,82115,6103,115179,90832,94846,37769,23308,2351,95920,33518,43030,64590,99603,2529,83631,51589,51629,54045,38690,32856,95206,59513,314,65046,81065,57884,86244,71173,13372,24302,108469,31151,107425,37214,104987,28200,90466,3619,34266,65169,65454,82668,16464,3697,15937,64027,88638,31449,102384,9220,96084,89504,37675,86751,9635,5949,59797,63548,13626,85724,39765,97786,100144,104326,34356,70605,2105,11941,99151,67389,84341,94473,38280,8092,50993,61711,110033,56496,25449,85587,8450,49576,68285,92379,96124,91920,22320,80917,71985,85457,598,13079,29645,62543,68125,82715,42343,55,3322,108488,78379,56931,51723,105803,31406,7626,68927,38995,51278,78925,43829,43729,37689,18476,33061,107588,24019,114416,67787,85340,85692,14792,110070,81771,54446,16830,94924,19440,22166,25535,44701,4237,48553,29536,9879,66767,23732,74041,48358,17758,12734,8807,94179,89643,92151,105393,6642,78614,71125,33513,42728,23309,71532,81136,16092,73389,101138,95243,84788,29311,111490,52338,27748,40125,4329,77150,51820,19501,94971,45319,18524,12920,89162,109179,74035,94076,106462,2089,57055,105293,602,59401,85710,108040,74360,113706,24903,98689,16444,2489,81215,66944,57463,106896,74383,92055,30474,43494,23495,36686,96136,484,75314,102207,90690,63229,63479,78579,69011,90149,76633,112754,59563,3334,17052,16172,78221,70428,83575,94287,73126,108293,66601,59786,108964,61049,47008,51419,41361,32903,5884,55871,102900,109507,70806,83366,35583,52555,63895,57625,24520,98596,33867,110190,89019,8381,114529,51572,27562,74971,104530,92758,49895,18432,99524,66878,99557,45831,72489,46778,37527,100852,8848,50575,59504,68891,82901,7497,15055,102915,110413,79448,52378,30164,24770,113696,24299,16127,75503,44502,61338,110544,41280,74091,51378,84965,63042,29144,78363,102045,57865,39016,6466,114064,23486,105263,113991,42117,32485,3677,14729,14104,91555,274,62630,96420,63718,23894,106866,72571,74771,92450,54332,79065,52285,47587,17270,6299,80937,73193,20179,112882,44254,69399,90544,100491,33124,88353,14235,53387,21987,83844,41414,13064,28739,53901,99113,88134,70128,65455,36648,1680,101472,46296,100575,84278,113708,48064,69121,96793,63207,39110,58224,106780,113457,78984,93473,93081,46364,81642,574,80750,38858,19963,30715,11970,31782,99457,39791,53276,61363,112054,17283,99245,3946,77057,69243,12001,102775,101957,75590,72797,42341,92095,32890,28139,17661,99036,60443,56486,24845,3025,67509,91589,48408,20778,79941,59115,114516,73827,104553,71107,55466,78438,106575,101075,114478,94572,90340,42089,53834,72026,41853,85660,105020,7153,63398,4566,114505,4042,36775,32391,67120,22013,39334,2633,20792,11666,82541,100954,38049,40220,10067,55082,9164,23581,111001,91923,114662,36565,19707,61333,110242,115200,46020,14784,17426,84842,78653,4360,32942,54320,55300,114492,26297,113766,28527,18056,7693,96014,85276,35746,39360,73324,97212,19394,65468,14393,39890,105336,95360,114895,27598,31065,33110,41427,106010,66949,57765,32976,102454,13448,98013,21694,89187,110689,50038,4029,59030,109382,63256,88150,25014,59313,103435,26620,110235,91737,34307,21565,35315,59408,109173,4552,67579,95817,50337,68169,16252,83053,39718,71907,103786,1740,105096,80864,91824,62602,2568,16866,51018,63221,86036,81650,93218,77679,14651,32433,92697,92291,113849,10500,58195,58948,81389,8333,19469,69998,57603,151,78241,71636,18297,91370,104301,32846,94602,92152,59373,107059,61188,101484,70061,38368,105568,17212,25836,16801,47092,102573,66716,66732,21618,15476,82263,107203,765,46206,95139,32426,69234,80578,5429,28389,32761,89468,81581,42970,60966,65035,11280,105307,47528,82827,72148,72262,10027,52666,24519,29415,48651,12415,58660,87034,3688,84514,81882,15070,103821,3854,48460,46959,2379,74571,80370,15906,108235,86138,110851,82863,28242,842,73897,108781,73036,102857,14749,15312,26277,112558,93805,20973,91719,56260,57275,3380,88951,27314,83032,84530,36768,8928,55407,28794,57223,92400,51312,11858,1977,27250,33086,109098,22,24369,20355,77432,91893,112850,19281,81683,72171,50611,15598,112672,31570,63612,63572,61156,76511,82345,19995,55688,114887,50155,34136,57317,28957,44028,101829,90899,6732,84050,7776,77987,10214,87001,24735,111582,80935,50032,49747,32533,98737,111504,99264,51174,26563,83752,12817,105981,19117,25697,77526,28450,105566,109252,55404,51653,101575,29477,75436,17415,15057,10875,80845,44596,113096,103260,16050,47812,30860,20728,76921,107109,64208,53490,5168,58705,89752,29614,106751,65625,46916,22822,19077,23281,92881,34284,43216,29744,114603,102122,85556,52658,47076,32486,72858,115146,111879,6713,36822,58270,63478,9398,83795,107575,46274,76206,63923,36276,71372,71472,77512,96725,82140,7613,91182,785,47414,29861,29509,100409,5131,33430,60755,98371,20277,95761,93035,89666,70500,110964,66648,85665,105322,48434,91469,41160,66843,97443,102467,106394,21022,25558,23050,9808,108559,36587,44076,81688,72473,91892,43669,34065,99109,41812,14063,19958,30413,85890,3711,62863,87453,75076,110872,38051,63381,95700,20230,69882,96677,102281,26039,6022,41166,21125,8739,113112,58146,9908,114599,55800,29491,7161,40841,1495,90298,16512,98757,112712,33986,48257,57738,8305,40818,23146,84727,71707,91706,78515,19065,114717,39887,12994,24511,51972,51722,36622,46190,25052,38568,2447,55638,111867,98149,99029,36980,44773,31626,20914,42075,6908,48600,55415,6237,54152,68193,63782,73840,82298,109317,59330,12301,5694,44395,31835,79618,62646,51306,57576,90681,16605,81334,5011,26182,106820,672,63629,87639,40230,10671,22443,65306,96769,15677,48323,15644,69370,42712,68423,77674,14349,106353,64626,55697,46310,32300,107704,100146,12286,4788,35753,62823,85037,90431,1505,90902,99074,39698,70699,53863,4657,73921,41110,63823,30236,52159,86057,36838,13156,57336,76185,108735,1137,91715,9938,1210,73084,82716,111524,100472,101097,23646,114927,52571,18781,51483,91307,8335,42630,40430,22751,60869,36136,62916,67614,97931,108902,34264,42008,95022,2319,70947,45802,24657,14710,82077,26848,100966,61814,93214,31357,73787,102137,86462,61300,16088,27067,45073,49746,78553,113521,13729,68905,14626,30923,1493,67137,46080,18408,51994,76091,56977,8421,1744,36217,21728,22120,68837,33559,114627,34451,76343,95238,84486,103231,83419,15744,75410,61925,53838,3147,97918,15956,111255,38144,45958,103200,12426,13244,39611,42404,72860,23106,82311,87062,97540,16165,54758,58715,90356,112176,47692,23612,66793,94423,35260,56086,685,41374,10648,44094,59735,36763,8626,14126,723,20629,24861,73112,61367,43175,73348,29541,10181,108048,51803,110635,696,111159,78426,82810,48081,93188,75867,112568,94409,103535,32660,14247,77152,74981,105134,60119,106037,91620,4200,23278,539,78636,95494,53868,4959};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint32_t *a)
{
uint32_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint32_t *a, uint32_t n, const uint32_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	uint64_t u, v;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			u = a[j1];
			v = a[j1 + d];
			
			a[j1] = barrett_4q(u + v);
			a[j1 + d] = barrett_4q(Q2 + u - v);

			j_omega = num_of_problems;
			
			for (j = j1 + 1; j < j2; j++)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = a[j];
				v = a[j + d];
				
				a[j] = barrett_4q(u + v);
				a[j + d] = barrett_4q2((Q2 + u - v) * omega[j_omega]);
				
				j_omega += num_of_problems;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k++)
	{
		j = k << 2;
		
		u = a[j];
		v = a[j + 2];
			
		a[j] = barrett_4q(u + v);
		a[j + 2] = barrett_4q(Q2 + u - v);
		
		u = a[j + 1];
		v = a[j + 3];

		a[j + 1] = barrett_4q(u + v);
		a[j + 3] = barrett_4q2((Q2 + u - v) * omega[num_of_problems]);
	}
	
	for (k = 0; k < (n >> 1); k++)
	{
		j = k << 1;
		
		u = a[j];
		v = a[j + 1];
		
		a[j] = barrett_4q(u + v);				
		a[j + 1] = barrett_4q(Q2 + u - v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint32_t *a, uint32_t N1, uint32_t N2, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t))
{
	uint32_t n1, n2;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint32_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t), uint32_t inv_n)
{
	uint32_t i, n1, n2;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i++)
	{
		a[i] = barrett_2q2((uint64_t)a[i] * (uint64_t)inv_n);
	}
}

/* 256 * 4 --> 256 * 6 */
static void ntt_butterfly_1024_1536(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1536 + n2];
	d = a[N2_1536 * 2 + n2];
	e = a[N2_1536 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1536 + n2] = (b + c * w_6[0][0] + d * w_6[0][1] + e * w_6[0][2]) % Q;
	a[N2_1536 * 2 + n2] = (b + c * w_6[1][0] + d * w_6[1][1] + e * w_6[1][2]) % Q;
	a[N2_1536 * 3 + n2] = (b + c * w_6[2][0] + d * w_6[2][1] + e * w_6[2][2]) % Q;
	a[N2_1536 * 4 + n2] = (b + c * w_6[3][0] + d * w_6[3][1] + e * w_6[3][2]) % Q;
	a[N2_1536 * 5 + n2] = (b + c * w_6[4][0] + d * w_6[4][1] + e * w_6[4][2]) % Q;
}

/* 256 * 6 --> 256 * 3 */
static void ntt_butterfly_1536_768(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f, g;
	
	b = a[n2];
	c = a[N2_1536 + n2];
	d = a[N2_1536 * 2 + n2];
	e = a[N2_1536 * 3 + n2];
	f = a[N2_1536 * 4 + n2];
	g = a[N2_1536 * 5 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f + g);
	a[N2_1536 + n2] = (b + c * w_6[0][0] + d * w_6[0][1] + e * w_6[0][2] + f * w_6[0][3] + g * w_6[0][4]) % Q;
	a[N2_1536 * 2 + n2] = (b + c * w_6[1][0] + d * w_6[1][1] + e * w_6[1][2] + f * w_6[1][3] + g * w_6[1][4]) % Q;
}

/* 256 * 2 --> 256 * 5 */
static void ntt_butterfly_512_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	
	a[n2] = barrett_4q(b + c);
	a[N2_1280 + n2] = (b + c * w_5[0][0]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0]) % Q;
}

/* 256 * 4 --> 256 * 5 */
static void ntt_butterfly_1024_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1] + e * w_5[0][2]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0] + d * w_5[1][1] + e * w_5[1][2]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0] + d * w_5[2][1] + e * w_5[2][2]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0] + d * w_5[3][1] + e * w_5[3][2]) % Q;
}

/* 256 * 5 --> 256 * 5 */
static void ntt_butterfly_1280_1280_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	f = a[N2_1280 * 4 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f);
	a[N2_1280 + n2] = (b + c * w_5_inv[0][0] + d * w_5_inv[0][1] + e * w_5_inv[0][2] + f * w_5_inv[0][3]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5_inv[1][0] + d * w_5_inv[1][1] + e * w_5_inv[1][2] + f * w_5_inv[1][3]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5_inv[2][0] + d * w_5_inv[2][1] + e * w_5_inv[2][2] + f * w_5_inv[2][3]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5_inv[3][0] + d * w_5_inv[3][1] + e * w_5_inv[3][2] + f * w_5_inv[3][3]) % Q;
}

/* 256 * 3 --> 256 * 3 */
static void ntt_butterfly_768_768_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d;
	
	b = a[n2];
	c = a[N2_768 + n2];
	d = a[N2_768 * 2 + n2];
	
	a[n2] = barrett_8q(b + c + d);
	a[N2_768 + n2] = (b + c * w_3_inv[0] + d * w_3_inv[1]) % Q;
	a[N2_768 * 2 + n2] = (b + c * w_3_inv[1] + d * w_3_inv[0]) % Q;
}

/* 256 * 2 --> 256 * 3 */
static void ntt_butterfly_512_768(uint32_t *a, uint32_t n2)
{
	uint64_t b, c;
	
	b = a[n2];
	c = a[N2_768 + n2];
	
	a[n2] = barrett_4q(b + c);
	a[N2_768 + n2] = (b + c * w_3[0]) % Q;
	a[N2_768 * 2 + n2] = (b + c * w_3[1]) % Q;
}

/* 256 * 3 --> 256 * 1 */
static void ntt_butterfly_768_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_8q(a[n2] + a[N2_768 + n2] + a[N2_768 * 2 + n2]);
}

/* 256 * 5 --> 256 * 6 */
static void ntt_butterfly_1280_1536(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f;
	
	b = a[n2];
	c = a[N2_1536 + n2];
	d = a[N2_1536 * 2 + n2];
	e = a[N2_1536 * 3 + n2];
	f = a[N2_1536 * 4 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f);
	a[N2_1536 + n2] = (b + c * w_6[0][0] + d * w_6[0][1] + e * w_6[0][2] + f * w_6[0][3]) % Q;
	a[N2_1536 * 2 + n2] = (b + c * w_6[1][0] + d * w_6[1][1] + e * w_6[1][2] + f * w_6[1][3]) % Q;
	a[N2_1536 * 3 + n2] = (b + c * w_6[2][0] + d * w_6[2][1] + e * w_6[2][2] + f * w_6[2][3]) % Q;
	a[N2_1536 * 4 + n2] = (b + c * w_6[3][0] + d * w_6[3][1] + e * w_6[3][2] + f * w_6[3][3]) % Q;
	a[N2_1536 * 5 + n2] = (b + c * w_6[4][0] + d * w_6[4][1] + e * w_6[4][2] + f * w_6[4][3]) % Q;
}

/* 256 * 6 --> 256 * 1 */
static void ntt_butterfly_1536_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_16q(a[n2] + a[N2_1536 + n2] + a[N2_1536 * 2 + n2] + a[N2_1536 * 3 + n2] + a[N2_1536 * 4 + n2] + a[N2_1536 * 5 + n2]);	
}

void ntt_1024_1536(uint32_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_256, omega_1536, ntt_butterfly_1024_1536);
}

void intt_1536_768(uint32_t *a)
{
	intt_core(a, N1_1536, N2_1536, 768, omega_256, omega_1536, ntt_butterfly_1536_768, INV_1536);
}

void ntt_512_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_512_1280);
}

void ntt_1024_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_1024_1280);
}

void intt_1280_1280_inv(uint32_t *a)
{
	intt_core(a, N1_1280, N2_1280, 1280, omega_256_inv, omega_1280_inv, ntt_butterfly_1280_1280_inv, INV_1280);
}

void ntt_768_768_inv(uint32_t *a)
{
	ntt_core(a, N1_768, N2_768, omega_256_inv, omega_768_inv, ntt_butterfly_768_768_inv);
}

void ntt_512_768(uint32_t *a)
{
	ntt_core(a, N1_768, N2_768, omega_256, omega_768, ntt_butterfly_512_768);
}

void intt_768_256(uint32_t *a)
{
	intt_core(a, N1_768, N2_768, 256, omega_256, omega_768, ntt_butterfly_768_256, INV_768);
}

void ntt_1280_1536(uint32_t *a)
{
	ntt_core(a, N1_1536, N2_1536, omega_256, omega_1536, ntt_butterfly_1280_1536);
}

void intt_1536_256(uint32_t *a)
{
	intt_core(a, N1_1536, N2_1536, 256, omega_256, omega_1536, ntt_butterfly_1536_256, INV_1536);
}
