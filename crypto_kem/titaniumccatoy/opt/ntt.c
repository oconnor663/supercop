/* ****************************** *
 * Titanium_CCA_toy               *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>

/* 512=2*256 */
#define N1_512 2
#define N2_512 256

/* 1024=4*256 */
#define N1_1024 4
#define N2_1024 256

/* 1280=5*256 */
#define N1_1280 5
#define N2_1280 256

/* multiplication inverses of 512, 1024, 1280 */
#define INV_512 470121
#define INV_1024 470581
#define INV_1280 470673

/* omega_n: n-th root of unity mod Q */
static const uint32_t w_4[3][3]={{89491,471040,381550},
{471040,1,471040},
{381550,471040,89491}};

static const uint32_t w_5[4][4]={{29479,411837,403230,97535},
{411837,97535,29479,403230},
{403230,29479,97535,411837},
{97535,403230,411837,29479}};

/* omega_256,512,1024,1280, respectively */
static const uint32_t omega_256[128]={1,458165,455985,263205,112415,53453,401114,220701,44277,319999,359544,373445,379749,228497,465755,232632,451128,153484,228052,72042,337978,143071,59155,464558,100851,102561,223528,385023,150377,195299,217975,287219,382088,258157,106805,218540,77894,354186,120026,30745,272861,136583,224386,171358,421477,396550,106640,458916,206929,261133,413191,160779,34791,462116,455337,128115,447883,13455,96508,440191,137037,31174,401549,272133,89491,351211,271805,73450,108128,141068,413569,4061,467156,92914,83476,78586,393773,64176,346779,342276,384861,352125,279166,443496,446588,201440,281347,152359,111281,52566,46101,386225,217778,468586,50833,221282,99977,51201,193324,211861,347236,110436,98843,50314,309352,377385,49696,259023,261173,369192,29580,200089,248306,238252,157281,326144,371412,178361,219680,1525,147822,120609,60693,444992,25732,287632,245751,163562};
static const uint32_t omega_512[512]={1,69169,458165,118487,455985,63187,263205,363036,112415,159348,53453,89748,401114,339366,220701,170741,44277,358272,319999,265282,359544,218300,373445,341888,379749,199298,228497,70320,465755,371523,232632,162248,451128,432628,153484,12738,228052,378821,72042,401400,337978,306493,143071,448671,59155,230069,464558,8405,100851,116650,102561,164349,223528,229489,385023,410870,150377,370392,195299,122733,217975,32447,287219,25795,382088,418526,258157,239305,106805,259042,218540,16529,77894,83128,354186,320065,120026,451810,30745,321831,272861,322762,136583,111231,224386,225325,171358,327860,421477,415123,396550,249520,106640,151141,458916,249896,206929,20175,261133,241332,413191,66645,160779,115682,34791,381251,462116,201426,455337,461611,128115,363143,447883,194739,13455,362920,96508,239841,440191,423121,137037,425251,31174,319749,401549,281257,272133,369117,89491,53198,351211,387207,271805,291653,73450,285865,108128,387675,141068,389218,413569,305272,4061,154873,467156,242846,92914,356103,83476,401907,78586,372935,393773,351935,64176,370401,346779,6849,342276,367984,384861,39435,352125,17138,279166,249341,443496,100740,446588,118674,201440,10580,281347,373810,152359,390419,111281,385549,52566,443216,46101,283540,386225,177751,217778,66343,468586,235906,50833,217753,221282,319445,99977,427233,51201,235731,193324,115848,211861,127999,347236,57335,110436,346828,98843,182393,50314,118158,309352,60022,377385,135009,49696,236447,259023,317452,261173,181846,369192,95715,29580,287957,200089,300420,248306,451813,238252,283203,157281,277594,326144,429805,371412,91529,178361,17178,219680,205342,1525,440582,147822,283972,120609,267811,60693,156725,444992,419585,25732,263810,287632,330132,245751,365393,163562,428281,471040,401872,12876,352554,15056,407854,207836,108005,358626,311693,417588,381293,69927,131675,250340,300300,426764,112769,151042,205759,111497,252741,97596,129153,91292,271743,242544,400721,5286,99518,238409,308793,19913,38413,317557,458303,242989,92220,398999,69641,133063,164548,327970,22370,411886,240972,6483,462636,370190,354391,368480,306692,247513,241552,86018,60171,320664,100649,275742,348308,253066,438594,183822,445246,88953,52515,212884,231736,364236,211999,252501,454512,393147,387913,116855,150976,351015,19231,440296,149210,198180,148279,334458,359810,246655,245716,299683,143181,49564,55918,74491,221521,364401,319900,12125,221145,264112,450866,209908,229709,57850,404396,310262,355359,436250,89790,8925,269615,15704,9430,342926,107898,23158,276302,457586,108121,374533,231200,30850,47920,334004,45790,439867,151292,69492,189784,198908,101924,381550,417843,119830,83834,199236,179388,397591,185176,362913,83366,329973,81823,57472,165769,466980,316168,3885,228195,378127,114938,387565,69134,392455,98106,77268,119106,406865,100640,124262,464192,128765,103057,86180,431606,118916,453903,191875,221700,27545,370301,24453,352367,269601,460461,189694,97231,318682,80622,359760,85492,418475,27825,424940,187501,84816,293290,253263,404698,2455,235135,420208,253288,249759,151596,371064,43808,419840,235310,277717,355193,259180,343042,123805,413706,360605,124213,372198,288648,420727,352883,161689,411019,93656,336032,421345,234594,212018,153589,209868,289195,101849,375326,441461,183084,270952,170621,222735,19228,232789,187838,313760,193447,144897,41236,99629,379512,292680,453863,251361,265699,469516,30459,323219,187069,350432,203230,410348,314316,26049,51456,445309,207231,183409,140909,225290,105648,307479,42760};
static const uint32_t omega_1024[1024]={1,263,69169,291889,458165,381940,118487,73375,455985,279641,63187,131746,263205,450929,363036,328186,112415,360603,159348,456916,53453,397950,89748,51674,401114,450839,339366,226509,220701,106320,170741,155988,44277,339867,358272,17336,319999,314439,265282,55098,359544,351872,218300,416939,373445,239507,341888,418754,379749,13295,199298,129823,228497,272504,70320,123561,465755,22905,371523,205062,232632,417927,162248,277534,451128,415373,432628,260283,153484,327807,12738,52807,228052,155469,378821,240272,72042,105406,401400,55016,337978,332506,306493,59648,143071,415434,448671,240223,59155,13412,230069,214899,464558,179135,8405,326351,100851,145517,116650,61285,102561,124206,164349,359056,223528,378780,229489,62359,385023,458275,410870,190421,150377,452748,370392,378650,195299,20168,122733,247991,217975,331464,32447,54823,287219,172037,25795,189511,382088,157411,418526,319785,258157,65387,239305,288762,106805,298296,259042,298142,218540,9018,16529,107758,77894,231359,83128,194778,354186,355841,320065,331797,120026,7091,451810,123698,30745,78238,321831,325214,272861,164211,322762,99026,136583,122213,111231,49211,224386,133393,225325,380350,171358,318259,327860,26677,421477,153816,415123,366878,396550,192589,249520,149061,106640,254901,151141,182639,458916,108412,249896,247949,206929,252612,20175,124574,261133,377034,241332,350822,413191,329803,66645,99118,160779,362228,115682,277742,34791,200254,381251,408321,462116,7930,201426,218446,455337,109217,461611,346156,128115,250334,363143,356327,447883,32979,194739,343929,13455,241378,362920,297678,96508,416431,239841,429730,440191,365188,423121,115147,137037,241615,425251,204296,31174,191065,319749,248689,401549,94203,281257,17154,272133,443788,369117,43325,89491,455124,53198,330885,351211,44457,387207,90585,271805,357524,291653,396097,73450,4669,285865,286976,108128,175204,387675,213669,141068,359686,389218,148437,413569,429217,305272,209566,4061,125961,154873,222073,467156,391368,242846,277963,92914,413291,356103,388971,83476,286302,401907,188357,78586,413355,372935,105377,393773,404320,351935,234869,64176,391853,370401,381017,346779,291964,6849,388164,342276,49757,367984,216387,384861,415669,39435,8503,352125,284839,17138,267925,279166,409303,249341,101984,443496,292321,100740,116324,446588,163435,118674,122556,201440,222128,10580,427335,281347,40824,373810,335502,152359,31932,390419,464300,111281,62361,385549,125572,52566,164669,443216,218681,46101,348538,283540,146542,386225,303360,177751,115454,217778,279653,66343,19692,468586,296417,235906,336907,50833,179931,217753,273078,221282,259123,319445,168737,99977,386696,427233,254521,51201,276715,235731,290882,193324,442825,115848,321400,211861,136605,127999,219826,347236,412155,57335,5793,110436,311167,346828,304851,98843,88454,182393,394218,50314,43434,118158,457889,309352,340524,60022,241433,377385,333645,135009,179292,49696,351941,236447,8149,259023,293145,317452,115619,261173,387554,181846,250357,369192,63050,95715,207872,29580,242884,287957,366131,200089,337856,300420,346613,248306,300820,451813,124487,238252,11823,283203,57911,157281,384336,277594,466908,326144,46410,429805,459916,371412,175869,91529,49036,178361,275884,17178,278445,219680,308838,205342,306272,1525,401075,440582,468021,147822,251824,283972,260158,120609,160420,267811,249184,60693,417906,156725,238108,444992,214728,419585,127261,25732,172942,263810,139003,287632,280656,330132,153172,245751,99896,365393,5995,163562,152075,428281,59104,471040,470778,401872,179152,12876,89101,352554,397666,15056,191400,407854,339295,207836,20112,108005,142855,358626,110438,311693,14125,417588,73091,381293,419367,69927,20202,131675,244532,250340,364721,300300,315053,426764,131174,112769,453705,151042,156602,205759,415943,111497,119169,252741,54102,97596,231534,129153,52287,91292,457746,271743,341218,242544,198537,400721,347480,5286,448136,99518,265979,238409,53114,308793,193507,19913,55668,38413,210758,317557,143234,458303,418234,242989,315572,92220,230769,398999,365635,69641,416025,133063,138535,164548,411393,327970,55607,22370,230818,411886,457629,240972,256142,6483,291906,462636,144690,370190,325524,354391,409756,368480,346835,306692,111985,247513,92261,241552,408682,86018,12766,60171,280620,320664,18293,100649,92391,275742,450873,348308,223050,253066,139577,438594,416218,183822,299004,445246,281530,88953,313630,52515,151256,212884,405654,231736,182279,364236,172745,211999,172899,252501,462023,454512,363283,393147,239682,387913,276263,116855,115200,150976,139244,351015,463950,19231,347343,440296,392803,149210,145827,198180,306830,148279,372015,334458,348828,359810,421830,246655,337648,245716,90691,299683,152782,143181,444364,49564,317225,55918,104163,74491,278452,221521,321980,364401,216140,319900,288402,12125,362629,221145,223092,264112,218429,450866,346467,209908,94007,229709,120219,57850,141238,404396,371923,310262,108813,355359,193299,436250,270787,89790,62720,8925,463111,269615,252595,15704,361824,9430,124885,342926,220707,107898,114714,23158,438062,276302,127112,457586,229663,108121,173363,374533,54610,231200,41311,30850,105853,47920,355894,334004,229426,45790,266745,439867,279976,151292,222352,69492,376838,189784,453887,198908,27253,101924,427716,381550,15917,417843,140156,119830,426584,83834,380456,199236,113517,179388,74944,397591,466372,185176,184065,362913,295837,83366,257372,329973,111355,81823,322604,57472,41824,165769,261475,466980,345080,316168,248968,3885,79673,228195,193078,378127,57750,114938,82070,387565,184739,69134,282684,392455,57686,98106,365664,77268,66721,119106,236172,406865,79188,100640,90024,124262,179077,464192,82877,128765,421284,103057,254654,86180,55372,431606,462538,118916,186202,453903,203116,191875,61738,221700,369057,27545,178720,370301,354717,24453,307606,352367,348485,269601,248913,460461,43706,189694,430217,97231,135539,318682,439109,80622,6741,359760,408680,85492,345469,418475,306372,27825,252360,424940,122503,187501,324499,84816,167681,293290,355587,253263,191388,404698,451349,2455,174624,235135,134134,420208,291110,253288,197963,249759,211918,151596,302304,371064,84345,43808,216520,419840,194326,235310,180159,277717,28216,355193,149641,259180,334436,343042,251215,123805,58886,413706,465248,360605,159874,124213,166190,372198,382587,288648,76823,420727,427607,352883,13152,161689,130517,411019,229608,93656,137396,336032,291749,421345,119100,234594,462892,212018,177896,153589,355422,209868,83487,289195,220684,101849,407991,375326,263169,441461,228157,183084,104910,270952,133185,170621,124428,222735,170221,19228,346554,232789,459218,187838,413130,313760,86705,193447,4133,144897,424631,41236,11125,99629,295172,379512,422005,292680,195157,453863,192596,251361,162203,265699,164769,469516,69966,30459,3020,323219,219217,187069,210883,350432,310621,203230,221857,410348,53135,314316,232933,26049,256313,51456,343780,445309,298099,207231,332038,183409,190385,140909,317869,225290,371145,105648,465046,307479,318966,42760,411937};
static const uint32_t omega_1280[1280]={1,327393,325858,378350,431862,458165,304682,285620,342463,454934,455985,215057,245008,332254,135692,263205,176107,309610,362899,391918,112415,37642,352664,39196,397106,53453,22797,404617,268256,13199,401114,395412,336009,79397,95477,220701,157257,59701,314239,55158,44277,164127,28836,100826,115420,319999,261715,359013,424461,457476,359544,456015,144986,128887,377770,373445,347966,366788,399472,273887,379749,131776,365819,166248,114955,228497,412947,124556,272097,321283,465755,5236,111549,81986,313195,232632,411168,370126,422186,354222,451128,301672,250462,217245,127531,153484,346455,269015,265879,430811,228052,274731,198374,67984,327421,72042,81554,191719,303235,415195,337978,332126,152037,4989,264530,143071,126863,17984,294253,9191,59155,82200,190188,252176,359016,464558,21927,81471,338478,106358,100851,292548,458752,299645,321620,102561,66829,434429,67811,213352,223528,101703,375112,175578,461801,385023,437193,112302,254472,271908,150377,113923,95318,450765,160345,195299,420167,218278,117062,441524,217975,306634,154119,40888,401846,287219,46278,59489,149950,216289,382088,462378,403343,40859,328269,258157,379112,253598,52313,330290,106805,422812,399405,6442,215149,218540,164566,86858,427065,404638,77894,261643,338767,43694,65613,354186,441005,346809,290051,214566,120026,18875,427037,187413,374690,30745,22656,404222,13255,364523,272861,326764,240578,316503,325417,136583,395989,354329,154104,311444,224386,264461,162922,252629,290130,171358,426594,232942,158142,112291,421477,455798,227896,73851,236954,396550,315812,196534,126303,383894,106640,101641,331509,227145,85110,458916,293423,63658,445590,236047,206929,105313,421973,333581,286401,261133,116851,133587,233923,80713,413191,402519,175520,314647,326899,160779,29479,59198,28869,70852,34791,87442,381931,405146,116065,462116,355839,395525,119179,160153,455337,32843,115392,102774,87470,128115,108350,346963,307186,466352,447883,108842,328297,4341,82316,13455,368424,440803,159163,412475,96508,26487,264622,116603,430216,440191,458113,237722,298480,451985,137037,183455,386987,466080,423736,31174,104035,298127,287301,43167,401549,85944,300898,268338,10088,272133,331406,420618,436688,114228,89491,447804,152050,21729,261315,351211,88577,321637,15750,424964,271805,343850,465501,221671,246833,73450,372800,205849,272664,362960,108128,206031,35983,317950,195842,141068,47756,187236,364172,291922,413569,273290,408143,134483,119508,4061,265271,155169,414649,105939,467156,359936,199878,229211,64172,92914,36463,138896,222070,398283,83476,130289,117781,316591,402500,78586,246878,203864,434139,274123,393773,254581,158629,340824,373506,64176,460404,397813,239173,65354,346779,360122,330687,74510,252163,342276,467773,284828,119757,34825,384861,156119,79898,197102,24332,352125,214744,457937,83556,414474,279166,437967,94426,461629,127306,443496,39760,398686,131375,30624,446588,71807,394923,394772,417734,201440,66551,330088,390200,74195,281347,383944,460896,379147,407369,152359,383392,148663,443193,229332,111281,425329,125836,108647,77197,52566,257503,116704,52998,378979,46101,48971,411127,136161,251156,386225,173303,358547,5566,282850,217778,342830,21669,401457,112412,468586,317172,317269,43602,92081,50833,18798,182949,61520,446282,221282,72026,24717,159442,373168,99977,72953,167624,292527,178073,51201,383967,454279,337225,159640,193324,87244,90734,417879,98284,211861,79041,361737,91339,182383,347236,187685,398837,108413,246918,110436,279311,334811,239736,210582,98843,460640,411837,361978,329205,50314,147632,166366,121967,54379,309352,211844,165852,3602,253963,377385,95087,189542,253707,410075,49696,366388,391670,409044,243910,259023,334768,293067,329918,316228,261173,23423,449800,294611,397717,369192,342733,295336,352978,153660,29580,153021,438698,129881,317081,200089,66107,48224,318835,248432,248306,448396,370855,273896,28999,238252,2641,284678,470112,144389,157281,380477,127134,185779,46063,326144,275589,361132,326835,404472,371412,338930,181120,423875,318865,178361,132185,22871,137567,358657,219680,328114,384670,272509,18432,1525,441906,456236,429566,74232,147822,193624,328616,342647,401998,120609,117389,101687,318275,143301,60693,69805,172168,418841,394962,444992,408089,354819,422734,298965,25732,379432,448256,226812,344753,287632,70820,392158,22888,50756,245751,57056,133112,165778,270652,163562,170904,168087,200284,317207,471040,143648,145183,92691,39179,12876,166359,185421,128578,16107,15056,255984,226033,138787,335349,207836,294934,161431,108142,79123,358626,433399,118377,431845,73935,417588,448244,66424,202785,457842,69927,75629,135032,391644,375564,250340,313784,411340,156802,415883,426764,306914,442205,370215,355621,151042,209326,112028,46580,13565,111497,15026,326055,342154,93271,97596,123075,104253,71569,197154,91292,339265,105222,304793,356086,242544,58094,346485,198944,149758,5286,465805,359492,389055,157846,238409,59873,100915,48855,116819,19913,169369,220579,253796,343510,317557,124586,202026,205162,40230,242989,196310,272667,403057,143620,398999,389487,279322,167806,55846,133063,138915,319004,466052,206511,327970,344178,453057,176788,461850,411886,388841,280853,218865,112025,6483,449114,389570,132563,364683,370190,178493,12289,171396,149421,368480,404212,36612,403230,257689,247513,369338,95929,295463,9240,86018,33848,358739,216569,199133,320664,357118,375723,20276,310696,275742,50874,252763,353979,29517,253066,164407,316922,430153,69195,183822,424763,411552,321091,254752,88953,8663,67698,430182,142772,212884,91929,217443,418728,140751,364236,48229,71636,464599,255892,252501,306475,384183,43976,66403,393147,209398,132274,427347,405428,116855,30036,124232,180990,256475,351015,452166,44004,283628,96351,440296,448385,66819,457786,106518,198180,144277,230463,154538,145624,334458,75052,116712,316937,159597,246655,206580,308119,218412,180911,299683,44447,238099,312899,358750,49564,15243,243145,397190,234087,74491,155229,274507,344738,87147,364401,369400,139532,243896,385931,12125,177618,407383,25451,234994,264112,365728,49068,137460,184640,209908,354190,337454,237118,390328,57850,68522,295521,156394,144142,310262,441562,411843,442172,400189,436250,383599,89110,65895,354976,8925,115202,75516,351862,310888,15704,438198,355649,368267,383571,342926,362691,124078,163855,4689,23158,362199,142744,466700,388725,457586,102617,30238,311878,58566,374533,444554,206419,354438,40825,30850,12928,233319,172561,19056,334004,287586,84054,4961,47305,439867,367006,172914,183740,427874,69492,385097,170143,202703,460953,198908,139635,50423,34353,356813,381550,23237,318991,449312,209726,119830,382464,149404,455291,46077,199236,127191,5540,249370,224208,397591,98241,265192,198377,108081,362913,265010,435058,153091,275199,329973,423285,283805,106869,179119,57472,197751,62898,336558,351533,466980,205770,315872,56392,365102,3885,111105,271163,241830,406869,378127,434578,332145,248971,72758,387565,340752,353260,154450,68541,392455,224163,267177,36902,196918,77268,216460,312412,130217,97535,406865,10637,73228,231868,405687,124262,110919,140354,396531,218878,128765,3268,186213,351284,436216,86180,314922,391143,273939,446709,118916,256297,13104,387485,56567,191875,33074,376615,9412,343735,27545,431281,72355,339666,440417,24453,399234,76118,76269,53307,269601,404490,140953,80841,396846,189694,87097,10145,91894,63672,318682,87649,322378,27848,241709,359760,45712,345205,362394,393844,418475,213538,354337,418043,92062,424940,422070,59914,334880,219885,84816,297738,112494,465475,188191,253263,128211,449372,69584,358629,2455,153869,153772,427439,378960,420208,452243,288092,409521,24759,249759,399015,446324,311599,97873,371064,398088,303417,178514,292968,419840,87074,16762,133816,311401,277717,383797,380307,53162,372757,259180,392000,109304,379702,288658,123805,283356,72204,362628,224123,360605,191730,136230,231305,260459,372198,10401,59204,109063,141836,420727,323409,304675,349074,416662,161689,259197,305189,467439,217078,93656,375954,281499,217334,60966,421345,104653,79371,61997,227131,212018,136273,177974,141123,154813,209868,447618,21241,176430,73324,101849,128308,175705,118063,317381,441461,318020,32343,341160,153960,270952,404934,422817,152206,222609,222735,22645,100186,197145,442042,232789,468400,186363,929,326652,313760,90564,343907,285262,424978,144897,195452,109909,144206,66569,99629,132111,289921,47166,152176,292680,338856,448170,333474,112384,251361,142927,86371,198532,452609,469516,29135,14805,41475,396809,323219,277417,142425,128394,69043,350432,353652,369354,152766,327740,410348,401236,298873,52200,76079,26049,62952,116222,48307,172076,445309,91609,22785,244229,126288,183409,400221,78883,448153,420285,225290,413985,337929,305263,200389,307479,300137,302954,270757,153834};

/* omega_n^-1 */
static const uint32_t w_4_inv[3][3]={{381550,471040,89491},
{471040,1,471040},
{89491,471040,381550}};

/* multiplication inverses of omega_256,512,1024 respectively */
static const uint32_t omega_256_inv[128]={1,307479,225290,183409,445309,26049,410348,350432,323219,469516,251361,292680,99629,144897,313760,232789,222735,270952,441461,101849,209868,212018,421345,93656,161689,420727,372198,360605,123805,259180,277717,419840,371064,249759,420208,2455,253263,84816,424940,418475,359760,318682,189694,269601,24453,27545,191875,118916,86180,128765,124262,406865,77268,392455,387565,378127,3885,466980,57472,329973,362913,397591,199236,119830,381550,198908,69492,439867,334004,30850,374533,457586,23158,342926,15704,8925,436250,310262,57850,209908,264112,12125,364401,74491,49564,299683,246655,334458,198180,440296,351015,116855,393147,252501,364236,212884,88953,183822,253066,275742,320664,86018,247513,368480,370190,6483,411886,327970,133063,398999,242989,317557,19913,238409,5286,242544,91292,97596,111497,151042,426764,250340,69927,417588,358626,207836,15056,12876};
static const uint32_t omega_512_inv[512]={1,42760,307479,105648,225290,140909,183409,207231,445309,51456,26049,314316,410348,203230,350432,187069,323219,30459,469516,265699,251361,453863,292680,379512,99629,41236,144897,193447,313760,187838,232789,19228,222735,170621,270952,183084,441461,375326,101849,289195,209868,153589,212018,234594,421345,336032,93656,411019,161689,352883,420727,288648,372198,124213,360605,413706,123805,343042,259180,355193,277717,235310,419840,43808,371064,151596,249759,253288,420208,235135,2455,404698,253263,293290,84816,187501,424940,27825,418475,85492,359760,80622,318682,97231,189694,460461,269601,352367,24453,370301,27545,221700,191875,453903,118916,431606,86180,103057,128765,464192,124262,100640,406865,119106,77268,98106,392455,69134,387565,114938,378127,228195,3885,316168,466980,165769,57472,81823,329973,83366,362913,185176,397591,179388,199236,83834,119830,417843,381550,101924,198908,189784,69492,151292,439867,45790,334004,47920,30850,231200,374533,108121,457586,276302,23158,107898,342926,9430,15704,269615,8925,89790,436250,355359,310262,404396,57850,229709,209908,450866,264112,221145,12125,319900,364401,221521,74491,55918,49564,143181,299683,245716,246655,359810,334458,148279,198180,149210,440296,19231,351015,150976,116855,387913,393147,454512,252501,211999,364236,231736,212884,52515,88953,445246,183822,438594,253066,348308,275742,100649,320664,60171,86018,241552,247513,306692,368480,354391,370190,462636,6483,240972,411886,22370,327970,164548,133063,69641,398999,92220,242989,458303,317557,38413,19913,308793,238409,99518,5286,400721,242544,271743,91292,129153,97596,252741,111497,205759,151042,112769,426764,300300,250340,131675,69927,381293,417588,311693,358626,108005,207836,407854,15056,352554,12876,401872,471040,428281,163562,365393,245751,330132,287632,263810,25732,419585,444992,156725,60693,267811,120609,283972,147822,440582,1525,205342,219680,17178,178361,91529,371412,429805,326144,277594,157281,283203,238252,451813,248306,300420,200089,287957,29580,95715,369192,181846,261173,317452,259023,236447,49696,135009,377385,60022,309352,118158,50314,182393,98843,346828,110436,57335,347236,127999,211861,115848,193324,235731,51201,427233,99977,319445,221282,217753,50833,235906,468586,66343,217778,177751,386225,283540,46101,443216,52566,385549,111281,390419,152359,373810,281347,10580,201440,118674,446588,100740,443496,249341,279166,17138,352125,39435,384861,367984,342276,6849,346779,370401,64176,351935,393773,372935,78586,401907,83476,356103,92914,242846,467156,154873,4061,305272,413569,389218,141068,387675,108128,285865,73450,291653,271805,387207,351211,53198,89491,369117,272133,281257,401549,319749,31174,425251,137037,423121,440191,239841,96508,362920,13455,194739,447883,363143,128115,461611,455337,201426,462116,381251,34791,115682,160779,66645,413191,241332,261133,20175,206929,249896,458916,151141,106640,249520,396550,415123,421477,327860,171358,225325,224386,111231,136583,322762,272861,321831,30745,451810,120026,320065,354186,83128,77894,16529,218540,259042,106805,239305,258157,418526,382088,25795,287219,32447,217975,122733,195299,370392,150377,410870,385023,229489,223528,164349,102561,116650,100851,8405,464558,230069,59155,448671,143071,306493,337978,401400,72042,378821,228052,12738,153484,432628,451128,162248,232632,371523,465755,70320,228497,199298,379749,341888,373445,218300,359544,265282,319999,358272,44277,170741,220701,339366,401114,89748,53453,159348,112415,363036,263205,63187,455985,118487,458165,69169};
static const uint32_t omega_1024_inv[1024]={1,411937,42760,318966,307479,465046,105648,371145,225290,317869,140909,190385,183409,332038,207231,298099,445309,343780,51456,256313,26049,232933,314316,53135,410348,221857,203230,310621,350432,210883,187069,219217,323219,3020,30459,69966,469516,164769,265699,162203,251361,192596,453863,195157,292680,422005,379512,295172,99629,11125,41236,424631,144897,4133,193447,86705,313760,413130,187838,459218,232789,346554,19228,170221,222735,124428,170621,133185,270952,104910,183084,228157,441461,263169,375326,407991,101849,220684,289195,83487,209868,355422,153589,177896,212018,462892,234594,119100,421345,291749,336032,137396,93656,229608,411019,130517,161689,13152,352883,427607,420727,76823,288648,382587,372198,166190,124213,159874,360605,465248,413706,58886,123805,251215,343042,334436,259180,149641,355193,28216,277717,180159,235310,194326,419840,216520,43808,84345,371064,302304,151596,211918,249759,197963,253288,291110,420208,134134,235135,174624,2455,451349,404698,191388,253263,355587,293290,167681,84816,324499,187501,122503,424940,252360,27825,306372,418475,345469,85492,408680,359760,6741,80622,439109,318682,135539,97231,430217,189694,43706,460461,248913,269601,348485,352367,307606,24453,354717,370301,178720,27545,369057,221700,61738,191875,203116,453903,186202,118916,462538,431606,55372,86180,254654,103057,421284,128765,82877,464192,179077,124262,90024,100640,79188,406865,236172,119106,66721,77268,365664,98106,57686,392455,282684,69134,184739,387565,82070,114938,57750,378127,193078,228195,79673,3885,248968,316168,345080,466980,261475,165769,41824,57472,322604,81823,111355,329973,257372,83366,295837,362913,184065,185176,466372,397591,74944,179388,113517,199236,380456,83834,426584,119830,140156,417843,15917,381550,427716,101924,27253,198908,453887,189784,376838,69492,222352,151292,279976,439867,266745,45790,229426,334004,355894,47920,105853,30850,41311,231200,54610,374533,173363,108121,229663,457586,127112,276302,438062,23158,114714,107898,220707,342926,124885,9430,361824,15704,252595,269615,463111,8925,62720,89790,270787,436250,193299,355359,108813,310262,371923,404396,141238,57850,120219,229709,94007,209908,346467,450866,218429,264112,223092,221145,362629,12125,288402,319900,216140,364401,321980,221521,278452,74491,104163,55918,317225,49564,444364,143181,152782,299683,90691,245716,337648,246655,421830,359810,348828,334458,372015,148279,306830,198180,145827,149210,392803,440296,347343,19231,463950,351015,139244,150976,115200,116855,276263,387913,239682,393147,363283,454512,462023,252501,172899,211999,172745,364236,182279,231736,405654,212884,151256,52515,313630,88953,281530,445246,299004,183822,416218,438594,139577,253066,223050,348308,450873,275742,92391,100649,18293,320664,280620,60171,12766,86018,408682,241552,92261,247513,111985,306692,346835,368480,409756,354391,325524,370190,144690,462636,291906,6483,256142,240972,457629,411886,230818,22370,55607,327970,411393,164548,138535,133063,416025,69641,365635,398999,230769,92220,315572,242989,418234,458303,143234,317557,210758,38413,55668,19913,193507,308793,53114,238409,265979,99518,448136,5286,347480,400721,198537,242544,341218,271743,457746,91292,52287,129153,231534,97596,54102,252741,119169,111497,415943,205759,156602,151042,453705,112769,131174,426764,315053,300300,364721,250340,244532,131675,20202,69927,419367,381293,73091,417588,14125,311693,110438,358626,142855,108005,20112,207836,339295,407854,191400,15056,397666,352554,89101,12876,179152,401872,470778,471040,59104,428281,152075,163562,5995,365393,99896,245751,153172,330132,280656,287632,139003,263810,172942,25732,127261,419585,214728,444992,238108,156725,417906,60693,249184,267811,160420,120609,260158,283972,251824,147822,468021,440582,401075,1525,306272,205342,308838,219680,278445,17178,275884,178361,49036,91529,175869,371412,459916,429805,46410,326144,466908,277594,384336,157281,57911,283203,11823,238252,124487,451813,300820,248306,346613,300420,337856,200089,366131,287957,242884,29580,207872,95715,63050,369192,250357,181846,387554,261173,115619,317452,293145,259023,8149,236447,351941,49696,179292,135009,333645,377385,241433,60022,340524,309352,457889,118158,43434,50314,394218,182393,88454,98843,304851,346828,311167,110436,5793,57335,412155,347236,219826,127999,136605,211861,321400,115848,442825,193324,290882,235731,276715,51201,254521,427233,386696,99977,168737,319445,259123,221282,273078,217753,179931,50833,336907,235906,296417,468586,19692,66343,279653,217778,115454,177751,303360,386225,146542,283540,348538,46101,218681,443216,164669,52566,125572,385549,62361,111281,464300,390419,31932,152359,335502,373810,40824,281347,427335,10580,222128,201440,122556,118674,163435,446588,116324,100740,292321,443496,101984,249341,409303,279166,267925,17138,284839,352125,8503,39435,415669,384861,216387,367984,49757,342276,388164,6849,291964,346779,381017,370401,391853,64176,234869,351935,404320,393773,105377,372935,413355,78586,188357,401907,286302,83476,388971,356103,413291,92914,277963,242846,391368,467156,222073,154873,125961,4061,209566,305272,429217,413569,148437,389218,359686,141068,213669,387675,175204,108128,286976,285865,4669,73450,396097,291653,357524,271805,90585,387207,44457,351211,330885,53198,455124,89491,43325,369117,443788,272133,17154,281257,94203,401549,248689,319749,191065,31174,204296,425251,241615,137037,115147,423121,365188,440191,429730,239841,416431,96508,297678,362920,241378,13455,343929,194739,32979,447883,356327,363143,250334,128115,346156,461611,109217,455337,218446,201426,7930,462116,408321,381251,200254,34791,277742,115682,362228,160779,99118,66645,329803,413191,350822,241332,377034,261133,124574,20175,252612,206929,247949,249896,108412,458916,182639,151141,254901,106640,149061,249520,192589,396550,366878,415123,153816,421477,26677,327860,318259,171358,380350,225325,133393,224386,49211,111231,122213,136583,99026,322762,164211,272861,325214,321831,78238,30745,123698,451810,7091,120026,331797,320065,355841,354186,194778,83128,231359,77894,107758,16529,9018,218540,298142,259042,298296,106805,288762,239305,65387,258157,319785,418526,157411,382088,189511,25795,172037,287219,54823,32447,331464,217975,247991,122733,20168,195299,378650,370392,452748,150377,190421,410870,458275,385023,62359,229489,378780,223528,359056,164349,124206,102561,61285,116650,145517,100851,326351,8405,179135,464558,214899,230069,13412,59155,240223,448671,415434,143071,59648,306493,332506,337978,55016,401400,105406,72042,240272,378821,155469,228052,52807,12738,327807,153484,260283,432628,415373,451128,277534,162248,417927,232632,205062,371523,22905,465755,123561,70320,272504,228497,129823,199298,13295,379749,418754,341888,239507,373445,416939,218300,351872,359544,55098,265282,314439,319999,17336,358272,339867,44277,155988,170741,106320,220701,226509,339366,450839,401114,51674,89748,397950,53453,456916,159348,360603,112415,328186,363036,450929,263205,131746,63187,279641,455985,73375,118487,381940,458165,291889,69169,263};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint32_t *a)
{
uint32_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint32_t *a, uint32_t n, const uint32_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	uint64_t u, v;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			u = a[j1];
			v = a[j1 + d];
			
			a[j1] = barrett_4q(u + v);
			a[j1 + d] = barrett_4q(Q2 + u - v);

			j_omega = num_of_problems;
			
			for (j = j1 + 1; j < j2; j++)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = a[j];
				v = a[j + d];
				
				a[j] = barrett_4q(u + v);
				a[j + d] = barrett_4q2((Q2 + u - v) * omega[j_omega]);
				
				j_omega += num_of_problems;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k++)
	{
		j = k << 2;
		
		u = a[j];
		v = a[j + 2];
			
		a[j] = barrett_4q(u + v);
		a[j + 2] = barrett_4q(Q2 + u - v);
		
		u = a[j + 1];
		v = a[j + 3];

		a[j + 1] = barrett_4q(u + v);
		a[j + 3] = barrett_4q2((Q2 + u - v) * omega[num_of_problems]);
	}
	
	for (k = 0; k < (n >> 1); k++)
	{
		j = k << 1;
		
		u = a[j];
		v = a[j + 1];
		
		a[j] = barrett_4q(u + v);				
		a[j + 1] = barrett_4q(Q2 + u - v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint32_t *a, uint32_t N1, uint32_t N2, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t))
{
	uint32_t n1, n2;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint32_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint32_t *omega_2, const uint32_t *omega_n, void (*ntt_butterfly)(uint32_t *, uint32_t), uint32_t inv_n)
{
	uint32_t i, n1, n2;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 1; n2 < N2; n2++)
		{
			a[N2 * n1 + n2] = barrett_2q2((uint64_t)a[N2 * n1 + n2] * (uint64_t)omega_n[n1 * n2]);
		}
	}
	
	for (n2 = 0; n2 < N2; n2++)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i++)
	{
		a[i] = barrett_2q2((uint64_t)a[i] * (uint64_t)inv_n);
	}
}

/* 256 * 3 --> 256 * 5 */
static void ntt_butterfly_768_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	
	a[n2] = barrett_8q(b + c + d);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0] + d * w_5[1][1]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0] + d * w_5[2][1]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0] + d * w_5[3][1]) % Q;
}

/* 256 * 5 --> 256 * 2 */
static void ntt_butterfly_1280_512(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e, f;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	f = a[N2_1280 * 4 + n2];
	
	a[n2] = barrett_16q(b + c + d + e + f);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1] + e * w_5[0][2] + f * w_5[0][3]) % Q;
}

/* 256 * 1 --> 256 * 4 */
static void ntt_butterfly_256_1024(uint32_t *a, uint32_t n2)
{
	a[N2_1024 + n2] = a[n2];
	a[N2_1024 * 2 + n2] = a[n2];
	a[N2_1024 * 3 + n2] = a[n2];
}

/* 256 * 3 --> 256 * 4 */
static void ntt_butterfly_768_1024(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d;
	
	b = a[n2];
	c = a[N2_1024 + n2];
	d = a[N2_1024 * 2 + n2];
	
	a[n2] = barrett_8q(b + c + d);
	a[N2_1024 + n2] = (b + c * w_4[0][0] + d * w_4[0][1]) % Q;
	a[N2_1024 * 2 + n2] = (b + c * w_4[1][0] + d * w_4[1][1]) % Q;
	a[N2_1024 * 3 + n2] = (b + c * w_4[2][0] + d * w_4[2][1]) % Q;
}

/* 256 * 4 --> 256 * 4 */
static void ntt_butterfly_1024_1024_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1024 + n2];
	d = a[N2_1024 * 2 + n2];
	e = a[N2_1024 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1024 + n2] = (b + c * w_4_inv[0][0] + d * w_4_inv[0][1] + e * w_4_inv[0][2]) % Q;
	a[N2_1024 * 2 + n2] = (b + c * w_4_inv[1][0] + d * w_4_inv[1][1] + e * w_4_inv[1][2]) % Q;
	a[N2_1024 * 3 + n2] = (b + c * w_4_inv[2][0] + d * w_4_inv[2][1] + e * w_4_inv[2][2]) % Q;
}

/* 256 * 2 --> 256 * 2 */
static void ntt_butterfly_512_512_inv(uint32_t *a, uint32_t n2)
{
	uint64_t b, c;
	
	b = a[n2];
	c = a[N2_512 + n2];

	a[n2] = barrett_4q(b + c);
	a[N2_512 + n2] = barrett_4q(Q2 + b - c);
}

/* 256 * 2 --> 256 * 1 */
static void ntt_butterfly_512_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_4q(a[n2] + a[N2_512 + n2]);
}

/* 256 * 4 --> 256 * 5 */
static void ntt_butterfly_1024_1280(uint32_t *a, uint32_t n2)
{
	uint64_t b, c, d, e;
	
	b = a[n2];
	c = a[N2_1280 + n2];
	d = a[N2_1280 * 2 + n2];
	e = a[N2_1280 * 3 + n2];
	
	a[n2] = barrett_8q(b + c + d + e);
	a[N2_1280 + n2] = (b + c * w_5[0][0] + d * w_5[0][1] + e * w_5[0][2]) % Q;
	a[N2_1280 * 2 + n2] = (b + c * w_5[1][0] + d * w_5[1][1] + e * w_5[1][2]) % Q;
	a[N2_1280 * 3 + n2] = (b + c * w_5[2][0] + d * w_5[2][1] + e * w_5[2][2]) % Q;
	a[N2_1280 * 4 + n2] = (b + c * w_5[3][0] + d * w_5[3][1] + e * w_5[3][2]) % Q;
}

/* 256 * 5 --> 256 * 1 */
static void ntt_butterfly_1280_256(uint32_t *a, uint32_t n2)
{
	a[n2] = barrett_16q(a[n2] + a[N2_1280 + n2] + a[N2_1280 * 2 + n2] + a[N2_1280 * 3 + n2] + a[N2_1280 * 4 + n2]);	
}

void ntt_768_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_768_1280);
}

void intt_1280_512(uint32_t *a)
{
	intt_core(a, N1_1280, N2_1280, 512, omega_256, omega_1280, ntt_butterfly_1280_512, INV_1280);
}

void ntt_256_1024(uint32_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_256_1024);
}

void ntt_768_1024(uint32_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_768_1024);
}

void intt_1024_1024_inv(uint32_t *a)
{
	intt_core(a, N1_1024, N2_1024, 1024, omega_256_inv, omega_1024_inv, ntt_butterfly_1024_1024_inv, INV_1024);
}

void ntt_512_512_inv(uint32_t *a)
{
	ntt_core(a, N1_512, N2_512, omega_256_inv, omega_512_inv, ntt_butterfly_512_512_inv);
}

void intt_512_256(uint32_t *a)
{
	intt_core(a, N1_512, N2_512, 256, omega_256, omega_512, ntt_butterfly_512_256, INV_512);
}

void ntt_1024_1280(uint32_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_1024_1280);
}

void intt_1280_256(uint32_t *a)
{
	intt_core(a, N1_1280, N2_1280, 256, omega_256, omega_1280, ntt_butterfly_1280_256, INV_1280);
}
