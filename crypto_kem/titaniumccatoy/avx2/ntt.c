/* ****************************** *
 * Titanium_CCA_toy               *
 * Implemented by Raymond K. ZHAO *
 *                                *
 * NTT functions                  *
 * ****************************** */
 
#include "param.h"
#include "ntt.h"
#include "fastmodulo.h"
#include <stdint.h>
#include <x86intrin.h>

/* 512=2*256 */
#define N1_512 2
#define N2_512 256

/* 1024=4*256 */
#define N1_1024 4
#define N2_1024 256

/* 1280=5*256 */
#define N1_1280 5
#define N2_1280 256

/* multiplication inverses of 512, 1024, 1280 (in Montgomery form) */
#define INV_512 4096
#define INV_1024 2048
#define INV_1280 284263

/* omega_n: n-th root of unity mod Q */
static const __m256i w_4[3][3]={{{89491,89491,89491,89491},{471040,471040,471040,471040},{381550,381550,381550,381550}},
{{471040,471040,471040,471040},{1,1,1,1},{471040,471040,471040,471040}},
{{381550,381550,381550,381550},{471040,471040,471040,471040},{89491,89491,89491,89491}}};

static const __m256i w_5[4][4]={{{29479,29479,29479,29479},{411837,411837,411837,411837},{403230,403230,403230,403230},{97535,97535,97535,97535}},
{{411837,411837,411837,411837},{97535,97535,97535,97535},{29479,29479,29479,29479},{403230,403230,403230,403230}},
{{403230,403230,403230,403230},{29479,29479,29479,29479},{97535,97535,97535,97535},{411837,411837,411837,411837}},
{{97535,97535,97535,97535},{403230,403230,403230,403230},{411837,411837,411837,411837},{29479,29479,29479,29479}}};

static const __m256i w_4_inv[3][3]={{{381550,381550,381550,381550},{471040,471040,471040,471040},{89491,89491,89491,89491}},
{{471040,471040,471040,471040},{1,1,1,1},{471040,471040,471040,471040}},
{{89491,89491,89491,89491},{471040,471040,471040,471040},{381550,381550,381550,381550}}};

/* omega_256,512,1024,1280, respectively (in Montgomery form) */
static const uint64_t omega_256[128]={212988,438255,99800,446089,31990,257635,233503,70075,228856,82640,8979,262482,943,104998,404463,434749,23120,4792,4579,391962,301603,292817,371513,291008,112147,206934,196753,337911,63681,125825,258340,105702,289538,198227,200327,10064,423252,151618,231577,375119,22170,460967,176549,469983,433660,384895,385382,238303,442687,29329,134678,259034,119537,203576,98589,23531,365248,411137,229787,342150,123073,365017,88206,410436,306084,62463,264440,225949,300933,440999,96131,112992,160657,192540,414784,375115,73674,50150,65811,20323,219848,193562,444660,61195,104773,4276,54021,153161,147631,224720,110143,103183,222353,441011,412660,403361,21830,128397,114138,7032,366881,110433,137471,95482,461819,40140,360378,468804,70111,236361,11665,63539,70053,41087,413872,342002,144557,238100,230269,259451,402737,48757,102521,267527,45181,456120,409109,435060};
static const uint64_t omega_512[512]={212988,359697,438255,287581,99800,431386,446089,460377,31990,236733,257635,403244,233503,115199,70075,5785,228856,407859,82640,43625,8979,236413,262482,284195,943,222709,104998,96524,404463,234175,434749,367182,23120,3085,4792,316025,4579,185299,391962,383782,301603,114099,292817,38155,371513,11983,291008,208340,112147,463696,206934,366020,196753,362726,337911,382580,63681,46698,125825,235909,258340,179125,105702,274277,289538,274766,198227,101935,200327,276207,10064,389259,423252,248397,151618,8618,231577,200308,375119,254708,22170,238275,460967,332174,176549,450897,469983,301594,433660,408701,384895,35976,385382,277368,238303,42494,442687,196898,29329,355055,134678,235766,259034,136229,119537,72080,203576,319731,98589,41984,23531,169084,365248,25918,411137,247901,229787,271581,342150,131428,123073,183385,365017,63273,88206,197782,410436,277655,306084,115410,62463,115195,264440,57289,225949,468083,300933,403928,440999,257794,96131,70383,112992,31376,160657,155802,192540,57067,414784,29268,375115,449073,73674,235368,50150,79426,65811,411876,20323,135243,219848,49709,193562,91635,444660,65445,61195,22529,104773,77852,4276,423937,54021,281337,153161,281119,147631,261841,224720,246762,110143,335074,103183,322736,222353,446007,441011,145740,412660,79104,403361,318579,21830,272865,128397,85079,114138,164162,7032,282096,366881,400096,110433,139321,137471,297973,95482,399638,461819,384037,40140,128006,360378,438244,468804,241436,70111,140664,236361,434022,11665,434193,63539,116561,70053,368231,41087,156350,413872,66634,342002,257318,144557,75826,238100,132417,230269,167128,259451,246201,402737,21854,48757,290414,102521,223835,267527,200419,45181,238595,456120,451223,409109,343387,435060,210855,258053,111344,32786,183460,371241,39655,24952,10664,439051,234308,213406,67797,237538,355842,400966,465256,242185,63182,388401,427416,462062,234628,208559,186846,470098,248332,366043,374517,66578,236866,36292,103859,447921,467956,466249,155016,466462,285742,79079,87259,169438,356942,178224,432886,99528,459058,180033,262701,358894,7345,264107,105021,274288,108315,133130,88461,407360,424343,345216,235132,212701,291916,365339,196764,181503,196275,272814,369106,270714,194834,460977,81782,47789,222644,319423,462423,239464,270733,95922,216333,448871,232766,10074,138867,294492,20144,1058,169447,37381,62340,86146,435065,85659,193673,232738,428547,28354,274143,441712,115986,336363,235275,212007,334812,351504,398961,267465,151310,372452,429057,447510,301957,105793,445123,59904,223140,241254,199460,128891,339613,347968,287656,106024,407768,382835,273259,60605,193386,164957,355631,408578,355846,206601,413752,245092,2958,170108,67113,30042,213247,374910,400658,358049,439665,310384,315239,278501,413974,56257,441773,95926,21968,397367,235673,420891,391615,405230,59165,450718,335798,251193,421332,277479,379406,26381,405596,409846,448512,366268,393189,466765,47104,417020,189704,317880,189922,323410,209200,246321,224279,360898,135967,367858,148305,248688,25034,30030,325301,58381,391937,67680,152462,449211,198176,342644,385962,356903,306879,464009,188945,104160,70945,360608,331720,333570,173068,375559,71403,9222,87004,430901,343035,110663,32797,2237,229605,400930,330377,234680,37019,459376,36848,407502,354480,400988,102810,429954,314691,57169,404407,129039,213723,326484,395215,232941,338624,240772,303913,211590,224840,68304,449187,422284,180627,368520,247206,203514,270622,425860,232446,14921,19818,61932,127654,35981,260186};
static const uint64_t omega_1024[1024]={212988,433006,359697,392111,438255,327061,287581,267243,99800,340145,431386,404678,446089,32198,460377,21614,31990,405673,236733,83367,257635,399142,403244,68947,233503,175959,115199,150713,70075,59126,5785,108332,228856,366921,407859,340610,82640,66434,43625,168391,8979,6272,236413,470248,262482,260780,284195,318807,943,248009,222709,163383,104998,294096,96524,420639,404463,389544,234175,352695,434749,347065,367182,5461,23120,428068,3085,340314,4792,318214,316025,211359,4579,262195,185299,216414,391962,399068,383782,131892,301603,186701,114099,332454,292817,231188,38155,142904,371513,202432,11983,325283,291008,226462,208340,152664,112147,290119,463696,423470,206934,253927,366020,170896,196753,402570,362726,246656,337911,314885,382580,286807,63681,261668,46698,34508,125825,119105,235909,337696,258340,113516,179125,5775,105702,8207,274277,65578,289538,310893,274766,194185,198227,319191,101935,430609,200327,400450,276207,102127,10064,291627,389259,159220,423252,149600,248397,324753,151618,308090,8618,382370,231577,140462,200308,395453,375119,208728,254708,100382,22170,178218,238275,17872,460967,176784,332174,219177,176549,270369,450897,354620,469983,192787,301594,184334,433660,60658,408701,91015,384895,424611,35976,40868,385382,81651,277368,407470,238303,25236,42494,341979,442687,79554,196898,440705,29329,176871,355055,113347,134678,92239,235766,300087,259034,296038,136229,29111,119537,349525,72080,115400,203576,312855,319731,243955,98589,21652,41984,207849,23531,65120,169084,191238,365248,438901,25918,221860,411137,260642,247901,194305,229787,140733,271581,298612,342150,16619,131428,179571,123073,337411,183385,184073,365017,378148,63273,154364,88206,117169,197782,202156,410436,76279,277655,11910,306084,423122,115410,206206,62463,412375,115195,149661,264440,304693,57289,464736,225949,73421,468083,164128,300933,10491,403928,248839,440999,106651,257794,440959,96131,317280,70383,140130,112992,41313,31376,244191,160657,330142,155802,466400,192540,236633,57067,406350,414784,277721,29268,160828,375115,207676,449073,345949,73674,63581,235368,195413,50150,302,79426,163234,65811,350817,411876,454999,20323,163498,135243,240834,219848,353022,49709,355360,193562,34378,91635,76914,444660,127412,65445,254559,61195,78891,22529,272635,104773,234921,77852,220313,4276,182506,423937,329755,54021,76293,281337,38194,153161,242858,281119,451901,147631,201591,261841,92197,224720,221235,246762,365789,110143,234108,335074,39795,103183,287792,322736,92188,222353,69755,446007,10632,441011,109807,145740,175299,412660,190150,79104,78548,403361,99718,318579,412020,21830,88798,272865,165263,128397,324500,85079,236850,114138,342711,164162,309875,7032,436293,282096,237811,366881,397339,400096,183105,110433,310378,139321,371266,137471,355757,297973,174093,95482,146593,399638,62651,461819,400860,384037,198957,40140,193918,128006,221667,360378,100173,438244,324168,468804,353751,241436,378174,70111,68594,140664,253434,236361,456572,434022,155864,11665,241649,434193,200837,63539,224322,116561,37878,70053,53340,368231,281348,41087,442979,156350,139483,413872,37865,66634,96225,342002,448736,257318,315771,144557,335211,75826,158516,238100,442888,132417,439678,230269,267499,167128,147851,259451,405709,246201,218246,402737,406647,21854,95110,48757,104984,290414,70240,102521,113686,223835,459521,267527,174492,200419,424646,45181,106578,238595,102032,456120,315146,451223,440358,409109,198319,343387,341950,435060,428858,210855,343068,258053,38035,111344,78930,32786,143980,183460,203798,371241,130896,39655,66363,24952,438843,10664,449427,439051,65368,234308,387674,213406,71899,67797,402094,237538,295082,355842,320328,400966,411915,465256,362709,242185,104120,63182,130431,388401,404607,427416,302650,462062,464769,234628,793,208559,210261,186846,152234,470098,223032,248332,307658,366043,176945,374517,50402,66578,81497,236866,118346,36292,123976,103859,465580,447921,42973,467956,130727,466249,152827,155016,259682,466462,208846,285742,254627,79079,71973,87259,339149,169438,284340,356942,138587,178224,239853,432886,328137,99528,268609,459058,145758,180033,244579,262701,318377,358894,180922,7345,47571,264107,217114,105021,300145,274288,68471,108315,224385,133130,156156,88461,184234,407360,209373,424343,436533,345216,351936,235132,133345,212701,357525,291916,465266,365339,462834,196764,405463,181503,160148,196275,276856,272814,151850,369106,40432,270714,70591,194834,368914,460977,179414,81782,311821,47789,321441,222644,146288,319423,162951,462423,88671,239464,330579,270733,75588,95922,262313,216333,370659,448871,292823,232766,453169,10074,294257,138867,251864,294492,200672,20144,116421,1058,278254,169447,286707,37381,410383,62340,380026,86146,46430,435065,430173,85659,389390,193673,63571,232738,445805,428547,129062,28354,391487,274143,30336,441712,294170,115986,357694,336363,378802,235275,170954,212007,175003,334812,441930,351504,121516,398961,355641,267465,158186,151310,227086,372452,449389,429057,263192,447510,405921,301957,279803,105793,32140,445123,249181,59904,210399,223140,276736,241254,330308,199460,172429,128891,454422,339613,291470,347968,133630,287656,286968,106024,92893,407768,316677,382835,353872,273259,268885,60605,394762,193386,459131,164957,47919,355631,264835,408578,58666,355846,321380,206601,166348,413752,6305,245092,397620,2958,306913,170108,460550,67113,222202,30042,364390,213247,30082,374910,153761,400658,330911,358049,429728,439665,226850,310384,140899,315239,4641,278501,234408,413974,64691,56257,193320,441773,310213,95926,263365,21968,125092,397367,407460,235673,275628,420891,470739,391615,307807,405230,120224,59165,16042,450718,307543,335798,230207,251193,118019,421332,115681,277479,436663,379406,394127,26381,343629,405596,216482,409846,392150,448512,198406,366268,236120,393189,250728,466765,288535,47104,141286,417020,394748,189704,432847,317880,228183,189922,19140,323410,269450,209200,378844,246321,249806,224279,105252,360898,236933,135967,431246,367858,183249,148305,378853,248688,401286,25034,460409,30030,361234,325301,295742,58381,280891,391937,392493,67680,371323,152462,59021,449211,382243,198176,305778,342644,146541,385962,234191,356903,128330,306879,161166,464009,34748,188945,233230,104160,73702,70945,287936,360608,160663,331720,99775,333570,115284,173068,296948,375559,324448,71403,408390,9222,70181,87004,272084,430901,277123,343035,249374,110663,370868,32797,146873,2237,117290,229605,92867,400930,402447,330377,217607,234680,14469,37019,315177,459376,229392,36848,270204,407502,246719,354480,433163,400988,417701,102810,189693,429954,28062,314691,331558,57169,433176,404407,374816,129039,22305,213723,155270,326484,135830,395215,312525,232941,28153,338624,31363,240772,203542,303913,323190,211590,65332,224840,252795,68304,64394,449187,375931,422284,366057,180627,400801,368520,357355,247206,11520,203514,296549,270622,46395,425860,364463,232446,369009,14921,155895,19818,30683,61932,272722,127654,129091,35981,42183,260186,127973};
static const uint64_t omega_1280[1280]={212988,225849,191723,199684,305504,438255,175410,100533,281635,464928,99800,62435,428801,212399,47141,446089,153927,300926,14522,184333,31990,176476,60090,18005,103891,257635,467849,201523,390833,55924,233503,119625,154721,236336,144265,70075,12570,315834,333565,229564,228856,186784,289410,439939,387252,82640,104562,433232,84502,183274,8979,365907,243331,56958,79386,262482,404591,234776,19629,455875,943,199744,165362,206013,266442,104998,451157,375249,279524,355452,404463,251121,232454,73257,305445,434749,262469,387851,237991,282530,23120,168331,7206,220630,464404,4792,300726,10621,16391,199591,4579,280085,316935,446893,65980,391962,386477,244164,42588,199484,301603,270313,343011,399677,30589,292817,442802,341821,352914,397353,371513,432753,119908,11863,130114,291008,287402,136990,340337,144973,112147,380985,165305,386252,63135,206934,329155,167099,341167,90506,196753,227138,148564,62074,178,337911,64681,458478,91753,63277,63681,438973,194125,430241,146278,125825,275652,261087,130085,217431,258340,469824,63405,47336,226148,105702,125739,382314,28718,93814,289538,423594,174427,465258,271101,198227,458436,1436,37430,188375,200327,263876,351704,397304,344650,10064,422398,47470,289997,434902,423252,313779,187498,411676,408297,151618,371294,331918,355238,56429,231577,284606,449866,234663,236459,375119,112124,387602,207227,162940,22170,32041,387084,192413,1174,460967,72000,462278,165872,427929,176549,407729,253589,403063,223814,469983,304382,44248,90550,470815,433660,309529,222362,375716,83730,384895,453538,325127,342895,105369,385382,211030,277156,422314,337877,238303,213249,417001,453281,30424,442687,374906,91483,222875,166688,29329,409553,138433,314313,259149,134678,370608,426877,90084,51920,259034,167763,109177,252399,356300,119537,77638,294333,293376,220540,203576,353155,164178,239444,233149,98589,206034,76080,353442,388810,23531,9128,159200,278950,377229,365248,228122,111232,398466,174188,411137,112804,212449,401397,252554,229787,226140,312804,345121,181760,342150,196822,207287,22798,260969,123073,391549,361935,382536,169650,365017,437940,204594,142201,274758,88206,387412,179969,427332,204943,410436,7278,240876,374130,396655,306084,25631,285609,38427,167783,62463,174985,386644,278039,291159,264440,353284,4185,352477,52035,225949,429194,283655,457224,288683,300933,422109,110134,325235,373264,440999,266615,219067,299671,355100,96131,12068,357857,204076,127387,112992,55962,427371,255163,400791,160657,126018,343007,32187,140280,192540,128477,393325,76268,196955,414784,26140,180132,93717,92164,375115,215675,26252,106950,319656,73674,226436,186686,235684,65602,50150,153854,424328,249979,356202,65811,174342,428272,364590,69265,20323,153814,46715,404807,295514,219848,218341,17017,244774,30934,193562,285013,394214,25307,194502,444660,53043,38352,107440,117245,61195,27782,301657,49977,39785,104773,270128,68554,409195,220948,4276,469657,29530,269806,161192,54021,391867,372848,376360,369495,153161,111700,59024,58448,367521,147631,310014,267150,147070,348531,224720,332211,189023,382541,393492,110143,445526,8699,77821,385045,103183,215563,99434,352052,338146,222353,255425,448295,277032,335108,441011,427003,361035,129461,355993,412660,370965,16969,74263,405144,403361,281441,70180,2842,144931,21830,355138,289999,147606,132886,128397,109140,385924,75579,251817,114138,299704,325126,15502,250552,7032,250209,290032,117632,52257,366881,229356,432057,238224,256457,110433,239214,299319,46768,328119,137471,17635,26018,276671,377526,95482,444543,373424,67287,118344,461819,154564,179104,328028,20291,40140,453202,73632,136119,160839,360378,297997,119901,75317,204313,468804,90614,227122,91727,29797,70111,22693,270697,293976,232243,236361,321393,208828,50500,278441,11665,309958,303741,269621,357776,63539,111185,84307,403215,57204,70053,346580,212573,17562,149420,41087,78354,129303,442409,270565,413872,83718,224507,311570,24296,342002,259881,26485,80877,406969,144557,47508,12824,99399,198281,238100,169251,213567,427914,447105,230269,230831,48666,416954,139122,259451,88754,332155,225614,34051,402737,420003,224500,375024,98495,48757,63093,116617,303308,291793,102521,160257,118216,7123,367389,267527,161489,255296,137247,163999,45181,313651,203843,153460,25679,456120,135258,429025,66035,27978,409109,327610,242948,433386,101637,435060,336836,455874,144591,344927,258053,245192,279318,271357,165537,32786,295631,370508,189406,6113,371241,408606,42240,258642,423900,24952,317114,170115,456519,286708,439051,294565,410951,453036,367150,213406,3192,269518,80208,415117,237538,351416,316320,234705,326776,400966,458471,155207,137476,241477,242185,284257,181631,31102,83789,388401,366479,37809,386539,287767,462062,105134,227710,414083,391655,208559,66450,236265,451412,15166,470098,271297,305679,265028,204599,366043,19884,95792,191517,115589,66578,219920,238587,397784,165596,36292,208572,83190,233050,188511,447921,302710,463835,250411,6637,466249,170315,460420,454650,271450,466462,190956,154106,24148,405061,79079,84564,226877,428453,271557,169438,200728,128030,71364,440452,178224,28239,129220,118127,73688,99528,38288,351133,459178,340927,180033,183639,334051,130704,326068,358894,90056,305736,84789,407906,264107,141886,303942,129874,380535,274288,243903,322477,408967,470863,133130,406360,12563,379288,407764,407360,32068,276916,40800,324763,345216,195389,209954,340956,253610,212701,1217,407636,423705,244893,365339,345302,88727,442323,377227,181503,47447,296614,5783,199940,272814,12605,469605,433611,282666,270714,207165,119337,73737,126391,460977,48643,423571,181044,36139,47789,157262,283543,59365,62744,319423,99747,139123,115803,414612,239464,186435,21175,236378,234582,95922,358917,83439,263814,308101,448871,439000,83957,278628,469867,10074,399041,8763,305169,43112,294492,63312,217452,67978,247227,1058,166659,426793,380491,226,37381,161512,248679,95325,387311,86146,17503,145914,128146,365672,85659,260011,193885,48727,133164,232738,257792,54040,17760,440617,28354,96135,379558,248166,304353,441712,61488,332608,156728,211892,336363,100433,44164,380957,419121,212007,303278,361864,218642,114741,351504,393403,176708,177665,250501,267465,117886,306863,231597,237892,372452,265007,394961,117599,82231,447510,461913,311841,192091,93812,105793,242919,359809,72575,296853,59904,358237,258592,69644,218487,241254,244901,158237,125920,289281,128891,274219,263754,448243,210072,347968,79492,109106,88505,301391,106024,33101,266447,328840,196283,382835,83629,291072,43709,266098,60605,463763,230165,96911,74386,164957,445410,185432,432614,303258,408578,296056,84397,193002,179882,206601,117757,466856,118564,419006,245092,41847,187386,13817,182358,170108,48932,360907,145806,97777,30042,204426,251974,171370,115941,374910,458973,113184,266965,343654,358049,415079,43670,215878,70250,310384,345023,128034,438854,330761,278501,342564,77716,394773,274086,56257,444901,290909,377324,378877,95926,255366,444789,364091,151385,397367,244605,284355,235357,405439,420891,317187,46713,221062,114839,405230,296699,42769,106451,401776,450718,317227,424326,66234,175527,251193,252700,454024,226267,440107,277479,186028,76827,445734,276539,26381,417998,432689,363601,353796,409846,443259,169384,421064,431256,366268,200913,402487,61846,250093,466765,1384,441511,201235,309849,417020,79174,98193,94681,101546,317880,359341,412017,412593,103520,323410,161027,203891,323971,122510,246321,138830,282018,88500,77549,360898,25515,462342,393220,85996,367858,255478,371607,118989,132895,248688,215616,22746,194009,135933,30030,44038,110006,341580,115048,58381,100076,454072,396778,65897,67680,189600,400861,468199,326110,449211,115903,181042,323435,338155,342644,361901,85117,395462,219224,356903,171337,145915,455539,220489,464009,220832,181009,353409,418784,104160,241685,38984,232817,214584,360608,231827,171722,424273,142922,333570,453406,445023,194370,93515,375559,26498,97617,403754,352697,9222,316477,291937,143013,450750,430901,17839,397409,334922,310202,110663,173044,351140,395724,266728,2237,380427,243919,379314,441244,400930,448348,200344,177065,238798,234680,149648,262213,420541,192600,459376,161083,167300,201420,113265,407502,359856,386734,67826,413837,400988,124461,258468,453479,321621,429954,392687,341738,28632,200476,57169,387323,246534,159471,446745,129039,211160,444556,390164,64072,326484,423533,458217,371642,272760,232941,301790,257474,43127,23936,240772,240210,422375,54087,331919,211590,382287,138886,245427,436990,68304,51038,246541,96017,372546,422284,407948,354424,167733,179248,368520,310784,352825,463918,103652,203514,309552,215745,333794,307042,425860,157390,267198,317581,445362,14921,335783,42016,405006,443063,61932,143431,228093,37655,369404,35981,134205,15167,326450,126114};

/* multiplication inverses of omega_256,512,1024, respectively (in Montgomery form) */
static const uint64_t omega_256_inv[128]={212988,35981,61932,14921,425860,203514,368520,422284,68304,211590,240772,232941,326484,129039,57169,429954,400988,407502,459376,234680,400930,2237,110663,430901,9222,375559,333570,360608,104160,464009,356903,342644,449211,67680,58381,30030,248688,367858,360898,246321,323410,317880,417020,466765,366268,409846,26381,277479,251193,450718,405230,420891,397367,95926,56257,278501,310384,358049,374910,30042,170108,245092,206601,408578,164957,60605,382835,106024,347968,128891,241254,59904,105793,447510,372452,267465,351504,212007,336363,441712,28354,232738,85659,86146,37381,1058,294492,10074,448871,95922,239464,319423,47789,460977,270714,272814,181503,365339,212701,345216,407360,133130,274288,264107,358894,180033,99528,178224,169438,79079,466462,466249,447921,36292,66578,366043,470098,208559,462062,388401,242185,400966,237538,213406,439051,24952,371241,32786};
static const uint64_t omega_512_inv[512]={212988,260186,35981,127654,61932,19818,14921,232446,425860,270622,203514,247206,368520,180627,422284,449187,68304,224840,211590,303913,240772,338624,232941,395215,326484,213723,129039,404407,57169,314691,429954,102810,400988,354480,407502,36848,459376,37019,234680,330377,400930,229605,2237,32797,110663,343035,430901,87004,9222,71403,375559,173068,333570,331720,360608,70945,104160,188945,464009,306879,356903,385962,342644,198176,449211,152462,67680,391937,58381,325301,30030,25034,248688,148305,367858,135967,360898,224279,246321,209200,323410,189922,317880,189704,417020,47104,466765,393189,366268,448512,409846,405596,26381,379406,277479,421332,251193,335798,450718,59165,405230,391615,420891,235673,397367,21968,95926,441773,56257,413974,278501,315239,310384,439665,358049,400658,374910,213247,30042,67113,170108,2958,245092,413752,206601,355846,408578,355631,164957,193386,60605,273259,382835,407768,106024,287656,347968,339613,128891,199460,241254,223140,59904,445123,105793,301957,447510,429057,372452,151310,267465,398961,351504,334812,212007,235275,336363,115986,441712,274143,28354,428547,232738,193673,85659,435065,86146,62340,37381,169447,1058,20144,294492,138867,10074,232766,448871,216333,95922,270733,239464,462423,319423,222644,47789,81782,460977,194834,270714,369106,272814,196275,181503,196764,365339,291916,212701,235132,345216,424343,407360,88461,133130,108315,274288,105021,264107,7345,358894,262701,180033,459058,99528,432886,178224,356942,169438,87259,79079,285742,466462,155016,466249,467956,447921,103859,36292,236866,66578,374517,366043,248332,470098,186846,208559,234628,462062,427416,388401,63182,242185,465256,400966,355842,237538,67797,213406,234308,439051,10664,24952,39655,371241,183460,32786,111344,258053,210855,435060,343387,409109,451223,456120,238595,45181,200419,267527,223835,102521,290414,48757,21854,402737,246201,259451,167128,230269,132417,238100,75826,144557,257318,342002,66634,413872,156350,41087,368231,70053,116561,63539,434193,11665,434022,236361,140664,70111,241436,468804,438244,360378,128006,40140,384037,461819,399638,95482,297973,137471,139321,110433,400096,366881,282096,7032,164162,114138,85079,128397,272865,21830,318579,403361,79104,412660,145740,441011,446007,222353,322736,103183,335074,110143,246762,224720,261841,147631,281119,153161,281337,54021,423937,4276,77852,104773,22529,61195,65445,444660,91635,193562,49709,219848,135243,20323,411876,65811,79426,50150,235368,73674,449073,375115,29268,414784,57067,192540,155802,160657,31376,112992,70383,96131,257794,440999,403928,300933,468083,225949,57289,264440,115195,62463,115410,306084,277655,410436,197782,88206,63273,365017,183385,123073,131428,342150,271581,229787,247901,411137,25918,365248,169084,23531,41984,98589,319731,203576,72080,119537,136229,259034,235766,134678,355055,29329,196898,442687,42494,238303,277368,385382,35976,384895,408701,433660,301594,469983,450897,176549,332174,460967,238275,22170,254708,375119,200308,231577,8618,151618,248397,423252,389259,10064,276207,200327,101935,198227,274766,289538,274277,105702,179125,258340,235909,125825,46698,63681,382580,337911,362726,196753,366020,206934,463696,112147,208340,291008,11983,371513,38155,292817,114099,301603,383782,391962,185299,4579,316025,4792,3085,23120,367182,434749,234175,404463,96524,104998,222709,943,284195,262482,236413,8979,43625,82640,407859,228856,5785,70075,115199,233503,403244,257635,236733,31990,460377,446089,431386,99800,287581,438255,359697};
static const uint64_t omega_1024_inv[1024]={212988,127973,260186,42183,35981,129091,127654,272722,61932,30683,19818,155895,14921,369009,232446,364463,425860,46395,270622,296549,203514,11520,247206,357355,368520,400801,180627,366057,422284,375931,449187,64394,68304,252795,224840,65332,211590,323190,303913,203542,240772,31363,338624,28153,232941,312525,395215,135830,326484,155270,213723,22305,129039,374816,404407,433176,57169,331558,314691,28062,429954,189693,102810,417701,400988,433163,354480,246719,407502,270204,36848,229392,459376,315177,37019,14469,234680,217607,330377,402447,400930,92867,229605,117290,2237,146873,32797,370868,110663,249374,343035,277123,430901,272084,87004,70181,9222,408390,71403,324448,375559,296948,173068,115284,333570,99775,331720,160663,360608,287936,70945,73702,104160,233230,188945,34748,464009,161166,306879,128330,356903,234191,385962,146541,342644,305778,198176,382243,449211,59021,152462,371323,67680,392493,391937,280891,58381,295742,325301,361234,30030,460409,25034,401286,248688,378853,148305,183249,367858,431246,135967,236933,360898,105252,224279,249806,246321,378844,209200,269450,323410,19140,189922,228183,317880,432847,189704,394748,417020,141286,47104,288535,466765,250728,393189,236120,366268,198406,448512,392150,409846,216482,405596,343629,26381,394127,379406,436663,277479,115681,421332,118019,251193,230207,335798,307543,450718,16042,59165,120224,405230,307807,391615,470739,420891,275628,235673,407460,397367,125092,21968,263365,95926,310213,441773,193320,56257,64691,413974,234408,278501,4641,315239,140899,310384,226850,439665,429728,358049,330911,400658,153761,374910,30082,213247,364390,30042,222202,67113,460550,170108,306913,2958,397620,245092,6305,413752,166348,206601,321380,355846,58666,408578,264835,355631,47919,164957,459131,193386,394762,60605,268885,273259,353872,382835,316677,407768,92893,106024,286968,287656,133630,347968,291470,339613,454422,128891,172429,199460,330308,241254,276736,223140,210399,59904,249181,445123,32140,105793,279803,301957,405921,447510,263192,429057,449389,372452,227086,151310,158186,267465,355641,398961,121516,351504,441930,334812,175003,212007,170954,235275,378802,336363,357694,115986,294170,441712,30336,274143,391487,28354,129062,428547,445805,232738,63571,193673,389390,85659,430173,435065,46430,86146,380026,62340,410383,37381,286707,169447,278254,1058,116421,20144,200672,294492,251864,138867,294257,10074,453169,232766,292823,448871,370659,216333,262313,95922,75588,270733,330579,239464,88671,462423,162951,319423,146288,222644,321441,47789,311821,81782,179414,460977,368914,194834,70591,270714,40432,369106,151850,272814,276856,196275,160148,181503,405463,196764,462834,365339,465266,291916,357525,212701,133345,235132,351936,345216,436533,424343,209373,407360,184234,88461,156156,133130,224385,108315,68471,274288,300145,105021,217114,264107,47571,7345,180922,358894,318377,262701,244579,180033,145758,459058,268609,99528,328137,432886,239853,178224,138587,356942,284340,169438,339149,87259,71973,79079,254627,285742,208846,466462,259682,155016,152827,466249,130727,467956,42973,447921,465580,103859,123976,36292,118346,236866,81497,66578,50402,374517,176945,366043,307658,248332,223032,470098,152234,186846,210261,208559,793,234628,464769,462062,302650,427416,404607,388401,130431,63182,104120,242185,362709,465256,411915,400966,320328,355842,295082,237538,402094,67797,71899,213406,387674,234308,65368,439051,449427,10664,438843,24952,66363,39655,130896,371241,203798,183460,143980,32786,78930,111344,38035,258053,343068,210855,428858,435060,341950,343387,198319,409109,440358,451223,315146,456120,102032,238595,106578,45181,424646,200419,174492,267527,459521,223835,113686,102521,70240,290414,104984,48757,95110,21854,406647,402737,218246,246201,405709,259451,147851,167128,267499,230269,439678,132417,442888,238100,158516,75826,335211,144557,315771,257318,448736,342002,96225,66634,37865,413872,139483,156350,442979,41087,281348,368231,53340,70053,37878,116561,224322,63539,200837,434193,241649,11665,155864,434022,456572,236361,253434,140664,68594,70111,378174,241436,353751,468804,324168,438244,100173,360378,221667,128006,193918,40140,198957,384037,400860,461819,62651,399638,146593,95482,174093,297973,355757,137471,371266,139321,310378,110433,183105,400096,397339,366881,237811,282096,436293,7032,309875,164162,342711,114138,236850,85079,324500,128397,165263,272865,88798,21830,412020,318579,99718,403361,78548,79104,190150,412660,175299,145740,109807,441011,10632,446007,69755,222353,92188,322736,287792,103183,39795,335074,234108,110143,365789,246762,221235,224720,92197,261841,201591,147631,451901,281119,242858,153161,38194,281337,76293,54021,329755,423937,182506,4276,220313,77852,234921,104773,272635,22529,78891,61195,254559,65445,127412,444660,76914,91635,34378,193562,355360,49709,353022,219848,240834,135243,163498,20323,454999,411876,350817,65811,163234,79426,302,50150,195413,235368,63581,73674,345949,449073,207676,375115,160828,29268,277721,414784,406350,57067,236633,192540,466400,155802,330142,160657,244191,31376,41313,112992,140130,70383,317280,96131,440959,257794,106651,440999,248839,403928,10491,300933,164128,468083,73421,225949,464736,57289,304693,264440,149661,115195,412375,62463,206206,115410,423122,306084,11910,277655,76279,410436,202156,197782,117169,88206,154364,63273,378148,365017,184073,183385,337411,123073,179571,131428,16619,342150,298612,271581,140733,229787,194305,247901,260642,411137,221860,25918,438901,365248,191238,169084,65120,23531,207849,41984,21652,98589,243955,319731,312855,203576,115400,72080,349525,119537,29111,136229,296038,259034,300087,235766,92239,134678,113347,355055,176871,29329,440705,196898,79554,442687,341979,42494,25236,238303,407470,277368,81651,385382,40868,35976,424611,384895,91015,408701,60658,433660,184334,301594,192787,469983,354620,450897,270369,176549,219177,332174,176784,460967,17872,238275,178218,22170,100382,254708,208728,375119,395453,200308,140462,231577,382370,8618,308090,151618,324753,248397,149600,423252,159220,389259,291627,10064,102127,276207,400450,200327,430609,101935,319191,198227,194185,274766,310893,289538,65578,274277,8207,105702,5775,179125,113516,258340,337696,235909,119105,125825,34508,46698,261668,63681,286807,382580,314885,337911,246656,362726,402570,196753,170896,366020,253927,206934,423470,463696,290119,112147,152664,208340,226462,291008,325283,11983,202432,371513,142904,38155,231188,292817,332454,114099,186701,301603,131892,383782,399068,391962,216414,185299,262195,4579,211359,316025,318214,4792,340314,3085,428068,23120,5461,367182,347065,434749,352695,234175,389544,404463,420639,96524,294096,104998,163383,222709,248009,943,318807,284195,260780,262482,470248,236413,6272,8979,168391,43625,66434,82640,340610,407859,366921,228856,108332,5785,59126,70075,150713,115199,175959,233503,68947,403244,399142,257635,83367,236733,405673,31990,21614,460377,32198,446089,404678,431386,340145,99800,267243,287581,327061,438255,392111,359697,433006};

static const __m256i V_B4Q_B4Q_B4Q_B4Q = {BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q, BARRETT_FACTOR_4Q};
static const __m256i V_B8Q_B8Q_B8Q_B8Q = {BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q, BARRETT_FACTOR_8Q};
static const __m256i V_B16Q_B16Q_B16Q_B16Q = {BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q, BARRETT_FACTOR_16Q};
static const __m256i V_Q_Q_Q_Q = {Q, Q, Q, Q};
static const __m256i V_Q2_Q2_Q2_Q2 = {Q2, Q2, Q2, Q2};
static const __m256i V_MM_MM_MM_MM = {MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK, MONTGOMERY_MASK};
static const __m256i V_MF_MF_MF_MF = {MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR, MONTGOMERY_FACTOR};

/* bit reverse step of dimension 256 */
static void bit_reverse_256(uint64_t *a)
{
uint64_t t;
t=a[1];a[1]=a[128];a[128]=t;
t=a[2];a[2]=a[64];a[64]=t;
t=a[3];a[3]=a[192];a[192]=t;
t=a[4];a[4]=a[32];a[32]=t;
t=a[5];a[5]=a[160];a[160]=t;
t=a[6];a[6]=a[96];a[96]=t;
t=a[7];a[7]=a[224];a[224]=t;
t=a[8];a[8]=a[16];a[16]=t;
t=a[9];a[9]=a[144];a[144]=t;
t=a[10];a[10]=a[80];a[80]=t;
t=a[11];a[11]=a[208];a[208]=t;
t=a[12];a[12]=a[48];a[48]=t;
t=a[13];a[13]=a[176];a[176]=t;
t=a[14];a[14]=a[112];a[112]=t;
t=a[15];a[15]=a[240];a[240]=t;
t=a[17];a[17]=a[136];a[136]=t;
t=a[18];a[18]=a[72];a[72]=t;
t=a[19];a[19]=a[200];a[200]=t;
t=a[20];a[20]=a[40];a[40]=t;
t=a[21];a[21]=a[168];a[168]=t;
t=a[22];a[22]=a[104];a[104]=t;
t=a[23];a[23]=a[232];a[232]=t;
t=a[25];a[25]=a[152];a[152]=t;
t=a[26];a[26]=a[88];a[88]=t;
t=a[27];a[27]=a[216];a[216]=t;
t=a[28];a[28]=a[56];a[56]=t;
t=a[29];a[29]=a[184];a[184]=t;
t=a[30];a[30]=a[120];a[120]=t;
t=a[31];a[31]=a[248];a[248]=t;
t=a[33];a[33]=a[132];a[132]=t;
t=a[34];a[34]=a[68];a[68]=t;
t=a[35];a[35]=a[196];a[196]=t;
t=a[37];a[37]=a[164];a[164]=t;
t=a[38];a[38]=a[100];a[100]=t;
t=a[39];a[39]=a[228];a[228]=t;
t=a[41];a[41]=a[148];a[148]=t;
t=a[42];a[42]=a[84];a[84]=t;
t=a[43];a[43]=a[212];a[212]=t;
t=a[44];a[44]=a[52];a[52]=t;
t=a[45];a[45]=a[180];a[180]=t;
t=a[46];a[46]=a[116];a[116]=t;
t=a[47];a[47]=a[244];a[244]=t;
t=a[49];a[49]=a[140];a[140]=t;
t=a[50];a[50]=a[76];a[76]=t;
t=a[51];a[51]=a[204];a[204]=t;
t=a[53];a[53]=a[172];a[172]=t;
t=a[54];a[54]=a[108];a[108]=t;
t=a[55];a[55]=a[236];a[236]=t;
t=a[57];a[57]=a[156];a[156]=t;
t=a[58];a[58]=a[92];a[92]=t;
t=a[59];a[59]=a[220];a[220]=t;
t=a[61];a[61]=a[188];a[188]=t;
t=a[62];a[62]=a[124];a[124]=t;
t=a[63];a[63]=a[252];a[252]=t;
t=a[65];a[65]=a[130];a[130]=t;
t=a[67];a[67]=a[194];a[194]=t;
t=a[69];a[69]=a[162];a[162]=t;
t=a[70];a[70]=a[98];a[98]=t;
t=a[71];a[71]=a[226];a[226]=t;
t=a[73];a[73]=a[146];a[146]=t;
t=a[74];a[74]=a[82];a[82]=t;
t=a[75];a[75]=a[210];a[210]=t;
t=a[77];a[77]=a[178];a[178]=t;
t=a[78];a[78]=a[114];a[114]=t;
t=a[79];a[79]=a[242];a[242]=t;
t=a[81];a[81]=a[138];a[138]=t;
t=a[83];a[83]=a[202];a[202]=t;
t=a[85];a[85]=a[170];a[170]=t;
t=a[86];a[86]=a[106];a[106]=t;
t=a[87];a[87]=a[234];a[234]=t;
t=a[89];a[89]=a[154];a[154]=t;
t=a[91];a[91]=a[218];a[218]=t;
t=a[93];a[93]=a[186];a[186]=t;
t=a[94];a[94]=a[122];a[122]=t;
t=a[95];a[95]=a[250];a[250]=t;
t=a[97];a[97]=a[134];a[134]=t;
t=a[99];a[99]=a[198];a[198]=t;
t=a[101];a[101]=a[166];a[166]=t;
t=a[103];a[103]=a[230];a[230]=t;
t=a[105];a[105]=a[150];a[150]=t;
t=a[107];a[107]=a[214];a[214]=t;
t=a[109];a[109]=a[182];a[182]=t;
t=a[110];a[110]=a[118];a[118]=t;
t=a[111];a[111]=a[246];a[246]=t;
t=a[113];a[113]=a[142];a[142]=t;
t=a[115];a[115]=a[206];a[206]=t;
t=a[117];a[117]=a[174];a[174]=t;
t=a[119];a[119]=a[238];a[238]=t;
t=a[121];a[121]=a[158];a[158]=t;
t=a[123];a[123]=a[222];a[222]=t;
t=a[125];a[125]=a[190];a[190]=t;
t=a[127];a[127]=a[254];a[254]=t;
t=a[131];a[131]=a[193];a[193]=t;
t=a[133];a[133]=a[161];a[161]=t;
t=a[135];a[135]=a[225];a[225]=t;
t=a[137];a[137]=a[145];a[145]=t;
t=a[139];a[139]=a[209];a[209]=t;
t=a[141];a[141]=a[177];a[177]=t;
t=a[143];a[143]=a[241];a[241]=t;
t=a[147];a[147]=a[201];a[201]=t;
t=a[149];a[149]=a[169];a[169]=t;
t=a[151];a[151]=a[233];a[233]=t;
t=a[155];a[155]=a[217];a[217]=t;
t=a[157];a[157]=a[185];a[185]=t;
t=a[159];a[159]=a[249];a[249]=t;
t=a[163];a[163]=a[197];a[197]=t;
t=a[167];a[167]=a[229];a[229]=t;
t=a[171];a[171]=a[213];a[213]=t;
t=a[173];a[173]=a[181];a[181]=t;
t=a[175];a[175]=a[245];a[245]=t;
t=a[179];a[179]=a[205];a[205]=t;
t=a[183];a[183]=a[237];a[237]=t;
t=a[187];a[187]=a[221];a[221]=t;
t=a[191];a[191]=a[253];a[253]=t;
t=a[199];a[199]=a[227];a[227]=t;
t=a[203];a[203]=a[211];a[211]=t;
t=a[207];a[207]=a[243];a[243]=t;
t=a[215];a[215]=a[235];a[235]=t;
t=a[223];a[223]=a[251];a[251]=t;
t=a[239];a[239]=a[247];a[247]=t;
}

/* DIF radix-2 NTT */
static void ntt_2(uint64_t *a, uint32_t n, const uint64_t *omega)
{
	uint32_t num_of_problems = 1;
	uint32_t d = n >> 1;
	uint32_t j1, j2, j_omega;
	uint32_t k, j;
	
	__m256i u, v, t, t1, o, u1, v1, r1, r2;

	while (d > 2)
	{
		for (k = 0; k < num_of_problems; k++)
		{
			/* Gentleman-Sande's butterfly
			 * (u, v) <-- (u + v, (u - v) * omega) % Q
			 * where omega = 1 (save 1 multiplication) */
			j1 = 2 * k * d;
			j2 = j1 + d;
			
			j_omega = 0;

			for (j = j1; j < j2; j += 4)
			{
				/* Gentleman-Sande's butterfly
				 * (u, v) <-- (u + v, (u - v) * omega) % Q */
				u = _mm256_loadu_si256((__m256i *)(a + j));
				v = _mm256_loadu_si256((__m256i *)(a + j + d));
				
				t = _mm256_add_epi64(u, v);
				t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
				t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				r1 = _mm256_sub_epi64(t, t1);
				
				t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
				t = _mm256_sub_epi64(t, v);
				o = _mm256_set_epi64x(omega[j_omega + num_of_problems * 3], omega[j_omega + num_of_problems * 2], omega[j_omega + num_of_problems], omega[j_omega]);
				t = _mm256_mul_epu32(t, o);
				t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
				t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
				t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
				t1 = _mm256_add_epi64(t, t1);
				r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);

				_mm256_storeu_si256((__m256i *)(a + j), r1);
				_mm256_storeu_si256((__m256i *)(a + j + d), r2);

				j_omega += num_of_problems * 4;
			} 
		}
		
		num_of_problems <<= 1;
		d >>= 1;
	}
	
	/* last 2 levels (save some overhead of iterations) */
	for (k = 0; k < num_of_problems; k += 2)
	{
		j = k << 2;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);
		
		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		o = _mm256_set_epi64x(omega[num_of_problems], omega[0], omega[num_of_problems], omega[0]);
		t = _mm256_mul_epu32(t, o);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		r2 = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
		
		u = _mm256_permute2f128_si256(r1, r2, 0x20);
		v = _mm256_permute2f128_si256(r1, r2, 0x31);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
	
	for (k = 0; k < (n >> 1); k += 4)
	{
		j = k << 1;
		
		u1 = _mm256_loadu_si256((__m256i *)(a + j));
		v1 = _mm256_loadu_si256((__m256i *)(a + j + 4));
		u1 = _mm256_permute4x64_epi64(u1, 0xD8);
		v1 = _mm256_permute4x64_epi64(v1, 0xD8);
		u = _mm256_permute2f128_si256(u1, v1, 0x20);
		v = _mm256_permute2f128_si256(u1, v1, 0x31);
		
		t = _mm256_add_epi64(u, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r1 = _mm256_sub_epi64(t, t1);

		t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, u);
		t = _mm256_sub_epi64(t, v);
		t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
		t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		r2 = _mm256_sub_epi64(t, t1);

		u1 = _mm256_permute2f128_si256(r1, r2, 0x20);
		v1 = _mm256_permute2f128_si256(r1, r2, 0x31);
		u = _mm256_permute4x64_epi64(u1, 0xD8);
		v = _mm256_permute4x64_epi64(v1, 0xD8);
		
		_mm256_storeu_si256((__m256i *)(a + j), u);
		_mm256_storeu_si256((__m256i *)(a + j + 4), v);
	}
}

/* Partial NTT similar to Sorensen et al.'s work:
 * Efficient computation of the DFT with only a subset of input or output points
 * X(k1+N1k2)=sum_n2^{N2-1} [omega_N^{n2k1}](sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1})omega_N2^{n2k2}
 * http://ieeexplore.ieee.org/document/205723/
 * 
 * ntt_butterfly is the function of the "partial" subroutine of NTT
 * Note: we exclusively use DIF NTT from natural order input to bit-reversed order output (DIF_N-->DIF_R) for both NTT and Inverse-NTT,
 * because DIF_R-->DIF_N may not be able to be efficiently parallelized due to its non-consecutive memory access at each iteration */
static void ntt_core(uint64_t *a, uint32_t N1, uint32_t N2, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t))
{
	uint32_t n1, n2;
	__m256i u, v, t, t1;
	
	/* y_k1(n2)=sum_n1^{N1-1} x(N2n1+n2)omega_N1^{n1k1} */
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by corresponding twiddle factors 
	 * we don't need to multiply with those twiddle factors which is equal to 1 */
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
    /* sum_n2^{N2-1} [omega_N^{n2k1}]y_k1(n2)omega_N2^{n2k2} */
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
}

/* Inverse-NTT, which is the NTT in "reversed order" of each step 
 * X(k2+N2k1)=sum_n1^{N1-1} [omega_N^{-n1k2}](sum_n2^{N2-1} x(N1n2+n1)omega_N2^{-n2k2})omega_N1^{-n1k1} */
static void intt_core(uint64_t *a, uint32_t N1, uint32_t N2, uint32_t DIM, const uint64_t *omega_2, const uint64_t *omega_n, void (*ntt_butterfly)(uint64_t *, uint32_t), uint64_t inv_n)
{
	uint32_t i, n1, n2;
	__m256i u, v, t, t1;
	
	for (n1 = 0; n1 < N1; n1++)
	{
		ntt_2(a + N2 * n1, N2, omega_2);
		bit_reverse_256(a + N2 * n1);
	}
	
	for (n1 = 1; n1 < N1; n1++)
	{
		for (n2 = 0; n2 < N2; n2 += 4)
		{
			u = _mm256_loadu_si256((__m256i *)(a + N2 * n1 + n2));
			v = _mm256_set_epi64x(omega_n[n1 * (n2 + 3)], omega_n[n1 * (n2 + 2)], omega_n[n1 * (n2 + 1)], omega_n[n1 * n2]);
			
			t = _mm256_mul_epu32(u, v);
			t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
			t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
			t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
			t1 = _mm256_add_epi64(t, t1);
			u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
			_mm256_storeu_si256((__m256i *)(a + N2 * n1 + n2), u);
		}
	}
	
	for (n2 = 0; n2 < N2; n2 += 4)
	{
		ntt_butterfly(a, n2);
	}
	
	/* multiply each a coordinate by the multiplication inverse of the dimension n */
	for (i = 0; i < DIM; i += 4)
	{
		u = _mm256_loadu_si256((__m256i *)(a + i));
		v = _mm256_set1_epi64x(inv_n);
		
		t = _mm256_mul_epu32(u, v);
		t1 = _mm256_and_si256(t, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_MF_MF_MF_MF);
		t1 = _mm256_and_si256(t1, V_MM_MM_MM_MM);
		t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
		t1 = _mm256_add_epi64(t, t1);
		u = _mm256_srli_epi64(t1, MONTGOMERY_SHIFT);
			
		_mm256_storeu_si256((__m256i *)(a + i), u);
	}
}

/* 256 * 3 --> 256 * 5 */
static void ntt_butterfly_768_1280(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_5[0][0]);
	d1 = _mm256_mul_epu32(d, w_5[0][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 + n2), t);
	a[N2_1280 + n2] %= Q;
	a[N2_1280 + n2 + 1] %= Q;
	a[N2_1280 + n2 + 2] %= Q;
	a[N2_1280 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_5[1][0]);
	d1 = _mm256_mul_epu32(d, w_5[1][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 2 + n2), t);
	a[N2_1280 * 2 + n2] %= Q;
	a[N2_1280 * 2 + n2 + 1] %= Q;
	a[N2_1280 * 2 + n2 + 2] %= Q;
	a[N2_1280 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[2][0]);
	d1 = _mm256_mul_epu32(d, w_5[2][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 3 + n2), t);
	a[N2_1280 * 3 + n2] %= Q;
	a[N2_1280 * 3 + n2 + 1] %= Q;
	a[N2_1280 * 3 + n2 + 2] %= Q;
	a[N2_1280 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[3][0]);
	d1 = _mm256_mul_epu32(d, w_5[3][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 4 + n2), t);
	a[N2_1280 * 4 + n2] %= Q;
	a[N2_1280 * 4 + n2 + 1] %= Q;
	a[N2_1280 * 4 + n2 + 2] %= Q;
	a[N2_1280 * 4 + n2 + 3] %= Q;
}

/* 256 * 5 --> 256 * 2 */
static void ntt_butterfly_1280_512(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, c1, d1, e1, f1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 4 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_5[0][0]);
	d1 = _mm256_mul_epu32(d, w_5[0][1]);
	e1 = _mm256_mul_epu32(e, w_5[0][2]);
	f1 = _mm256_mul_epu32(f, w_5[0][3]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	t = _mm256_add_epi64(t, f1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 + n2), t);
	a[N2_1280 + n2] %= Q;
	a[N2_1280 + n2 + 1] %= Q;
	a[N2_1280 + n2 + 2] %= Q;
	a[N2_1280 + n2 + 3] %= Q;
}

/* 256 * 1 --> 256 * 4 */
static void ntt_butterfly_256_1024(uint64_t *a, uint32_t n2)
{
	__m256i t;
	
	t = _mm256_loadu_si256((__m256i *)(a + n2));
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
}

/* 256 * 3 --> 256 * 4 */
static void ntt_butterfly_768_1024(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, c1, d1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1024 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 2 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_4[0][0]);
	d1 = _mm256_mul_epu32(d, w_4[0][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	a[N2_1024 + n2] %= Q;
	a[N2_1024 + n2 + 1] %= Q;
	a[N2_1024 + n2 + 2] %= Q;
	a[N2_1024 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_4[1][0]);
	d1 = _mm256_mul_epu32(d, w_4[1][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	a[N2_1024 * 2 + n2] %= Q;
	a[N2_1024 * 2 + n2 + 1] %= Q;
	a[N2_1024 * 2 + n2 + 2] %= Q;
	a[N2_1024 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_4[2][0]);
	d1 = _mm256_mul_epu32(d, w_4[2][1]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
	a[N2_1024 * 3 + n2] %= Q;
	a[N2_1024 * 3 + n2 + 1] %= Q;
	a[N2_1024 * 3 + n2 + 2] %= Q;
	a[N2_1024 * 3 + n2 + 3] %= Q;
}

/* 256 * 4 --> 256 * 4 */
static void ntt_butterfly_1024_1024_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, c1, d1, e1, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1024 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1024 * 3 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	c1 = _mm256_mul_epu32(c, w_4_inv[0][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[0][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[0][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 + n2), t);
	a[N2_1024 + n2] %= Q;
	a[N2_1024 + n2 + 1] %= Q;
	a[N2_1024 + n2 + 2] %= Q;
	a[N2_1024 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_4_inv[1][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[1][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[1][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 2 + n2), t);
	a[N2_1024 * 2 + n2] %= Q;
	a[N2_1024 * 2 + n2 + 1] %= Q;
	a[N2_1024 * 2 + n2 + 2] %= Q;
	a[N2_1024 * 2 + n2 + 3] %= Q;	

	c1 = _mm256_mul_epu32(c, w_4_inv[2][0]);
	d1 = _mm256_mul_epu32(d, w_4_inv[2][1]);
	e1 = _mm256_mul_epu32(e, w_4_inv[2][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1024 * 3 + n2), t);
	a[N2_1024 * 3 + n2] %= Q;
	a[N2_1024 * 3 + n2 + 1] %= Q;
	a[N2_1024 * 3 + n2 + 2] %= Q;
	a[N2_1024 * 3 + n2 + 3] %= Q;	
}

/* 256 * 2 --> 256 * 2 */
static void ntt_butterfly_512_512_inv(uint64_t *a, uint32_t n2)
{
	__m256i b, c, t, t1;

	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_512 + n2));

	t = _mm256_add_epi64(b, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + n2), t);
	
	t = _mm256_add_epi64(V_Q2_Q2_Q2_Q2, b);
	t = _mm256_sub_epi64(t, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);
	_mm256_storeu_si256((__m256i *)(a + N2_512 + n2), t);
}

/* 256 * 2 --> 256 * 1 */
static void ntt_butterfly_512_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_512 + n2));

	t = _mm256_add_epi64(b, c);
	t1 = _mm256_mul_epu32(t, V_B4Q_B4Q_B4Q_B4Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_4Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

/* 256 * 4 --> 256 * 5 */
static void ntt_butterfly_1024_1280(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, c1, d1, e1, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 3 + n2));
	
	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t1 = _mm256_mul_epu32(t, V_B8Q_B8Q_B8Q_B8Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_8Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);

	c1 = _mm256_mul_epu32(c, w_5[0][0]);
	d1 = _mm256_mul_epu32(d, w_5[0][1]);
	e1 = _mm256_mul_epu32(e, w_5[0][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 + n2), t);
	a[N2_1280 + n2] %= Q;
	a[N2_1280 + n2 + 1] %= Q;
	a[N2_1280 + n2 + 2] %= Q;
	a[N2_1280 + n2 + 3] %= Q;
	
	c1 = _mm256_mul_epu32(c, w_5[1][0]);
	d1 = _mm256_mul_epu32(d, w_5[1][1]);
	e1 = _mm256_mul_epu32(e, w_5[1][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 2 + n2), t);
	a[N2_1280 * 2 + n2] %= Q;
	a[N2_1280 * 2 + n2 + 1] %= Q;
	a[N2_1280 * 2 + n2 + 2] %= Q;
	a[N2_1280 * 2 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[2][0]);
	d1 = _mm256_mul_epu32(d, w_5[2][1]);
	e1 = _mm256_mul_epu32(e, w_5[2][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 3 + n2), t);
	a[N2_1280 * 3 + n2] %= Q;
	a[N2_1280 * 3 + n2 + 1] %= Q;
	a[N2_1280 * 3 + n2 + 2] %= Q;
	a[N2_1280 * 3 + n2 + 3] %= Q;

	c1 = _mm256_mul_epu32(c, w_5[3][0]);
	d1 = _mm256_mul_epu32(d, w_5[3][1]);
	e1 = _mm256_mul_epu32(e, w_5[3][2]);
	t = _mm256_add_epi64(b, c1);
	t = _mm256_add_epi64(t, d1);
	t = _mm256_add_epi64(t, e1);
	_mm256_storeu_si256((__m256i *)(a + N2_1280 * 4 + n2), t);
	a[N2_1280 * 4 + n2] %= Q;
	a[N2_1280 * 4 + n2 + 1] %= Q;
	a[N2_1280 * 4 + n2 + 2] %= Q;
	a[N2_1280 * 4 + n2 + 3] %= Q;
}

/* 256 * 5 --> 256 * 1 */
static void ntt_butterfly_1280_256(uint64_t *a, uint32_t n2)
{
	__m256i b, c, d, e, f, t, t1;
	
	b = _mm256_loadu_si256((__m256i *)(a + n2));
	c = _mm256_loadu_si256((__m256i *)(a + N2_1280 + n2));
	d = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 2 + n2));
	e = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 3 + n2));
	f = _mm256_loadu_si256((__m256i *)(a + N2_1280 * 4 + n2));

	t = _mm256_add_epi64(b, c);
	t = _mm256_add_epi64(t, d);
	t = _mm256_add_epi64(t, e);
	t = _mm256_add_epi64(t, f);
	t1 = _mm256_mul_epu32(t, V_B16Q_B16Q_B16Q_B16Q);
	t1 = _mm256_srli_epi64(t1, BARRETT_BITSHIFT_16Q);
	t1 = _mm256_mul_epu32(t1, V_Q_Q_Q_Q);
	t = _mm256_sub_epi64(t, t1);	
	_mm256_storeu_si256((__m256i *)(a + n2), t);
}

void ntt_768_1280(uint64_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_768_1280);
}

void intt_1280_512(uint64_t *a)
{
	intt_core(a, N1_1280, N2_1280, 512, omega_256, omega_1280, ntt_butterfly_1280_512, INV_1280);
}

void ntt_256_1024(uint64_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_256_1024);
}

void ntt_768_1024(uint64_t *a)
{
	ntt_core(a, N1_1024, N2_1024, omega_256, omega_1024, ntt_butterfly_768_1024);
}

void intt_1024_1024_inv(uint64_t *a)
{
	intt_core(a, N1_1024, N2_1024, 1024, omega_256_inv, omega_1024_inv, ntt_butterfly_1024_1024_inv, INV_1024);
}

void ntt_512_512_inv(uint64_t *a)
{
	ntt_core(a, N1_512, N2_512, omega_256_inv, omega_512_inv, ntt_butterfly_512_512_inv);
}

void intt_512_256(uint64_t *a)
{
	intt_core(a, N1_512, N2_512, 256, omega_256, omega_512, ntt_butterfly_512_256, INV_512);
}

void ntt_1024_1280(uint64_t *a)
{
	ntt_core(a, N1_1280, N2_1280, omega_256, omega_1280, ntt_butterfly_1024_1280);
}

void intt_1280_256(uint64_t *a)
{
	intt_core(a, N1_1280, N2_1280, 256, omega_256, omega_1280, ntt_butterfly_1280_256, INV_1280);
}
